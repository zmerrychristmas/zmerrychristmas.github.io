<!doctype html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Decoupling Ruby on Rails: Delegation vs Dependency Injection" /><meta name="author" content="Leo đẹp trai" /><meta property="og:locale" content="en_US" /><meta name="description" content="Delegation &amp;&amp; Dependency Injection Delegation Ruby’s standard library provides us SimpleDelegator as an easy way to implement the decorator pattern. You pass in your object to the constructor, and then any method calls to the delegator are forwarded to your object. E.g: 1 2 3 4 5 6 class PrawnWrapper &lt; SimpleDelegator def initialize(document: nil) document ||= Prawn::Document.new(...) super(document) end end We can then update our reports to inherit from this class, and they will still function the same as before, using the default document created in our initializer. The magic happens when we use this in our overview report: 1 2 3 4 5 6 7 8 9 10 class OverviewReport &lt; PrawnWrapper ... def render sales = SaleReport.new(..., document: self) sales.sales_table costs = CostReport.new(..., document: self) costs.costs_pie_chart ... end end we have essentially made it as if SalesReport is now a subclass of OverviewReport. In our case, this means that all the calls to prawn’s API now go SalesReport -&gt; OverviewReport -&gt; Prawn::Document. How SimpleDelegator Works: deletegation as services The way SimpleDelegator works under the hood is basically to use Ruby’s method_missing functionality to forward method calls to another object." /><meta property="og:description" content="Delegation &amp;&amp; Dependency Injection Delegation Ruby’s standard library provides us SimpleDelegator as an easy way to implement the decorator pattern. You pass in your object to the constructor, and then any method calls to the delegator are forwarded to your object. E.g: 1 2 3 4 5 6 class PrawnWrapper &lt; SimpleDelegator def initialize(document: nil) document ||= Prawn::Document.new(...) super(document) end end We can then update our reports to inherit from this class, and they will still function the same as before, using the default document created in our initializer. The magic happens when we use this in our overview report: 1 2 3 4 5 6 7 8 9 10 class OverviewReport &lt; PrawnWrapper ... def render sales = SaleReport.new(..., document: self) sales.sales_table costs = CostReport.new(..., document: self) costs.costs_pie_chart ... end end we have essentially made it as if SalesReport is now a subclass of OverviewReport. In our case, this means that all the calls to prawn’s API now go SalesReport -&gt; OverviewReport -&gt; Prawn::Document. How SimpleDelegator Works: deletegation as services The way SimpleDelegator works under the hood is basically to use Ruby’s method_missing functionality to forward method calls to another object." /><link rel="canonical" href="https://zmerrychristmas.github.io/posts/decoupling-ruby-on-rails-delegation-vs-dependency-injection/" /><meta property="og:url" content="https://zmerrychristmas.github.io/posts/decoupling-ruby-on-rails-delegation-vs-dependency-injection/" /><meta property="og:site_name" content="Programmer From Zero To Mountaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-04-16T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Decoupling Ruby on Rails: Delegation vs Dependency Injection" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Leo đẹp trai" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Leo đẹp trai"},"dateModified":"2022-05-07T18:58:13+07:00","datePublished":"2022-04-16T00:00:00+07:00","description":"Delegation &amp;&amp; Dependency Injection Delegation Ruby’s standard library provides us SimpleDelegator as an easy way to implement the decorator pattern. You pass in your object to the constructor, and then any method calls to the delegator are forwarded to your object. E.g: 1 2 3 4 5 6 class PrawnWrapper &lt; SimpleDelegator def initialize(document: nil) document ||= Prawn::Document.new(...) super(document) end end We can then update our reports to inherit from this class, and they will still function the same as before, using the default document created in our initializer. The magic happens when we use this in our overview report: 1 2 3 4 5 6 7 8 9 10 class OverviewReport &lt; PrawnWrapper ... def render sales = SaleReport.new(..., document: self) sales.sales_table costs = CostReport.new(..., document: self) costs.costs_pie_chart ... end end we have essentially made it as if SalesReport is now a subclass of OverviewReport. In our case, this means that all the calls to prawn’s API now go SalesReport -&gt; OverviewReport -&gt; Prawn::Document. How SimpleDelegator Works: deletegation as services The way SimpleDelegator works under the hood is basically to use Ruby’s method_missing functionality to forward method calls to another object.","headline":"Decoupling Ruby on Rails: Delegation vs Dependency Injection","mainEntityOfPage":{"@type":"WebPage","@id":"https://zmerrychristmas.github.io/posts/decoupling-ruby-on-rails-delegation-vs-dependency-injection/"},"url":"https://zmerrychristmas.github.io/posts/decoupling-ruby-on-rails-delegation-vs-dependency-injection/"}</script><meta name="pwa-cache" content="true"><title>Decoupling Ruby on Rails: Delegation vs Dependency Injection | Programmer From Zero To Mountaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programmer From Zero To Mountaint"><meta name="application-name" content="Programmer From Zero To Mountaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://polyfill.io" ><link rel="dns-prefetch" href="https://polyfill.io" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/portfolio/assets/img/portfolio/leo/horse-racing.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Programmer From Zero To Mountaint</a></h1><p class="site-subtitle fst-italic mb-0">Programmer blog</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/portfoio/" class="nav-link"> <i class="fa-fw fas fa-paper-plane"></i> <span>PORTFOLIO</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/zmerrychristmas" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['huybinh.ad','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Decoupling Ruby on Rails: Delegation vs Dependency Injection</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Decoupling Ruby on Rails: Delegation vs Dependency Injection</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1650042000" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 16, 2022 </time> </span> <span> Updated <time data-ts="1651924693" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 7, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Leo đẹp trai</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1008 words" > <em>5 min</em> read</span></div></div></header><div class="content"><h1 id="delegation--dependency-injection">Delegation &amp;&amp; Dependency Injection</h1><h2 id="delegation"><span class="me-2">Delegation</span><a href="#delegation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ruby’s standard library provides us SimpleDelegator as an easy way to implement the decorator pattern. You pass in your object to the constructor, and then any method calls to the delegator are forwarded to your object. E.g:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">PrawnWrapper</span> <span class="o">&lt;</span> <span class="no">SimpleDelegator</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">document: </span><span class="kp">nil</span><span class="p">)</span>
    <span class="n">document</span> <span class="o">||=</span> <span class="no">Prawn</span><span class="o">::</span><span class="no">Document</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><p>We can then update our reports to inherit from this class, and they will still function the same as before, using the default document created in our initializer. The magic happens when we use this in our overview report:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">OverviewReport</span> <span class="o">&lt;</span> <span class="no">PrawnWrapper</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="nf">render</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="no">SaleReport</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="ss">document: </span><span class="nb">self</span><span class="p">)</span>
    <span class="n">sales</span><span class="p">.</span><span class="nf">sales_table</span>
    <span class="n">costs</span> <span class="o">=</span> <span class="no">CostReport</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="ss">document: </span><span class="nb">self</span><span class="p">)</span>
    <span class="n">costs</span><span class="p">.</span><span class="nf">costs_pie_chart</span>
    <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><p>we have essentially made it as if SalesReport is now a subclass of OverviewReport. In our case, this means that all the calls to prawn’s API now go <code class="language-plaintext highlighter-rouge">SalesReport -&gt; OverviewReport -&gt; Prawn::Document</code>.</p><h3 id="how-simpledelegator-works-deletegation-as-services"><span class="me-2">How SimpleDelegator Works: deletegation as services</span><a href="#how-simpledelegator-works-deletegation-as-services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The way SimpleDelegator works under the hood is basically to use Ruby’s <code class="language-plaintext highlighter-rouge">method_missing</code> functionality to forward method calls to another object.</p><p>So SimpleDelegator (or a subclass of it) receives a method call. If it implements that method, great; it will execute it just as any other object would. However, it if does not have that method defined, then it will hit method_missing. method_missing will then attempt to call that method on the object given to its constructor.</p><div class="language-rb highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nb">require</span> <span class="s1">'simple_delegator'</span>
<span class="k">class</span> <span class="nc">Thing</span>
  <span class="k">def</span> <span class="nf">one</span>
    <span class="s1">'one'</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">two</span>
    <span class="s1">'two'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">ThingDecorator</span> <span class="o">&lt;</span> <span class="no">SimpleDelegator</span>
  <span class="k">def</span> <span class="nf">two</span>
    <span class="s1">'three!'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ThingDecorator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Thing</span><span class="p">.</span><span class="nf">new</span><span class="p">).</span><span class="nf">one</span> <span class="c1">#=&gt; "one"</span>
<span class="no">ThingDecorator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Thing</span><span class="p">.</span><span class="nf">new</span><span class="p">).</span><span class="nf">two</span> <span class="c1">#=&gt; "three!"</span>
</pre></table></code></div></div><blockquote><p>The key difference: SimpleDelegator takes the object <strong>it will delegate to as an argument in its constructor</strong>. This means we can pass in different objects at runtime.</p></blockquote><p>This is what allows use to redirect the calls to a prawn object in Solution 2 above. If we call a single report, the prawn calls go to a new document created in the constructor. The overview report, however, can change this so that calls to prawn are forwarded to its document.</p><h3 id="delegate-in-active-record"><span class="me-2">Delegate in Active Record</span><a href="#delegate-in-active-record" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Forward methods or attributes from class to subclass</p><div class="language-rb highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Greeter</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">hello</span>
    <span class="s1">'hello'</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">goodbye</span>
    <span class="s1">'goodbye'</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:greeter</span>
  <span class="n">delegate</span> <span class="ss">:hello</span><span class="p">,</span> <span class="ss">to: :greeter</span>
<span class="k">end</span>

<span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">hello</span>   <span class="c1"># =&gt; "hello"</span>
<span class="no">Foo</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">goodbye</span> <span class="c1"># =&gt; NoMethodError: undefined method `goodbye' for #&lt;Foo:0x1af30c&gt;</span>
</pre></table></code></div></div><h2 id="dependency-injectiondi"><span class="me-2">Dependency Injection(DI)</span><a href="#dependency-injectiondi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="concept"><span class="me-2">Concept</span><a href="#concept" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In software engineering, dependency injection is a design pattern in which an object receives other objects that it depends on. A form of inversion of control, dependency injection aims to separate the concerns of constructing objects and using them, leading to loosely coupled programs.[1][2][3] The pattern ensures that an object which wants to use a given service should not have to know how to construct those services. Instead, the receiving object (or ‘client’) is provided with its dependencies by external code (an ‘injector’), which it is not aware of.[4] Dependency injection solves the following problems:[5]</p><ol><li>How can a class be independent from the creation of the objects it depends on?<li>How can an application, and the objects it uses support different configurations?<li>How can the behavior of a piece of code be changed without editing it directly?<li>Fundamentally, dependency injection consists of passing parameters to a method.<li>As mentioned previously, one common solution to this kind of problem is to refactor the code to use Dependency Injection. That is, rather than having all these reports call methods on self, we will instead pass in our PDF document as an argument.</ol><h3 id="dependency-injection-in-services"><span class="me-2">Dependency injection in services</span><a href="#dependency-injection-in-services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This would give us something more like:</p><div class="language-rb highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">CostReport</span> <span class="o">&lt;</span> <span class="no">Prawn</span><span class="o">::</span><span class="no">Document</span>
<span class="o">...</span>
  <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="n">pdf</span> <span class="o">=</span> <span class="nb">self</span><span class="p">)</span>
    <span class="n">pdf</span><span class="p">.</span><span class="nf">text</span> <span class="s2">"Cost Report"</span>
    <span class="n">pdf</span><span class="p">.</span><span class="nf">move_down</span> <span class="mi">20</span>
    <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></table></code></div></div><p>This works, but there is some overhead here. For one thing, every single drawing method now has to take the pdf argument, and every single call to prawn now has to go through this pdf argument.</p><p>Dependency injection has some benefits: it pushes us toward <strong>decoupled components</strong> in our system and allows us to pass in mocks or stubs to make unit testing easier.</p><p>However, we are not reaping the rewards of these benefits in our scenario. We are already strongly coupled to the prawn API, so <code class="language-plaintext highlighter-rouge">changing to a different PDF library</code> would almost certainly require an entire rewrite of the code.</p><p>Testing is also not a big concern here, because in our case testing generated PDF reports with automated tests is too cumbersome to be worthwhile.</p><h2 id="delegation-and-dependency-injection"><span class="me-2">Delegation and Dependency Injection</span><a href="#delegation-and-dependency-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I want to mention, when Developer need to implement Dependency Injection in Rails is make something double and couple because It’s likely we want to create multiple services different and less couple with base class used While Ruby on Rails is every where we can fine or define an Object and we spent manage effort with each class services. So it less use than delegation. Let think about a Document class want to define a method to render a report. By DI we mush define a method with parameter is Interface represent of class handling services. But in delegate we make a less couple but still maintain connection between two class, by passing a method from other class to use in this class. This behavious is same but one is Rails define and support, one is design pattern so we can choose to use an approach with each use case.</p><p>Use Case when DI is always better: Declare services with long time developement but need behavious we wanted, So we can boot a class use DI when bootstrap a service so give a best performance while delegate is must require the clarify of other class method and this required a check behavious: input and output before using delegate.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/fullstack/">Fullstack</a>, <a href="/categories/backend/">Backend</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ruby/" class="post-tag no-text-decoration" >ruby</a> <a href="/tags/solid/" class="post-tag no-text-decoration" >solid</a> <a href="/tags/dependency/" class="post-tag no-text-decoration" >dependency</a> <a href="/tags/rails/" class="post-tag no-text-decoration" >rails</a> <a href="/tags/oop/" class="post-tag no-text-decoration" >oop</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/AdHuybinh" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/alz.ailove" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Decoupling%20Ruby%20on%20Rails:%20Delegation%20vs%20Dependency%20Injection%20-%20Programmer%20From%20Zero%20To%20Mountaint&url=https%3A%2F%2Fzmerrychristmas.github.io%2Fposts%2Fdecoupling-ruby-on-rails-delegation-vs-dependency-injection%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/solid-principles-and-solid-in-frameworks/">SOLID principles, and SOLID in frameworks (part 1)</a><li class="text-truncate lh-lg"> <a href="/posts/nodejs-concept/">Node.JS concept</a><li class="text-truncate lh-lg"> <a href="/posts/text-and-typography/">Text and Typography</a><li class="text-truncate lh-lg"> <a href="/posts/getting-started/">Getting Started</a><li class="text-truncate lh-lg"> <a href="/posts/enable-google-pv/">Enable Google Page Views</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/solid-principles-and-solid-in-frameworks/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1650042000" data-df="ll" > Apr 16, 2022 </time><h4 class="pt-0 my-2">SOLID principles, and SOLID in frameworks (part 1)</h4><div class="text-muted"><p> Solid principles contains five best praticles when construct source code by OOP methodology. Single responsible principles The single-responsibility principle (SRP) is a computer-programming pri...</p></div></div></a></article><article class="col"> <a href="/posts/Tao-rails-api-voi-grape/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616346000" data-df="ll" > Mar 22, 2021 </time><h4 class="pt-0 my-2">Tạo Rails API với Grape</h4><div class="text-muted"><p> Trong việc module hóa cũng như tạo cấu trúc REST API bạn có thể tự tạo cho mình một framework riêng hoặc sử dụng một framework đã có và đang được phát triển và ưa dùng là grape. tham khảo tại đây G...</p></div></div></a></article><article class="col"> <a href="/posts/bug-rails-gem-server-sysopen/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616346000" data-df="ll" > Mar 22, 2021 </time><h4 class="pt-0 my-2">Bug thần thánh permission denied @ rb_sysopen</h4><div class="text-muted"><p> Bug rack/server.rb:362:in initialize: Permission denied @ rb_sysopen (Errno::EACCES) phiên bản sử dụng là rvm Try first update gem owner sudo chown -R userowner:yourgroup ~/.rvm Update permission...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/loop-with-decrement-order-in-Python-Ruby-PHP/" class="btn btn-outline-primary" aria-label="Older" ><p>Loop with decrement order in Python, Ruby, PHP.</p></a> <a href="/posts/shortened-url-by-ruby-on-rails/" class="btn btn-outline-primary" aria-label="Newer" ><p>How to build a Shortened URL By Ruby On Rails like Bitly or Twitter</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/username">Leo đẹp trai</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/assets/js/dist/app.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-S57T0PJRJG"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-S57T0PJRJG'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
