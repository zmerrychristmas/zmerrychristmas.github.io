<!doctype html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Node.JS concept" /><meta name="author" content="Leo đẹp trai" /><meta property="og:locale" content="en_US" /><meta name="description" content="NodeJS - Concept Node.js is an open-source and cross platform javascript runtime environment. It is a popular tool for almost any kind of project! NodeJS is javascript on the server, built from v8 engine used to read, parse javascript code and executed necessary action. NodeJs i a non blocking event based IO and run on a single thread process. Event loop is constanly running process that monitors the callback queue and the call stack. The process will continously check the call stack, and if the call stack is empty, push the next function from the callback queue to the stack. If there is nothing in the callback queue, nothing will happen. Runs the V8 javascript engine, the core of Google Chrome, outside of browser. This allows Node.js to be very performant Single thread for every request provides a set of asynchronous I/O primitives using non-blocking paradigms, making blocking behaviour the exception rather than the norm. Reading network, database, file system: resume the operation when response is comeback AdonisJS, Egg.js, Express, Fastify, featherJs, Gastby, hapi, koa, loopback.io, meteor, micro, nestjs, nextjs, NX, Remix, Sapper, socker.io, strapi." /><meta property="og:description" content="NodeJS - Concept Node.js is an open-source and cross platform javascript runtime environment. It is a popular tool for almost any kind of project! NodeJS is javascript on the server, built from v8 engine used to read, parse javascript code and executed necessary action. NodeJs i a non blocking event based IO and run on a single thread process. Event loop is constanly running process that monitors the callback queue and the call stack. The process will continously check the call stack, and if the call stack is empty, push the next function from the callback queue to the stack. If there is nothing in the callback queue, nothing will happen. Runs the V8 javascript engine, the core of Google Chrome, outside of browser. This allows Node.js to be very performant Single thread for every request provides a set of asynchronous I/O primitives using non-blocking paradigms, making blocking behaviour the exception rather than the norm. Reading network, database, file system: resume the operation when response is comeback AdonisJS, Egg.js, Express, Fastify, featherJs, Gastby, hapi, koa, loopback.io, meteor, micro, nestjs, nextjs, NX, Remix, Sapper, socker.io, strapi." /><link rel="canonical" href="https://zmerrychristmas.github.io/posts/nodejs-concept/" /><meta property="og:url" content="https://zmerrychristmas.github.io/posts/nodejs-concept/" /><meta property="og:site_name" content="Programmer From Zero To Mountaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-02T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Node.JS concept" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Leo đẹp trai" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Leo đẹp trai"},"dateModified":"2024-02-04T17:55:43+07:00","datePublished":"2022-09-02T00:00:00+07:00","description":"NodeJS - Concept Node.js is an open-source and cross platform javascript runtime environment. It is a popular tool for almost any kind of project! NodeJS is javascript on the server, built from v8 engine used to read, parse javascript code and executed necessary action. NodeJs i a non blocking event based IO and run on a single thread process. Event loop is constanly running process that monitors the callback queue and the call stack. The process will continously check the call stack, and if the call stack is empty, push the next function from the callback queue to the stack. If there is nothing in the callback queue, nothing will happen. Runs the V8 javascript engine, the core of Google Chrome, outside of browser. This allows Node.js to be very performant Single thread for every request provides a set of asynchronous I/O primitives using non-blocking paradigms, making blocking behaviour the exception rather than the norm. Reading network, database, file system: resume the operation when response is comeback AdonisJS, Egg.js, Express, Fastify, featherJs, Gastby, hapi, koa, loopback.io, meteor, micro, nestjs, nextjs, NX, Remix, Sapper, socker.io, strapi.","headline":"Node.JS concept","mainEntityOfPage":{"@type":"WebPage","@id":"https://zmerrychristmas.github.io/posts/nodejs-concept/"},"url":"https://zmerrychristmas.github.io/posts/nodejs-concept/"}</script><meta name="pwa-cache" content="true"><title>Node.JS concept | Programmer From Zero To Mountaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programmer From Zero To Mountaint"><meta name="application-name" content="Programmer From Zero To Mountaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://polyfill.io" ><link rel="dns-prefetch" href="https://polyfill.io" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/portfolio/assets/img/portfolio/leo/horse-racing.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Programmer From Zero To Mountaint</a></h1><p class="site-subtitle fst-italic mb-0">Programmer blog</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/portfoio/" class="nav-link"> <i class="fa-fw fas fa-paper-plane"></i> <span>PORTFOLIO</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/zmerrychristmas" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['huybinh.ad','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Node.JS concept</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Node.JS concept</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1662051600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 2, 2022 </time> </span> <span> Updated <time data-ts="1707044143" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 4, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Leo đẹp trai</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="21023 words" > <em>116 min</em> read</span></div></div></header><div class="content"><h1 id="nodejs---concept">NodeJS - Concept</h1><p>Node.js is an open-source and cross platform javascript runtime environment. It is a popular tool for almost any kind of project! NodeJS is javascript on the server, built from v8 engine used to read, parse javascript code and executed necessary action. NodeJs i a non blocking event based IO and run on a single thread process. Event loop is constanly running process that monitors the callback queue and the call stack. The process will continously check the call stack, and if the call stack is empty, push the next function from the callback queue to the stack. If there is nothing in the callback queue, nothing will happen.</p><ul><li>Runs the V8 javascript engine, the core of Google Chrome, outside of browser. This allows Node.js to be very performant<li>Single thread for every request<ul><li>provides a set of asynchronous I/O primitives<li>using non-blocking paradigms, making blocking behaviour the exception rather than the norm.</ul><li>Reading network, database, file system: resume the operation when response is comeback<li>AdonisJS, Egg.js, Express, Fastify, featherJs, Gastby, hapi, koa, loopback.io, meteor, micro, nestjs, nextjs, NX, Remix, Sapper, socker.io, strapi.</ul><pre><code class="language-JS">const http = require('http')
const hostname = '127.0.0.1'
const port = 3000

const server = http.createServer((req, res) =&gt; {
    res.statusCode = 200
    res.setHeader('Content-Type', 'text/plain')
    res.end('Hello World\n')
})

server.listen(port, hostname, () =&gt; {
    console.log(`Server running at http://${hostname}:${port}/`)
})

</code></pre><h2 id="pros"><span class="me-2">Pros</span><a href="#pros" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Handle thousands of concurrent connection with a single server withou introducing the burden of managing thread concurency, which could be a significant source of bugs.</p><ul><li>unique advantage because milions of frontend developers that write javascript for the browser are now able to write client-server.<li>ECMAScript can be used by specifics NodeJs version.<h2 id="install"><span class="me-2">Install</span><a href="#install" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><li>NVM is a popular way to run Node.js. It allows you to easily switch the Node.Js version and install new version to try and easily rollback if something breaks.<h2 id="javascript-topics"><span class="me-2">Javascript Topics</span><a href="#javascript-topics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><li>Lexical Structure<ul><li>Unicode<li>Semicolons<li>White space<li>Case sensitive<li>Comments<li>Literals and Identifiers<li>Reserved words</ul><li>Expressions</ul><div class="table-wrapper"><table><thead><tr><th>Name<th>Shorthand operator<th>Meaning<tbody><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Assignment">Assignment</a><td><code class="language-plaintext highlighter-rouge">x = f()</code><td><code class="language-plaintext highlighter-rouge">x = f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Addition_assignment">Addition assignment</a><td><code class="language-plaintext highlighter-rouge">x += f()</code><td><code class="language-plaintext highlighter-rouge">x = x + f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Subtraction_assignment">Subtraction assignment</a><td><code class="language-plaintext highlighter-rouge">x -= f()</code><td><code class="language-plaintext highlighter-rouge">x = x - f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Multiplication_assignment">Multiplication assignment</a><td><code class="language-plaintext highlighter-rouge">x *= f()</code><td><code class="language-plaintext highlighter-rouge">x = x * f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Division_assignment">Division assignment</a><td><code class="language-plaintext highlighter-rouge">x /= f()</code><td><code class="language-plaintext highlighter-rouge">x = x / f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Remainder_assignment">Remainder assignment</a><td><code class="language-plaintext highlighter-rouge">x %= f()</code><td><code class="language-plaintext highlighter-rouge">x = x % f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Exponentiation_assignment">Exponentiation assignment</a><td><code class="language-plaintext highlighter-rouge">x **= f()</code><td><code class="language-plaintext highlighter-rouge">x = x ** f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Left_shift_assignment">Left shift assignment</a><td><code class="language-plaintext highlighter-rouge">x &lt;&lt;= f()</code><td><code class="language-plaintext highlighter-rouge">x = x &lt;&lt; f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Right_shift_assignment">Right shift assignment</a><td><code class="language-plaintext highlighter-rouge">x &gt;&gt;= f()</code><td><code class="language-plaintext highlighter-rouge">x = x &gt;&gt; f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Unsigned_right_shift_assignment">Unsigned right shift assignment</a><td><code class="language-plaintext highlighter-rouge">x &gt;&gt;&gt;= f()</code><td><code class="language-plaintext highlighter-rouge">x = x &gt;&gt;&gt; f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_AND_assignment">Bitwise AND assignment</a><td><code class="language-plaintext highlighter-rouge">x &amp;= f()</code><td><code class="language-plaintext highlighter-rouge">x = x &amp; f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_XOR_assignment">Bitwise XOR assignment</a><td><code class="language-plaintext highlighter-rouge">x ^= f()</code><td><code class="language-plaintext highlighter-rouge">x = x ^ f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_OR_assignment">Bitwise OR assignment</a><td><code class="language-plaintext highlighter-rouge">x \|= f()</code><td><code class="language-plaintext highlighter-rouge">x = x \| f()</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_AND_assignment">Logical AND assignment</a><td><code class="language-plaintext highlighter-rouge">x &amp;&amp;= f()</code><td><code class="language-plaintext highlighter-rouge">x &amp;&amp; (x = f())</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_OR_assignment">Logical OR assignment</a><td><code class="language-plaintext highlighter-rouge">x \|\|= f()</code><td><code class="language-plaintext highlighter-rouge">x \|\| (x = f())</code><tr><td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_nullish_assignment">Logical nullish assignment</a><td><code class="language-plaintext highlighter-rouge">x ??= f()</code><td><code class="language-plaintext highlighter-rouge">x ?? (x = f())</code></table></div><ul><li>Types JavaScript Types are Dynamic. String, Numbers, Booleans, Arrays, Objects, Undefined, Typeof<li>Classes Classes are a template for creating objects. They encapsulate data with code to work on that data.<pre><code class="language-JS">// unnamed
let Rectangle = class {
constructor(height, width) {
  this.height = height;
  this.width = width;
}
};
console.log(Rectangle.name);
// output: "Rectangle"
</code></pre><li>Variables 4 Ways to Declare a JavaScript Variable:<ul><li>Using var<li>Using let<li>Using const<li>Using nothing</ul><li>Functions A JavaScript function is a block of code designed to perform a particular task.<li>this In JavaScript, the this keyword refers to an object. Which object depends on how this is being invoked (used or called).<li>Arrow Functions An arrow function expression is a compact alternative to a traditional function expression, but is limited and can’t be used in all situations. ```JS // ———————- // Arrow Example // ———————-</ul><p>// A simplistic object with its very own “this”. const obj = { num: 100, };</p><p>// Setting “num” on window to show how it gets picked up. window.num = 2020; // yikes!</p><p>// Arrow Function const add = (a, b, c) =&gt; this.num + a + b + c;</p><p>// call console.log(add.call(obj, 1, 2, 3)); // result 2026</p><p>// apply const arr = [1, 2, 3]; console.log(add.apply(obj, arr)); // result 2026</p><p>// bind const bound = add.bind(obj); console.log(bound(1, 2, 3)); // result 2026</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre>Arrow functions cannot be used as constructors and will throw an error when used with new.
Arrow functions do not have a prototype property.
The yield keyword may not be used in an arrow function's body
Arrow functions can have either a concise body or the usual block body.
```JS
// An empty arrow function returns undefined
const empty = () =&gt; {};

(() =&gt; 'foobar')();
// Returns "foobar"
// (this is an Immediately Invoked Function Expression)

const simple = (a) =&gt; a &gt; 15 ? 15 : a;
simple(16); // 15
simple(10); // 10

const max = (a, b) =&gt; a &gt; b ? a : b;

// Easy array filtering, mapping, etc.

const arr = [5, 6, 13, 0, 1, 18, 23];

const sum = arr.reduce((a, b) =&gt; a + b);
// 66

const even = arr.filter((v) =&gt; v % 2 === 0);
// [6, 0, 18]

const double = arr.map((v) =&gt; v * 2);
// [10, 12, 26, 0, 2, 36, 46]

// More concise promise chains
promise
  .then((a) =&gt; {
  // …
  })
  .then((b) =&gt; {
    // …
  });

// Parameterless arrow functions that are visually easier to parse
setTimeout(() =&gt; {
  console.log('I happen sooner');
  setTimeout(() =&gt; {
    // deeper code
    console.log('I happen later');
  }, 1);
}, 1);
</pre></table></code></div></div><ul><li>Loops<ul><li>for - loops through a block of code a number of times<li>for/in - loops through the properties of an object<li>for/of - loops through the values of an iterable object<li>while - loops through a block of code while a specified condition is true<li>do/while - also loops through a block of code while a specified condition is true</ul><li>Scopes<ul><li>Block scope<li>Function scope<li>Global scope</ul><li>Arrays<pre><code class="language-JS">const person = [];
person["firstName"] = "John";
person["lastName"] = "Doe";
person["age"] = 46;
person.length;     // Will return 0
person[0];         // Will return undefined
</code></pre><li>Template Literals Template literals are literals delimited with blacktick (`) characters, allowing for multi-line string, for string interpolation with embedded expressions, and for special constructs called tagged templates.<pre><code class="language-JS">`string text ${expression} string text`
</code></pre><li>Semicolons Semicolons are an essential part of javascript code. They are read and used by the compiler to distinguising between separate statements so that statements do not lead into other parts of the code. The good news is that JavaScript includes an automatic semicolon feature.<li>Strict Mode Strict <strong>directive</strong> was new in ECMA Script version 5. It is not a statement, but a literal expression, ignored by earlier versions of JavaScript. The purpose of <code class="language-plaintext highlighter-rouge">"use strict"</code> is to indicate that the code should be executed in “strict mode”.<pre><code class="language-JS">"use strict";
x = 3.14;       // This will cause an error because x is not declared
function myFunction() {
"use strict";
y = 3.14;   // This will cause an error
}
x = {p1:10, p2:20};      // This will cause an error
delete x;                // This will cause an error
</code></pre><p>not allowed: duplicated, deleted, undeclare, octal number, octal escape, Writing to a read-only property, Writing to a get-only property , delete undeleteable properties, cant use <code class="language-plaintext highlighter-rouge">eval</code> word, a variable can not be used before it is declared,eval() can not declare a variable using the var keyword, eval() can not declare a variable using the let keyword, the arguments, with cant be used as a variable.</p><li>ECMAScript 6, 2016, 2017 With those concept in mind, you are well on your road to become a proficient javascript developer in both browser and in Node.js.</ul><h2 id="fundamental-part-of-nodejs"><span class="me-2">Fundamental part of Node.js:</span><a href="#fundamental-part-of-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><a href="https://nodejs.dev/learn/javascript-asynchronous-programming-and-callbacks">Asynchronous programming and callbacks</a><li><a href="https://nodejs.dev/learn/discover-javascript-timers">Timers</a><li><a href="https://nodejs.dev/learn/understanding-javascript-promises">Promises</a><li><a href="https://nodejs.dev/learn/modern-asynchronous-javascript-with-async-and-await">Async and Await</a><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures">Closures</a><li><a href="https://nodejs.dev/learn/the-nodejs-event-loop">The Event Loop</a><h3 id="asynchronous-programming-and-callbacks"><span class="me-2">Asynchronous programming and callbacks</span><a href="#asynchronous-programming-and-callbacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Asynchronous</strong> means that things can happen independently of the main program flow. In the current consumer computers, every program runs for a specific time slot and then it stops its exceution to let another program continue their execution. This thing runs in a cycle so fast that it’s impossible to notice. We thing our computer run many programs simultaneously, but this is an illusion. Programs internally use interrupts, a signal that’s emitted to the processor to gain the attention of the system. <strong>JavaScript</strong> is synchronous by default and is single threaded. This means that code cannot create new threads and run in parallel. The browser provides a way to do it by providing a set of APIs that can handle this kind of functionality. More recently, Node.js introduced a non-blocking I/O environment to extend this concept to file access, network calls and so on. <strong>Callback</strong> You define an event handler for the click event. This event handler accpet a function, which will be called when the event is triggered</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="k">if </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span> <span class="p">?</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span> <span class="p">:</span> <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">};</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">https://yoursite.com</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">send</span><span class="p">();</span>
</pre></table></code></div></div><li>browser event(DOM)<li>access file and make XHR request<li>setTimeOut function<h4 id="handling-errors-in-callbacks"><span class="me-2">Handling errors in callbacks</span><a href="#handling-errors-in-callbacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The first parameter in any callback function is the error object: error-first callbacks</p><h4 id="the-problem-with-callbacks"><span class="me-2">The problem with callbacks</span><a href="#the-problem-with-callbacks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>However every callback adds a level of nesting, and when you have lots of callbacks, the code starts to be complicated very quickly ```js function doStep1(init) { return init + 1; }</p></ul><p>function doStep2(init) { return init + 2; }</p><p>function doStep3(init) { return init + 3; }</p><p>function doOperation() { let result = 0; result = doStep1(result); result = doStep2(result); result = doStep3(result); console.log(<code class="language-plaintext highlighter-rouge">result: ${result}</code>); }</p><p>doOperation();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>Because we have to call callbacks inside callbacks, we get a deeply nested doOperation() function, which is much harder to read and debug. This is sometimes called "callback hell" or the "pyramid of doom" (because the indentation looks like a pyramid on its side).
For these reasons, most modern asynchronous APIs don't use callbacks. Instead, the foundation of asynchronous programming in JavaScript is the Promise
### Timers
- SetTimeout : you soecify a callback function to execute later and value expressing how later you want it to run, in milisecons.
```JS
const myFunction = (firstParam, secondParam) =&gt; {
  // do something
};

// runs after 2 seconds
setTimeout(myFunction, 2000, firstParam, secondParam);
// I changed my mind
clearTimeout(id);
</pre></table></code></div></div><h3 id="promise"><span class="me-2">Promise</span><a href="#promise" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/promises.png" class="popup img-link shimmer"><img src="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/promises.png" alt="Chain promise" title="Chain promise" loading="lazy"></a></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kd">const</span> <span class="nx">isItDoneYet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">workDone</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Here is the thing I built</span><span class="dl">'</span>
    <span class="nf">resolve</span><span class="p">(</span><span class="nx">workDone</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">why</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Still working on something else</span><span class="dl">'</span>
    <span class="nf">reject</span><span class="p">(</span><span class="nx">why</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="kd">const</span> <span class="nx">checkIfItsDone</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">isItDoneYet</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">ok</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">ok</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="nf">checkIfItsDone</span><span class="p">()</span>
</pre></table></code></div></div><p>A promise is commonly defined as a proxy for a value that will eventually become avaiable. promise is oneway to deal with asynchronous code.</p><h4 id="how-promise-working"><span class="me-2">How promise working</span><a href="#how-promise-working" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>When a promise called, it will start in a pending state. This means that the calling function continues executing, while the promise is pending until it resolves, giving the calling function whatever data was being requested.<li>The created promise will end in <strong>resolved</strong> state or <strong>rejected</strong> state. Calling the respective callback function upon finishing.<li><strong>Promisifying</strong> This technique is a way to be able to use a classic JavaScript function that takes a callback, and have it return a promise. ```js const fs = require(‘fs’);</ul><p>const getFile = fileName =&gt; { return new Promise((resolve, reject) =&gt; { fs.readFile(fileName, (err, data) =&gt; { if (err) { reject(err); // calling <code class="language-plaintext highlighter-rouge">reject</code> will cause the promise to fail with or without the error passed as an argument return; // and we don’t want to go any further } resolve(data); }); }); };</p><p>getFile(‘/etc/passwd’) .then(data =&gt; console.log(data)) .catch(err =&gt; console.error(err));</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>**Consuming a promise**
```js
const isItDoneYet = new Promise(/* ... as above ... */);
// ...

const checkIfItsDone = () =&gt; {
  isItDoneYet
    .then(ok =&gt; {
      console.log(ok);
    })
    .catch(err =&gt; {
      console.error(err);
    });
};
</pre></table></code></div></div><p><strong>Chaining promises</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">reject</span><span class="p">(</span><span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="p">));</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">();</span>

<span class="nf">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/todos.json</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">status</span><span class="p">)</span> <span class="c1">// note that the `status` function is actually **called** here, and that it **returns a promise***</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="c1">// likewise, the only difference here is that the `json` function here returns a promise that resolves with `data`</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ... which is why `data` shows up here as the first parameter to the anonymous function</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Request succeeded with JSON response</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Request failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></table></code></div></div><p><strong>Cascading Error</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error</span><span class="dl">'</span><span class="p">);</span>
<span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>
</pre></table></code></div></div><p><strong>Orchestrating promise</strong> Promise have two function synchonized</p><ul><li>Promise.all() ```js const f1 = fetch(‘/something.json’); const f2 = fetch(‘/something2.json’);</ul><p>Promise.all([f1, f2]) .then(res =&gt; { console.log(‘Array of results’, res); }) .catch(err =&gt; { console.error(err); });</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>- Promise.race()
Promise.race() runs when the first of the promises you pass to it settles
- Promise.any()
Promise settle when any of the promise you pass to it fulfill or all of promise is get rejected(AggregateError)

**Common errors**
- Uncaught TypeError: undefined is not a promise
- UnhandledPromiseRejectionWarning
### Thenables
The JavaScript ecosystem had made multiple Promise implementations long before it became part of the language. Despite being represented differently internally, at the minimum, all Promise-like objects implement the Thenable interface. A thenable implements the .then() method, which is called with two callbacks: one for when the promise is fulfilled, one for when it's rejected. Promises are thenables as well.
```js
const aThenable = {
  then(onFulfilled, onRejected) {
    onFulfilled({
      // The thenable is fulfilled with another thenable
      then(onFulfilled, onRejected) {
        onFulfilled(42);
      },
    });
  },
};

Promise.resolve(aThenable); // A promise fulfilled with 42
</pre></table></code></div></div><ul><li><strong>Complex promise</strong> ```js “use strict”; let promiseCount = 0;</ul><p>function testPromise() { const thisPromiseCount = ++promiseCount; const log = document.getElementById(“log”); // begin log.insertAdjacentHTML(“beforeend”, <code class="language-plaintext highlighter-rouge">${thisPromiseCount}) Started&lt;br&gt;</code>); // We make a new promise: we promise a numeric count of this promise, starting from 1 (after waiting 3s) const p1 = new Promise((resolve, reject) =&gt; { // The executor function is called with the ability to resolve or reject the promise log.insertAdjacentHTML( “beforeend”, <code class="language-plaintext highlighter-rouge">${thisPromiseCount}) Promise constructor&lt;br&gt;</code> ); // This is only an example to create asynchronism setTimeout(() =&gt; { // We fulfill the promise ! resolve(thisPromiseCount); }, Math.random() * 2000 + 1000); });</p><p>// We define what to do when the promise is resolved with the then() call, // and what to do when the promise is rejected with the catch() call p1.then((val) =&gt; { // Log the fulfillment value log.insertAdjacentHTML(“beforeend”, <code class="language-plaintext highlighter-rouge">${val}) Promise fulfilled&lt;br&gt;</code>); }).catch((reason) =&gt; { // Log the rejection reason console.log(<code class="language-plaintext highlighter-rouge">Handle rejected promise (${reason}) here.</code>); }); // end log.insertAdjacentHTML(“beforeend”, <code class="language-plaintext highlighter-rouge">${thisPromiseCount}) Promise made&lt;br&gt;</code>); }</p><p>const btn = document.getElementById(“make-promise”); btn.addEventListener(“click”, testPromise);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>```html
&lt;button id="make-promise"&gt;Make a promise!&lt;/button&gt;
&lt;div id="log"&gt;&lt;/div&gt;
</pre></table></code></div></div><h2 id="modern-asynchronous-javascript-with-async-and-await"><span class="me-2">Modern Asynchronous JavaScript with Async and Await</span><a href="#modern-asynchronous-javascript-with-async-and-await" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Async function are a combination of promise and generators, and basically, they are higher level abstraction over promises. <strong>async/await is built on promise</strong></p><ul><li>Example when async function return a promise. An await function is calling <strong>until the promise is resolved or rejected</strong>. ```js const doSomethingAsync = () =&gt; { return new Promise(resolve =&gt; { setTimeout(() =&gt; resolve(‘I did something’), 3000) }) }</ul><p>const doSomething = async () =&gt; { console.log(await doSomethingAsync()) }</p><p>console.log(‘Before’) doSomething() console.log(‘After’)</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>- **Promise vs async/await**
```js
// thenable
const getFirstUserData = () =&gt; {
  return fetch('/users.json') // get users list
    .then(response =&gt; response.json()) // parse JSON
    .then(users =&gt; users[0]) // pick first user
    .then(user =&gt; fetch(`/users/${user.name}`)) // get user data
    .then(userResponse =&gt; userResponse.json()); // parse JSON
};

getFirstUserData();
// implemented by async/await
const getFirstUserData = async () =&gt; {
  const response = await fetch('/users.json'); // get users list
  const users = await response.json(); // parse JSON
  const user = users[0]; // pick first user
  const userResponse = await fetch(`/users/${user.name}`); // get user data
  const userData = await userResponse.json(); // parse JSON
  return userData;
};

getFirstUserData();
</pre></table></code></div></div><ul><li>Multiple async functions in series ```js const promiseToDoSomething = () =&gt; { return new Promise(resolve =&gt; { setTimeout(() =&gt; resolve(‘I did something’), 10000) }) }</ul><p>const watchOverSomeoneDoingSomething = async () =&gt; { const something = await promiseToDoSomething() return something + ‘\nand I watched’ }</p><p>const watchOverSomeoneWatchingSomeoneDoingSomething = async () =&gt; { const something = await watchOverSomeoneDoingSomething() return something + ‘\nand I watched as well’ }</p><p>watchOverSomeoneWatchingSomeoneDoingSomething().then(res =&gt; { console.log(res) })</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>### Closures
The combination of function bundled together (enclosed) with references to it surround state (THE LEXICAL environment). a closure gives you access to an outer function's scope from an inner function.

```js
function showHelp(help) {
  document.getElementById('help').textContent = help;
}

function makeHelpCallback(help) {
  return function () {
    showHelp(help);
  };
}

function setupHelp() {
  var helpText = [
    { id: 'email', help: 'Your e-mail address' },
    { id: 'name', help: 'Your full name' },
    { id: 'age', help: 'Your age (you must be over 16)' },
  ];

  for (var i = 0; i &lt; helpText.length; i++) {
    var item = helpText[i];
    document.getElementById(item.id).onfocus = makeHelpCallback(item.help);
  }
}

setupHelp();
</pre></table></code></div></div><h4 id="scoping-with-let-and-const"><span class="me-2">Scoping with let and const</span><a href="#scoping-with-let-and-const" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Traditionally (before ES6), javascript only had two kind of scope: function scope and global scope. Variables declare with var are either function scoped and global scope, depending on whether they are declared within a function or outside function. This can be tricky, because blocks with curly braces do not create scope</p><ul><li>With <code class="language-plaintext highlighter-rouge">const</code> you can create a block scoped: <code class="language-plaintext highlighter-rouge">temporal dead zone</code>!<li>A closure is the combination of a function and the lexical environment within which that function was declared. This environment consits of any local variables that were in-scope at the time the closure was created.<h4 id="emulating-private-methods-with-closures"><span class="me-2">Emulating private methods with closures</span><a href="#emulating-private-methods-with-closures" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>```JS const counter = (function () { let privateCounter = 0; function changeBy(val) { privateCounter += val; }</p><p>return { increment() { changeBy(1); },</p><p>decrement() { changeBy(-1); },</p><p>value() { return privateCounter; }, }; })();</p></ul><p>console.log(counter.value()); // 0.</p><p>counter.increment(); counter.increment(); console.log(counter.value()); // 2.</p><p>counter.decrement(); console.log(counter.value()); // 1.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>JS, prior to class, didn't have a native way of declaring private methods, but it was possible to emulate private methods using closure. Private methods aren't just useful fo restricting access to code. They also prove a powerful way of managing your global namespace.
#### Closure scope
- Local scope (own scope)
- Enclosing scope (can be block, function, or module scope)
- Global scope
```JS
// global scope
const e = 10;
function sum(a) {
  return function (b) {
    return function (c) {
      // outer functions scope
      return function (d) {
        // local scope
        return a + b + c + d + e;
      };
    };
  };
}

console.log(sum(1)(2)(3)(4)); // log 20
</pre></table></code></div></div><p>You can also write without anonymous functions:</p><pre><code class="language-JS">// global scope
const e = 10;
function sum(a) {
  return function sum2(b) {
    return function sum3(c) {
      // outer functions scope
      return function sum4(d) {
        // local scope
        return a + b + c + d + e;
      };
    };
  };
}

const sum2 = sum(1);
const sum3 = sum2(2);
const sum4 = sum3(3);
const result = sum4(4);
console.log(result); //log 20
</code></pre><h2 id="event-loop"><span class="me-2">Event loop</span><a href="#event-loop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In Nodejs Javascript, event loop is the “killer features” while nodejs run on single thread. There is just one thing happening at a time That’s actually helpful as it simplifier alot how a program without worry about concurrency issues. You just need to pay attention to write your code and avoid anything that could block the tread, like synchronous network call and infinite loops.</p><ul><li>In general, in most broswer there is an event loop for every browser tab, to make every process isolated and avoid webpage with infinite loop and heavy processsing to block your entire broswer.<li>The environment manages multiple concurent event loops, to handle API call for examples. Webworker can handler multiple event loop as well<li>So you need to concerned that your code will run on a single event loop, and write code with this thing in mind to avoid blocking it.<h3 id="blocking-the-event-loop"><span class="me-2">Blocking the event loop</span><a href="#blocking-the-event-loop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Any javascript code that take long to return back control to the event loop will block the execution of any javascript code in the page, event block the UI page, and the user cannot click around, scroll page, and so on. All I/O primitive in JS are non-blocking. Network requests, filesystems operation, and so on. Being blocking is the exception, and this is why javascript is based so much on callback, and more recently on promise and async/await.</p><h3 id="the-call-stacklifo"><span class="me-2">The call stack(LIFO)</span><a href="#the-call-stacklifo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The event loop continously check the call stack to see if there’s any function that need to run. While doing so, it adds any function call it find in the call stack and executes each one in order. You know the error stack trace you might be familiar.</p><h3 id="a-simple-event-loop-explanation"><span class="me-2">A simple event loop explanation</span><a href="#a-simple-event-loop-explanation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The event loop on every iteration looks if there’s something in the call stack, and executes it until the call stack is empty. ```js const bar = () =&gt; console.log(‘bar’)</p></ul><p>const baz = () =&gt; console.log(‘baz’)</p><p>const foo = () =&gt; { console.log(‘foo’) bar() baz() }</p><p>foo()</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>### Queuing function execution
The above example looks normal, there's nothing special about it: JavaScript finds things to execute, runs them in order.
Let's see how to defer a function until the stack is clear.
The use case of setTimeout(() =&gt; {}, 0) is to call a function, but execute it once every other function in the code has executed.
```JS
const bar = () =&gt; console.log('bar')

const baz = () =&gt; console.log('baz')

const foo = () =&gt; {
  console.log('foo')
  setTimeout(bar, 0)
  baz()
}

foo()
</pre></table></code></div></div><p>When this code runs, first foo() is called. Inside foo() we first call setTimeout, passing bar as an argument, and we instruct it to run immediately as fast as it can, passing 0 as the timer. Then we call baz(). <a href="https://nodejs.dev/static/be55515b9343074d00b43de88c495331/fcda8/call-stack-second-example.png" class="popup img-link shimmer"><img src="https://nodejs.dev/static/be55515b9343074d00b43de88c495331/fcda8/call-stack-second-example.png" alt="Queue call stack function example" title="Queue call stack function example" loading="lazy"></a></p><h3 id="the-message-queue"><span class="me-2">The Message Queue</span><a href="#the-message-queue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When setTimeOut is called. Browser or Node.JS start a timer. Once the timer expire as in this case we put 0 as the timeout. The call backfunction intermediately put in the <strong>Message queue</strong>. Message queue is also where user initiated event like click, scroll, mouse or keyboard, fetch reponse before your code has opportunity to reach to them. Or also DOM event like <code class="language-plaintext highlighter-rouge">onload</code>. The loop gives the priority to the callstack, and it’s first find in the callstack, and once there’s nothing in there. Ir’s goes to pich up things in the message queue.</p><h3 id="es6-job-queue"><span class="me-2">ES6 Job Queue</span><a href="#es6-job-queue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ECMA script 2015 introduced concept of the job queue, which is used by Promise. It’s a way to execute a result of an async function as soon as posible, rather puting the end of the call stack. Promise is resole the current function ends will execute right after the function current function. Similar to a rollercoaster ride at an amusement park: the message queue puts you at the back of the queue, behind all the other people, where you will have to wait for your turn, while the job queue is the fastpass ticket that lets you take another ride right after you finished the previous one.</p><pre><code class="language-JS">const bar = () =&gt; console.log('bar')

const baz = () =&gt; console.log('baz')

const foo = () =&gt; {
  console.log('foo')
  setTimeout(bar, 0)
  new Promise((resolve, reject) =&gt;
    resolve('should be right after baz, before bar')
  ).then(resolve =&gt; console.log(resolve))
  baz()
}
foo()
</code></pre><p>That’s a big difference between Promises (and Async/await, which is built on promises) and plain old asynchronous functions through setTimeout() or other platform APIs. Finally, here’s what the call stack looks like for the example above:</p><h2 id="differences-between-nodejs-and-the-browser"><span class="me-2">Differences between Node.js and the Browser</span><a href="#differences-between-nodejs-and-the-browser" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>NodeJs give Huge advance, you can perform all your work on the web, both client and server. The confor of programming everything - the frontend and the backend in a single languages.<li>Another big difference is that in Node.js you control the environment. Unless you are building an open source application that anyone can deploy anywhere, you know which version of Node.js you will run the application on. This means that you can write all the modern ES6-7-8-9 JavaScript that your Node.js version supports.<li>Node.js supports both the CommonJS and ES module systems (since Node.js v12), while in the browser we are starting to see the ES Modules standard being implemented. This means that you can use both require() and import in Node.js, while you are limited to import in the browser.<h2 id="the-v8-javascript-engine"><span class="me-2">The V8 JavaScript Engine</span><a href="#the-v8-javascript-engine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><li>V8 is the name of the JavaScript engine that powers Google Chrome.<li>Firefox has SpiderMonkey<li>Safari has JavaScriptCore (also called Nitro)<li>Edge was originally based on Chakra but has more recently been rebuilt using Chromium and the V8 engine.<h3 id="the-quest-for-performance"><span class="me-2">The quest for performance</span><a href="#the-quest-for-performance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>V8 is written in C++, and it’s continously improved. It is portable and runs on Mac, Windows, Linux and several other systems. V8 is always evolving, just like the other javascript engines around, to speed up the Web and the Node.js ecosystem.</p><h3 id="compilation"><span class="me-2">Compilation</span><a href="#compilation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Javascript is internally compiled by V8 with <strong>just in time</strong>(JIT), and <strong>compilation</strong> to speed up the excecution.</p><h2 id="run-nodejs-scripts"><span class="me-2">Run Node.js scripts</span><a href="#run-nodejs-scripts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The usual way to run a Node.js program is to run globally available <code class="language-plaintext highlighter-rouge">node</code> command. If your main Node.js application file is <code class="language-plaintext highlighter-rouge">app.js</code>, you can call it by typing:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">chmod </span>u+x app.js
node app.js
</pre></table></code></div></div><p>The content of file <code class="language-plaintext highlighter-rouge">app.js</code> ```js #!/usr/bin/env node</p></ul><p>// your code</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>### Restart the application automatically
Install `nodemon` module
### How to exit from a Node.js program
```JS
process.exit(1);
process.exitCode = 1;
</pre></table></code></div></div><p>Another example:</p><pre><code class="language-JS">const express = require('express');

const app = express();

app.get('/', (req, res) =&gt; {
  res.send('Hi!');
});

const server = app.listen(3000, () =&gt; console.log('Server ready'));

process.on('SIGTERM', () =&gt; {
  server.close(() =&gt; {
    console.log('Process terminated');
  });
});
</code></pre><p><em><strong>Express</strong> is a framework that uses the http module under the hood, app.listen() returns an instance of http. You would use https.createServer if you needed to serve your app using HTTPS, as app.listen only uses the http module.</em></p><h3 id="nodejs-accept-arguments-from-the-command-line"><span class="me-2">Node.js, accept arguments from the command line</span><a href="#nodejs-accept-arguments-from-the-command-line" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">node app.js var_1=abc
</code></pre><h3 id="how-to-read-environment-variables-from-nodejs"><span class="me-2">How to read environment variables from Node.js</span><a href="#how-to-read-environment-variables-from-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">USER_ID=239482 USER_KEY=foobar node app.js
// process by JS
process.env.USER_ID; // "239482"
process.env.USER_KEY; // "foobar"
</code></pre><blockquote><p>Note: process does not require a “require”, it’s automatically available. If you have multiple environment variables in your node project, you can create <code class="language-plaintext highlighter-rouge">.env</code> file in the root directory of your project, and use the <code class="language-plaintext highlighter-rouge">dotenv</code> package to load them during runtime.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># .env file</span>
<span class="nv">USER_ID</span><span class="o">=</span><span class="s2">"239482"</span>
<span class="nv">USER_KEY</span><span class="o">=</span><span class="s2">"foobar"</span>
<span class="nv">NODE_ENV</span><span class="o">=</span><span class="s2">"development"</span>
</pre></table></code></div></div><p>The way you retrieve it is using the <code class="language-plaintext highlighter-rouge">process</code> object built into Node.js It exposes an <code class="language-plaintext highlighter-rouge">argv</code> property, which is an array that contains all the command line invocation arguments.</p><pre><code class="language-JS">process.argv.forEach((val, index) =&gt; {
    console.log(`${index}: ${val}`);
});
const args = require('minimist')(process.argv.slice(2));
args.name;
</code></pre><p>```JS require(‘dotenv’).config();</p></blockquote><p>process.env.USER_ID; // “239482” process.env.USER_KEY; // “foobar” process.env.NODE_ENV; // “development”</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>&gt; You can also run your js file with `node -r dotenv/config index.js` command if you don't want to import the package in your code.
You can install `minimist` package using `npm`. and when retrieve variable from nodejs use: `node app.js --name=joe`
### Output to the command line using Node.js
You can pass multiple variables to `console.log`
```JS
const x = 'x';
const y = 'y';
console.log(x, y);
console.log('My %s has %d ears', 'cat', 2);
console.clear()
const x = 1
const y = 2
const z = 3
console.count(
  'The value of x is ' + x +
  ' and has been checked .. how many times?'
)
console.count(
  'The value of x is ' + x +
  ' and has been checked .. how many times?'
)
console.count(
  'The value of y is ' + y +
  ' and has been checked .. how many times?'
)
</pre></table></code></div></div><p>Print stach trace</p><pre><code class="language-JS">function2 = () =&gt; {
    console.trace()
}
function1 = () =&gt; function2();
function1();
</code></pre><p>Output console</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>Trace
    at function2 <span class="o">(</span>repl:1:33<span class="o">)</span>
    at function1 <span class="o">(</span>repl:1:25<span class="o">)</span>
    at repl:1:1
    at ContextifyScript.Script.runInThisContext <span class="o">(</span>vm.js:44:33<span class="o">)</span>
    at REPLServer.defaultEval <span class="o">(</span>repl.js:239:29<span class="o">)</span>
    at bound <span class="o">(</span>domain.js:301:14<span class="o">)</span>
    at REPLServer.runBound <span class="o">[</span>as <span class="nb">eval</span><span class="o">]</span> <span class="o">(</span>domain.js:314:12<span class="o">)</span>
    at REPLServer.onLine <span class="o">(</span>repl.js:440:10<span class="o">)</span>
    at emitOne <span class="o">(</span>events.js:120:20<span class="o">)</span>
    at REPLServer.emit <span class="o">(</span>events.js:210:7<span class="o">)</span>
</pre></table></code></div></div><h4 id="calculate-time-spent"><span class="me-2">Calculate time spent</span><a href="#calculate-time-spent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Calculate how much time a function you take to run: time<code class="language-plaintext highlighter-rouge">time</code>, <code class="language-plaintext highlighter-rouge">timeEnd</code></p><pre><code class="language-JS">const doSomething = () =&gt; console.log('test');
const measureDoingSomething = () =&gt; {
  console.time('doSomething()');
  // do something, and measure the time it takes
  doSomething();
  console.timeEnd('doSomething()');
};
measureDoingSomething();
</code></pre><h3 id="create-a-progress-bar"><span class="me-2">Create a progress bar</span><a href="#create-a-progress-bar" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://www.npmjs.com/package/progress">Progress</a> is an awesome package that help create an progress bar in console. Installing it using <code class="language-plaintext highlighter-rouge">npm install progress</code>.</p><pre><code class="language-JS">const ProgressBar = require('progress');

const bar = new ProgressBar(':bar', { total: 10 });
const timer = setInterval(() =&gt; {
  bar.tick();
  if (bar.complete) {
    clearInterval(timer);
  }
}, 100);
</code></pre><h2 id="server-side-pagination-in-nodejs-with-sequelize--mysql"><span class="me-2">Server side Pagination in Node.js with Sequelize &amp; MySQL</span><a href="#server-side-pagination-in-nodejs-with-sequelize--mysql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Server side pagination is better for:</p><ul><li>Larger data set<li>Faster initial page load<li>Accessibility for those running javascript<li>Complex view running<h3 id="nodejs-pagination-with-sequelize-and-mysql-overview"><span class="me-2">Node.js Pagination with Sequelize and MySQL overview</span><a href="#nodejs-pagination-with-sequelize-and-mysql-overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Assume display a table below</p></ul><p><a href="https://www.bezkoder.com/wp-content/uploads/2020/06/pagination-node-js-mysql-sequelize-database-table.png" class="popup img-link shimmer"><img src="https://www.bezkoder.com/wp-content/uploads/2020/06/pagination-node-js-mysql-sequelize-database-table.png" alt="Pagination table" title="pagination table" loading="lazy"></a> Node.js Express Server will exports API for pagination (with/without filter), here are some url samples:</p><ul><li>/api/tutorials?page=1&amp;size=5<li>/api/tutorials?size=5: using default value for page<li>/api/tutorials?title=data&amp;page=1&amp;size=3: pagination &amp; filter by title containing ‘data’<li>/api/tutorials/published?page=2: pagination &amp; filter by ‘published’ status Result by json:<div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"totalItems"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tutorials"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w">
  </span><span class="nl">"totalPages"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"currentPage"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="nodejs-sequelize-for-pagination"><span class="me-2">Node.js Sequelize for Pagination</span><a href="#nodejs-sequelize-for-pagination" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Sequelize provide way to implement pagination with <code class="language-plaintext highlighter-rouge">offset</code> and <code class="language-plaintext highlighter-rouge">limit</code></p><li>offset: quantity of items to skip<li>limit: quantity of items to fetch Example:<li>{ offset: 3, limit: 2 }: skip first 3 items, fetch 4th and 5th items.<h3 id="sequelize-findall"><span class="me-2">Sequelize findAll</span><a href="#sequelize-findall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">model</span><span class="p">.</span><span class="nf">findAll</span><span class="p">({</span>
<span class="na">limit</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="na">offset</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">Op</span><span class="p">.</span><span class="nx">like</span><span class="p">]:</span> <span class="s2">`%js%`</span> <span class="p">}</span> <span class="p">},</span> <span class="c1">// conditions</span>
<span class="p">});</span>
</pre></table></code></div></div><p>The result:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
      </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bezkoder Tut#4 Rest Apis"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tut#4 Description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"published"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:07.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:07.000Z"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bezkoder Tut#5 MySQL"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tut#5 Description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"published"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:11.000Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:11.000Z"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><h3 id="sequelize-findandcountall"><span class="me-2">Sequelize findAndCountAll</span><a href="#sequelize-findandcountall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Template</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">model</span><span class="p">.</span><span class="nf">findAndCountAll</span><span class="p">({</span>
<span class="na">limit</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="na">offset</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="na">where</span><span class="p">:</span> <span class="p">{},</span> <span class="c1">// conditions</span>
<span class="p">});</span>
</pre></table></code></div></div><p>Result</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rows"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
          </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bezkoder Tut#4 Rest Apis"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tut#4 Description"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"published"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:07.000Z"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:07.000Z"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
          </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
          </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bezkoder Tut#5 MySQL"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tut#5 Description"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"published"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:11.000Z"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-06-05T11:55:11.000Z"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="setup-nodejs-express-application"><span class="me-2">Setup Node.js Express Application</span><a href="#setup-nodejs-express-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Install necessary modules: <code class="language-plaintext highlighter-rouge">express</code>, <code class="language-plaintext highlighter-rouge">sequelize</code>, <code class="language-plaintext highlighter-rouge">mysql2</code> Run the command:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm <span class="nb">install </span>express sequelize mysql2 cors <span class="nt">--save</span>
</pre></table></code></div></div><p>The Node.js project structure that we only need to add some changes to make the pagination work well. <a href="https://www.bezkoder.com/wp-content/uploads/2020/06/pagination-node-js-mysql-sequelize-project-structure.png" class="popup img-link shimmer"><img src="https://www.bezkoder.com/wp-content/uploads/2020/06/pagination-node-js-mysql-sequelize-project-structure.png" alt="Project structure" title="Project structure" loading="lazy"></a></p><h3 id="configure-mysql-database--sequelize"><span class="me-2">Configure MySQL database &amp; Sequelize</span><a href="#configure-mysql-database--sequelize" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>DB configure</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">HOST</span><span class="p">:</span> <span class="dl">"</span><span class="s2">localhost</span><span class="dl">"</span><span class="p">,</span>
<span class="na">USER</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
<span class="na">PASSWORD</span><span class="p">:</span> <span class="dl">"</span><span class="s2">123456</span><span class="dl">"</span><span class="p">,</span>
<span class="na">DB</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testdb</span><span class="dl">"</span><span class="p">,</span>
<span class="na">dialect</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mysql</span><span class="dl">"</span><span class="p">,</span>
<span class="na">pool</span><span class="p">:</span> <span class="p">{</span>
  <span class="na">max</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="na">min</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">acquire</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
  <span class="na">idle</span><span class="p">:</span> <span class="mi">10000</span>
<span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="initialize-sequelize"><span class="me-2">Initialize Sequelize</span><a href="#initialize-sequelize" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create app/models/index.js with the following code:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">dbConfig</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../config/db.config.js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">sequelize</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Sequelize</span><span class="p">(</span><span class="nx">dbConfig</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">USER</span><span class="p">,</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">PASSWORD</span><span class="p">,</span> <span class="p">{</span>
<span class="na">host</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">HOST</span><span class="p">,</span>
<span class="na">dialect</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">dialect</span><span class="p">,</span>
<span class="na">operatorsAliases</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="na">pool</span><span class="p">:</span> <span class="p">{</span>
  <span class="na">max</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span>
  <span class="na">min</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span>
  <span class="na">acquire</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">acquire</span><span class="p">,</span>
  <span class="na">idle</span><span class="p">:</span> <span class="nx">dbConfig</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">idle</span>
<span class="p">}</span>
<span class="p">});</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">Sequelize</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sequelize</span> <span class="o">=</span> <span class="nx">sequelize</span><span class="p">;</span>
</pre></table></code></div></div><p>Don’t forget to call <code class="language-plaintext highlighter-rouge">sync()</code> method in server.js</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="p">...</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(...);</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./app/models</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sequelize</span><span class="p">.</span><span class="nf">sync</span><span class="p">();</span>
<span class="cm">/*
db.sequelize.sync({ force: true }).then(() =&gt; {
console.log("Drop and re-sync db.");
});
*/</span>
<span class="p">...</span>
</pre></table></code></div></div><h3 id="create-data-model"><span class="me-2">Create Data Model</span><a href="#create-data-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In models folder, create tutorial.model.js file like this:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nx">odule</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">Sequelize</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">Tutorial</span> <span class="o">=</span> <span class="nx">sequelize</span><span class="p">.</span><span class="nf">define</span><span class="p">(</span><span class="dl">"</span><span class="s2">tutorial</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">Sequelize</span><span class="p">.</span><span class="nx">STRING</span>
  <span class="p">},</span>
  <span class="na">description</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">Sequelize</span><span class="p">.</span><span class="nx">STRING</span>
  <span class="p">},</span>
  <span class="na">published</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">Sequelize</span><span class="p">.</span><span class="nx">BOOLEAN</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="k">return</span> <span class="nx">Tutorial</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>After initializing Sequelize, we don’t need to write CRUD functions, Sequelize supports all of them. Now you can easily use following methods with pagination:</p><li>get all Tutorials: findAll({ limit, offsCreate Node.js Express API layeret })<li>find all Tutorials by title: findAll({ where: { title: … }, limit, offset })<li>find and count all Tutorials: findAndCountAll({ limit, offset })<li>find and count all Tutorials by title: findAndCountAll({ where: { title: … }, limit, offset })<h3 id="controller-with-pagination"><span class="me-2">Controller with Pagination</span><a href="#controller-with-pagination" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>So, let’s write the function to map default response to desired structure:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">getPagination</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">limit</span> <span class="o">=</span> <span class="nx">size</span> <span class="p">?</span> <span class="o">+</span><span class="nx">size</span> <span class="p">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">page</span> <span class="p">?</span> <span class="nx">page</span> <span class="o">*</span> <span class="nx">limit</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">return</span> <span class="p">{</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">offset</span> <span class="p">};</span>
<span class="p">};</span>
<span class="kd">const</span> <span class="nx">getPagingData</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="kd">const</span> <span class="p">{</span> <span class="na">count</span><span class="p">:</span> <span class="nx">totalItems</span><span class="p">,</span> <span class="na">rows</span><span class="p">:</span> <span class="nx">tutorials</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="nx">page</span> <span class="p">?</span> <span class="o">+</span><span class="nx">page</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">totalPages</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">ceil</span><span class="p">(</span><span class="nx">totalItems</span> <span class="o">/</span> <span class="nx">limit</span><span class="p">);</span>
<span class="k">return</span> <span class="p">{</span> <span class="nx">totalItems</span><span class="p">,</span> <span class="nx">tutorials</span><span class="p">,</span> <span class="nx">totalPages</span><span class="p">,</span> <span class="nx">currentPage</span> <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Now the code in tutorial.controller.js will look like this:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Tutorial</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">tutorials</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">Op</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Sequelize</span><span class="p">.</span><span class="nx">Op</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">getPagination</span> <span class="o">=</span> <span class="p">...;</span>
<span class="kd">const</span> <span class="nx">getPagingData</span> <span class="o">=</span> <span class="p">...;</span>
<span class="c1">// Retrieve all Tutorials from the database.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">findAll</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">title</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">condition</span> <span class="o">=</span> <span class="nx">title</span> <span class="p">?</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="nx">Op</span><span class="p">.</span><span class="nx">like</span><span class="p">]:</span> <span class="s2">`%</span><span class="p">${</span><span class="nx">title</span><span class="p">}</span><span class="s2">%`</span> <span class="p">}</span> <span class="p">}</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">offset</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">getPagination</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
<span class="nx">Tutorial</span><span class="p">.</span><span class="nf">findAndCountAll</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="nx">condition</span><span class="p">,</span> <span class="nx">limit</span><span class="p">,</span> <span class="nx">offset</span> <span class="p">})</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nf">getPagingData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">limit</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">send</span><span class="p">({</span>
      <span class="na">message</span><span class="p">:</span>
        <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">Some error occurred while retrieving tutorials.</span><span class="dl">"</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
<span class="c1">// find all published Tutorial</span>
</pre></table></code></div></div><h3 id="create-nodejs-express-api-layer"><span class="me-2">Create Node.js Express API layer</span><a href="#create-nodejs-express-api-layer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">tutorials</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../controllers/tutorial.controller.js</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">).</span><span class="nc">Router</span><span class="p">();</span>
<span class="c1">// Retrieve all Tutorials</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">tutorials</span><span class="p">.</span><span class="nx">findAll</span><span class="p">);</span>
<span class="c1">// Retrieve all published Tutorials</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/published</span><span class="dl">"</span><span class="p">,</span> <span class="nx">tutorials</span><span class="p">.</span><span class="nx">findAllPublished</span><span class="p">);</span>
<span class="p">...</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/tutorials</span><span class="dl">'</span><span class="p">,</span> <span class="nx">router</span><span class="p">);</span>
<span class="p">};</span>
</pre></table></code></div></div><h2 id="accept-input-from-the-command-line-in-nodejs"><span class="me-2">Accept input from the command line in Node.js</span><a href="#accept-input-from-the-command-line-in-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>readable stream such as <code class="language-plaintext highlighter-rouge">process.stdin</code> and use module <code class="language-plaintext highlighter-rouge">readline</code> to perform access input from the command line ```JS const readline = require(‘readline’).createInterface({ input: process.stdin, output: process.stdout, });</p></ul><p>readline.question(<code class="language-plaintext highlighter-rouge">What's your name?</code>, name =&gt; { console.log(<code class="language-plaintext highlighter-rouge">Hi ${name}!</code>); readline.close(); });</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>Another example to perform by `inquirer`
```js
const inquirer = require('inquirer');

const questions = [
  {
    type: 'input',
    name: 'name',
    message: "What's your name?",
  },
];

inquirer.prompt(questions).then(answers =&gt; {
  console.log(`Hi ${answers.name}!`);
});
</pre></table></code></div></div><h2 id="expose-functionality-from-a-nodejs-file-using-exports"><span class="me-2">Expose functionality from a Node.js file using exports</span><a href="#expose-functionality-from-a-nodejs-file-using-exports" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When you want to import something you use</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">library</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">.library</span><span class="dl">'</span><span class="p">)</span>
</pre></table></code></div></div><p>This is what the <code class="language-plaintext highlighter-rouge">module.exports</code> API offfered by the <code class="language-plaintext highlighter-rouge">module</code> system to allow us to do. You can do so in 2 ways</p><pre><code class="language-JS">// car.js
const car = {
  brand: 'Ford',
  model: 'Fiesta',
};

module.exports = car;
</code></pre><pre><code class="language-JS">// index.js
const car = require('./car')
</code></pre><p>The second way is to add the exported object as a property of exports. This way allows you to export multiple objects, functions or data:</p><pre><code class="language-JS">const car = {
  brand: 'Ford',
  model: 'Fiesta',
};

exports.car = car;
</code></pre><p>Or directly</p><pre><code class="language-JS">exports.car = {
  brand: 'Ford',
  model: 'Fiesta',
};
</code></pre><p>And in the other file, you’ll use it by referencing a property of your import:</p><pre><code class="language-JS">const items = require('./car');

const { car } = items;
</code></pre><p>Or you can use a destructuring assigement</p><pre><code class="language-JS">const { car } = require('./car')
</code></pre><p>Example</p><pre><code class="language-JS">// car.js
exports.car = {
  brand: 'Ford',
  model: 'Fiesta',
};

module.exports = {
  brand: 'Tesla',
  model: 'Model S',
};

// app.js
const tesla = require('./car');
const ford = require('./car').car;

console.log(tesla, ford);
</code></pre><p>This will print { brand: ‘Tesla’, model: ‘Model S’ } undefined since the require function’s return value has been updated to the object that module.exports points to, so the property that exports added can’t be accessed.</p><h2 id="an-introduction-to-the-npm-package-manager"><span class="me-2">An introduction to the npm package manager</span><a href="#an-introduction-to-the-npm-package-manager" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>npm<li>yarn<li>pnpm Install from single package Often you’ll see more flags added to this command:<li>–save-dev installs and adds the entry to the package.json file devDependencies<li>–no-save installs but does not add the entry to the package.json file dependencies<li>–save-optional installs and adds the entry to the package.json file optionalDependencies<li><p>–no-optional will prevent optional dependencies from being installed Shorthands of the flags can also be used:</p><li>-S: –save<li>-D: –save-dev<li>-O: –save-optional <strong>To Update</strong><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>npm update
npm update &lt;package-name&gt;
</pre></table></code></div></div><p>You can manage version by <code class="language-plaintext highlighter-rouge">npm</code>. Install or update package with version by command</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm <span class="nb">install</span> &lt;package-name&gt;@&lt;version&gt;
</pre></table></code></div></div><h3 id="running-tasks"><span class="me-2">Running Tasks</span><a href="#running-tasks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">npm run &lt;task-name&gt;
</code></pre><pre><code class="language-JSON">{
"scripts": {
  "watch": "webpack --watch --progress --colors --config webpack.conf.js",
  "dev": "webpack --progress --colors --config webpack.conf.js",
  "prod": "NODE_ENV=production webpack -p --config webpack.conf.js",
}
}
</code></pre><h2 id="where-does-npm-install-the-packages"><span class="me-2">Where does npm install the packages?</span><a href="#where-does-npm-install-the-packages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><li>a local install<li>a global install By default, the package is installed in the current file tree, under the node_modules subfolder. A global installation is performed using the <code class="language-plaintext highlighter-rouge">-g</code> flag<h2 id="the-packagejson-guide"><span class="me-2">The package.json guide</span><a href="#the-packagejson-guide" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The file structure of <code class="language-plaintext highlighter-rouge">package.json</code> is present in Json file</p><pre><code class="language-Json">copy
{
"name": "test-project",
"version": "1.0.0",
"description": "A Vue.js project",
"main": "src/main.js",
"private": true,
"scripts": {
  "dev": "webpack-dev-server --inline --progress --config build/webpack.dev.conf.js",
  "start": "npm run dev",
  "unit": "jest --config test/unit/jest.conf.js --coverage",
  "test": "npm run unit",
  "lint": "eslint --ext .js,.vue src test/unit",
  "build": "node build/build.js"
},
"dependencies": {
  "vue": "^2.5.2"
},
"devDependencies": {
  "autoprefixer": "^7.1.2",
  "babel-core": "^6.22.1",
  "babel-eslint": "^8.2.1",
  "babel-helper-vue-jsx-merge-props": "^2.0.3",
  "babel-jest": "^21.0.2",
  "babel-loader": "^7.1.1",
  "babel-plugin-dynamic-import-node": "^1.2.0",
  "babel-plugin-syntax-jsx": "^6.18.0",
  "babel-plugin-transform-es2015-modules-commonjs": "^6.26.0",
  "babel-plugin-transform-runtime": "^6.22.0",
  "babel-plugin-transform-vue-jsx": "^3.5.0",
  "babel-preset-env": "^1.3.2",
  "babel-preset-stage-2": "^6.22.0",
  "chalk": "^2.0.1",
  "copy-webpack-plugin": "^4.0.1",
  "css-loader": "^0.28.0",
  "eslint": "^4.15.0",
  "eslint-config-airbnb-base": "^11.3.0",
  "eslint-friendly-formatter": "^3.0.0",
  "eslint-import-resolver-webpack": "^0.8.3",
  "eslint-loader": "^1.7.1",
  "eslint-plugin-import": "^2.7.0",
  "eslint-plugin-vue": "^4.0.0",
  "extract-text-webpack-plugin": "^3.0.0",
  "file-loader": "^1.1.4",
  "friendly-errors-webpack-plugin": "^1.6.1",
  "html-webpack-plugin": "^2.30.1",
  "jest": "^22.0.4",
  "jest-serializer-vue": "^0.3.0",
  "node-notifier": "^5.1.2",
  "optimize-css-assets-webpack-plugin": "^3.2.0",
  "ora": "^1.2.0",
  "portfinder": "^1.0.13",
  "postcss-import": "^11.0.0",
  "postcss-loader": "^2.0.8",
  "postcss-url": "^7.2.1",
  "rimraf": "^2.6.0",
  "semver": "^5.3.0",
  "shelljs": "^0.7.6",
  "uglifyjs-webpack-plugin": "^1.1.1",
  "url-loader": "^0.5.8",
  "vue-jest": "^1.0.2",
  "vue-loader": "^13.3.0",
  "vue-style-loader": "^3.0.1",
  "vue-template-compiler": "^2.5.2",
  "webpack": "^3.6.0",
  "webpack-bundle-analyzer": "^2.9.0",
  "webpack-dev-server": "^2.9.1",
  "webpack-merge": "^4.1.0"
},
"engines": {
  "node": "&gt;= 6.0.0",
  "npm": "&gt;= 3.0.0"
},
"browserslist": ["&gt; 1%", "last 2 versions", "not ie &lt;= 8"]
}
</code></pre><p>There are lots of things going on here:</p><li>version indicates the current version<li>name sets the application/package name<li>description is a brief description of the app/package<li>main sets the entry point for the application<li>private if set to true prevents the app/package to be accidentally published on npm<li>scripts defines a set of node scripts you can run<li>dependencies sets a list of npm packages installed as dependencies<li>devDependencies sets a list of npm packages installed as development dependencies<li>engines sets which versions of Node.js this package/app works on<li>browserslist is used to tell which browsers (and their versions) you want to support<h2 id="the-package-lockjson-file"><span class="me-2">The package-lock.json file</span><a href="#the-package-lockjson-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The goal of <code class="language-plaintext highlighter-rouge">package-lock.json</code> file is to keep track of the exact version of every package that is installed so that a product is 100% reproducible in the same way even if packages are updated by their maintainers.</p><h2 id="find-the-installed-version-of-an-npm-package"><span class="me-2">Find the installed version of an npm package</span><a href="#find-the-installed-version-of-an-npm-package" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To see the version of all installed npm packages, including their dependencies</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm list
</pre></table></code></div></div><p>for example</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>❯ npm list
/Users/joe/dev/node/cowsay
└─┬ cowsay@1.3.1
├── get-stdin@5.0.1
├─┬ optimist@0.6.1
│ ├── minimist@0.0.10
│ └── wordwrap@0.0.3
├─┬ string-width@2.1.1
│ ├── is-fullwidth-code-point@2.0.0
│ └─┬ strip-ansi@4.0.0
│   └── ansi-regex@3.0.0
└── strip-eof@1.0.0
</pre></table></code></div></div><p>To get only your top-level packages (basically, the ones you told npm to install and you listed in the package.json), run npm list –depth=0:</p><h2 id="install-an-older-version-of-an-npm-package"><span class="me-2">Install an older version of an npm package</span><a href="#install-an-older-version-of-an-npm-package" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You might also be interested in listing all the previous versions of a package. You can do it with npm view<package> versions: ```bash ❯ npm view cowsay versions</package></p></ul><p>[ ‘1.0.0’, ‘1.0.1’, ‘1.0.2’, ‘1.0.3’, ‘1.1.0’, ‘1.1.1’, ‘1.1.2’, ‘1.1.3’, ‘1.1.4’, ‘1.1.5’, ‘1.1.6’, ‘1.1.7’, ‘1.1.8’, ‘1.1.9’, ‘1.2.0’, ‘1.2.1’, ‘1.3.0’, ‘1.3.1’ ]</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Install package
```bash
npm install &lt;package&gt;@&lt;version&gt;
</pre></table></code></div></div><h2 id="semantic-versioning-using-npm"><span class="me-2">Semantic Versioning using npm</span><a href="#semantic-versioning-using-npm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>All versions have 3 digits: x.y.z</p><ul><li>the first digit is the major version<li>the second digit is the minor version<li>the third digit is the patch version <strong>Let’s see those rules in detail</strong>:<li>^: It will only do updates that do not change the leftmost non-zero number i.e there can be changes in minor version or patch version but not in major version. If you write ^13.1.0, when running npm update, it can update to 13.2.0, 13.3.0 even 13.3.1, 13.3.2 and so on, but not to 14.0.0 or above.<li>~: if you write ~0.13.0 when running npm update it can update to patch releases: 0.13.1 is ok, but 0.14.0 is not.<li>&gt;: you accept any version higher than the one you specify<li>&gt;=: you accept any version equal to or higher than the one you specify<li>&lt;=: you accept any version equal or lower to the one you specify<li>&lt;: you accept any version lower than the one you specify<li>=: you accept that exact version<li>-: you accept a range of versions. Example: 2.1.0 - 2.6.2<li><div class="table-wrapper"><table><tbody><tr><td> <td>: you combine sets. Example: &lt; 2.1<td> <td>&gt; 2.6</table></div><li>no symbol: you accept only that specific version you specify (1.2.1)<li>latest: you want to use the latest version available<h2 id="uninstalling-npm-packages"><span class="me-2">Uninstalling npm packages</span><a href="#uninstalling-npm-packages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nx">npm</span> <span class="nx">uninstall</span> <span class="o">&lt;</span><span class="kr">package</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
<span class="nx">npm</span> <span class="nx">uninstall</span> <span class="o">-</span><span class="nx">g</span> <span class="o">&lt;</span><span class="kr">package</span><span class="o">-</span><span class="nx">name</span><span class="o">&gt;</span>
</pre></table></code></div></div><h2 id="npm-global-or-local-packages"><span class="me-2">npm global or local packages</span><a href="#npm-global-or-local-packages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In your code you can only require local packages:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">package-name</span><span class="dl">'</span><span class="p">)</span>
</pre></table></code></div></div><p>A package should be installed globally when it provides an executable command that you run from the shell (CLI), and it’s reused across projects. Great examples of popular global packages which you might know are</p><li>npm<li>vue-cli<li>grunt-cli<li>mocha<li>react-native-cli<li>gatsby-cli<li>forever<li>nodemon You probably have some packages installed globally already on your system. You can see them by running<div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm list <span class="nt">-g</span> <span class="nt">--depth</span> 0
</pre></table></code></div></div><h2 id="npm-dependencies-and-devdependencies"><span class="me-2">npm dependencies and devDependencies</span><a href="#npm-dependencies-and-devdependencies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When you install an npm package, you are installing it as a dependency. When you install with option <code class="language-plaintext highlighter-rouge">--save-dev</code>, you are installing it as a development dependency. development dependencies are intended as development-only packages, that are unneeded in production. So when you run comman <code class="language-plaintext highlighter-rouge">npm install</code> in production you should need include flag <code class="language-plaintext highlighter-rouge">production</code> such as <code class="language-plaintext highlighter-rouge">npm install --production</code>.</p><h2 id="the-npx-nodejs-package-runner"><span class="me-2">The npx Node.js Package Runner</span><a href="#the-npx-nodejs-package-runner" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>npm allow you to run that npm command without installing it first. If the command isn’t found, <code class="language-plaintext highlighter-rouge">npx</code> will install it into a central cache</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npx cowsay <span class="s2">"Hello"</span>
</pre></table></code></div></div><p>Now, this is a funny useless command. Other scenarios include:</p><li>running the vue CLI tool to create new applications and run them: npx @vue/cli create my-vue-app<li>creating a new React app using create-react-app: npx create-react-app my-react-app<h3 id="run-some-code-using-a-different-nodejs-version"><span class="me-2">Run some code using a different Node.js version</span><a href="#run-some-code-using-a-different-nodejs-version" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>npx node@10 <span class="nt">-v</span> <span class="c">#v10.18.1</span>
npx node@12 <span class="nt">-v</span> <span class="c">#v12.14.1</span>
</pre></table></code></div></div><h3 id="run-arbitrary-code-snippets-directly-from-a-url"><span class="me-2">Run arbitrary code snippets directly from a URL</span><a href="#run-arbitrary-code-snippets-directly-from-a-url" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npx https://gist.github.com/zkat/4bc19503fe9e9309e2bfaa2c58074d32
</pre></table></code></div></div><h2 id="understanding-processnexttick"><span class="me-2">Understanding process.nextTick()</span><a href="#understanding-processnexttick" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Every time the event loop takes a full trip, we call it a tick.</p><pre><code class="language-JS">process.nextTick(() =&gt; {
// do something
});
</code></pre><p>The event loop is busy to run the current code. When this operation ends, the JS engine runs all the functions passed to <code class="language-plaintext highlighter-rouge">nextTick</code> calls during that operation. It the way we can tell the JS engine to process a function asynchronously, but as soon as possible, not queue it. Calling <code class="language-plaintext highlighter-rouge">setTimeout(() =&gt; {}, 0)</code> will execute the function at the end of <code class="language-plaintext highlighter-rouge">next tick</code>, much later than when using <code class="language-plaintext highlighter-rouge">nextTick()</code> which <strong>prioritizes</strong> the call and executes it just before the beginning of <strong>the next tick</strong>.</p></ul><p>Use nextTick() when you want to make sure that in <strong>the next event loop</strong> iteration that code is already executed.</p><h2 id="understanding-setimmediate"><span class="me-2">Understanding setImmediate()</span><a href="#understanding-setimmediate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Any function passed as the setImmediate() argument is a callback that’s executed in the next iteration of the event loop. How is setImmediate() different from setTimeout(() =&gt; {}, 0) (passing a 0ms timeout), and from process.nextTick() and Promise.then()? A function passed to process.nextTick() is going to be executed on the current iteration of the event loop, after the current operation ends. This means it will always execute before setTimeout and setImmediate. A <code class="language-plaintext highlighter-rouge">setTimeout()</code> callback with a 0ms delay is very similar to <code class="language-plaintext highlighter-rouge">setImmediate</code>. The execution order will depend on various factors, but they will be both run in the next iteration of the event loop. A <code class="language-plaintext highlighter-rouge">process.nextTick</code> callback is added to <code class="language-plaintext highlighter-rouge">process.nextTick queue</code>. A <code class="language-plaintext highlighter-rouge">Promise.then()</code> callback is added to <code class="language-plaintext highlighter-rouge">promise.microtask queue</code>. A <code class="language-plaintext highlighter-rouge">setTimeou</code>, <code class="language-plaintext highlighter-rouge">setImmediate</code> callback is added to <code class="language-plaintext highlighter-rouge">macrotask queue</code></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">baz</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">zoo</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">zoo</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">);</span>
  <span class="nf">setImmediate</span><span class="p">(</span><span class="nx">baz</span><span class="p">);</span>
  <span class="k">new</span> <span class="nc">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nf">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}).</span><span class="nf">then</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">resolve</span><span class="p">);</span>
    <span class="nx">process</span><span class="p">.</span><span class="nf">nextTick</span><span class="p">(</span><span class="nx">zoo</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">process</span><span class="p">.</span><span class="nf">nextTick</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
<span class="p">};</span>
<span class="nf">start</span><span class="p">();</span>
<span class="c1">// start foo bar zoo baz</span>
</pre></table></code></div></div><p>This code will first call start(), then call foo() in process.nextTick queue. After that, it will handle promises microtask queue, which prints bar and adds zoo() in process.nextTick queue at the same time. Then it will call zoo() which has just been added. In the end, the baz() in macrotask queue is called.</p><h2 id="the-nodejs-event-emitter"><span class="me-2">The Node.js Event emitter</span><a href="#the-nodejs-event-emitter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>On the backend side, Node.js offers us the option to build a similar system using <code class="language-plaintext highlighter-rouge">event</code> module. This module, inparticular, offers the <code class="language-plaintext highlighter-rouge">EventEmitter</code> class, which we’ll use to handle our events. You initializa that using</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">eventEmitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventEmitter</span><span class="p">();</span>
</pre></table></code></div></div><p>This object exposes, among many others, the <code class="language-plaintext highlighter-rouge">on</code> and <code class="language-plaintext highlighter-rouge">emit</code> methods.</p><ul><li><code class="language-plaintext highlighter-rouge">emit</code> is used to trigger an event<li><code class="language-plaintext highlighter-rouge">on</code> is used to add a callback function that’s going to be executed when the event is triggered. For example, let’s create a <code class="language-plaintext highlighter-rouge">start</code> event, and as a matter of providing a sample, we react to that by just logging to the console:<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">eventEmitter</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">started</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><p>When we run</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">eventEmitter</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">start</span><span class="dl">'</span><span class="p">);</span>
</pre></table></code></div></div><p>You can pass argument to the event handler by passing them as additional argument to <code class="language-plaintext highlighter-rouge">emit</code> ```js eventEmitter.on(‘start’, (start, end) =&gt; { console.log(<code class="language-plaintext highlighter-rouge">started from ${start} to ${end}</code>); });</p></ul><p>eventEmitter.emit(‘start’, 1, 100);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>The EventEmitter object also exposes several other methods to interact with events, like

- once(): add a one-time listener
- removeListener() / off(): remove an event listener from an event
- removeAllListeners(): remove all listeners for an event.

References [docs](https://nodejs.org/api/events.html)
## REST API Development with Node.js, Express, and MongoDB
Tutorial basic to help create a rest api framework with node.js by express and mongodb using JavaScript ES2015. References to [github project](https://github.com/maitraysuthar/rest-api-nodejs-mongodb)
### Software Requirements
- Node.js 8+
- MongoDB 3.6+ (Recommended 4+)
### How to install
- b1
```sh
git clone https://github.com/maitraysuthar/rest-api-nodejs-mongodb.git
</pre></table></code></div></div><ul><li>b2<div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">cd </span>rest-api-nodejs-mongodb
npm <span class="nb">install</span>
</pre></table></code></div></div><li>b3 Setting up environments<ol><li>You will find a file named .env.example on root directory of project.<li>Create a new file by copying and pasting the file and then renaming it to just .env<div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cp</span> .env.example .env
</pre></table></code></div></div><li>The file .env is already ignored, so you never commit your credentials.<li>Change the values of the file to your environment. Helpful comments added to .env.example file to understand the constants.<h4 id="project-structure"><span class="me-2">Project structure</span><a href="#project-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nb">.</span>
├── app.js
├── package.json
├── bin
│   └── www
├── controllers
│   ├── AuthController.js
│   └── BookController.js
├── models
│   ├── BookModel.js
│   └── UserModel.js
├── routes
│   ├── api.js
│   ├── auth.js
│   └── book.js
├── middlewares
│   ├── jwt.js
├── helpers
│   ├── apiResponse.js
│   ├── constants.js
│   ├── mailer.js
│   └── utility.js
├── <span class="nb">test</span>
│   ├── testConfig.js
│   ├── auth.js
│   └── book.js
└── public
  ├── index.html
  └── stylesheets
   └── style.css
</pre></table></code></div></div></ol><li>b5: Running API server locally<div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm run dev
</pre></table></code></div></div><h4 id="integration"><span class="me-2">Integration</span><a href="#integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><li>Write new model: If you need to add more models to the project just create a new file in <code class="language-plaintext highlighter-rouge">/models/</code> and use them in the controllers.<li>Creating new routes: If you need to add more routes to the project just create a new file in <code class="language-plaintext highlighter-rouge">/routes/</code> and add it in <code class="language-plaintext highlighter-rouge">/routes/api.js</code> it will be loaded dynamically.<li>Creating new controllers: If you need to add more controllers to the project just create a new file in <code class="language-plaintext highlighter-rouge">/controllers/</code> and use them in the routes.<h4 id="running-test-cases"><span class="me-2">Running Test Cases</span><a href="#running-test-cases" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Running Eslint</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm run lint
</pre></table></code></div></div><h3 id="prequise"><span class="me-2">Prequise</span><a href="#prequise" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><li>npm<li>Express JS<li>Mongo DB<li>Rest API integrate Authentication and CRUD package.json example package manage installed<div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rest-api-nodejs-mongodb"</span><span class="p">,</span><span class="w">
</span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
</span><span class="nl">"private"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node ./bin/www"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nodemon ./bin/www"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nyc _mocha --timeout 10000 --exit --report lcovonly -- -R spec"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eslint --fix --config .eslintrc.json </span><span class="se">\"</span><span class="s2">**/*.js</span><span class="se">\"</span><span class="s2">"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"bcrypt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.0.6"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"codacy-coverage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.4.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cookie-parser"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~1.4.3"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cors"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.8.5"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"debug"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~2.6.9"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dotenv"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^8.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~4.16.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"express-jwt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5.3.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"express-validator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"jsonwebtoken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^8.5.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"mocha-lcov-reporter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.3.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"moment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.24.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"mongoose"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5.7.6"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"morgan"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~1.9.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nodemailer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.3.1"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"chai"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.2.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"chai-http"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.3.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"eslint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.5.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"mocha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.2.2"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nodemon"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.19.4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nyc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^14.1.1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h3 id="authentication"><span class="me-2">Authentication</span><a href="#authentication" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>NodeJs package <code class="language-plaintext highlighter-rouge">express</code> is popular package help to create server.</p><h4 id="jwt"><span class="me-2">JWT</span><a href="#jwt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>```js const jwt = require(“express-jwt”); const secret = process.env.JWT_SECRET;</p></ul><p>const authenticate = jwt({ secret: secret });</p><p>module.exports = authenticate;</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>The mechanism of authentication when user register or login into server that user will receive a token was generated by server in response to user. To generate token by JWT, nodejs provide a package `express-jwt`.
Both `JWT_SECRET` and `JWT_TIMEOUT_DURATION` variable is configure in `.env` file.
</pre></table></code></div></div><p>MONGODB_URL=mongodb://127.0.0.1:27017/rest-api-nodejs-mongodb</p><h1 id="example-connection-string-">Example Connection String:-</h1><h1 id="mongodb12700127017rest-api-nodejs-mongodb">mongodb://127.0.0.1:27017/rest-api-nodejs-mongodb</h1><h1 id="mongodbmongodbhostportdatabasename">mongodb://[MongodbHost]:[PORT]/[DatabaseName]</h1><p>JWT_SECRET=abcdefghijklmnopqrstuvwxyz1234567890</p><h1 id="example-secret---abcdefghijklmnopqrstuvwxyz1234567890">Example Secret:- abcdefghijklmnopqrstuvwxyz1234567890</h1><p>JWT_TIMEOUT_DURATION=”2 hours”</p><h1 id="you-can-place-duration-available-here-httpsgithubcomauth0node-jsonwebtokenusage">You can place duration available here: https://github.com/auth0/node-jsonwebtoken#usage</h1><h1 id="search-for-expiresin-option-on-above-link">Search for “expiresIn” option on above link.</h1><p>EMAIL_SMTP_HOST=YourSMTPHost EMAIL_SMTP_PORT=YourSMTPPort EMAIL_SMTP_USERNAME=YourSMTPUsername EMAIL_SMTP_PASSWORD=YourSMTPPassword</p><h1 id="true-for-465-false-for-other-ports">true for 465, false for other ports</h1><p>EMAIL_SMTP_SECURE=false</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>#### Router
create file `auth.js` inside `routes` folder with content:
```js
var express = require("express");
const AuthController = require("../controllers/AuthController");

var router = express.Router();

router.post("/register", AuthController.register);
router.post("/login", AuthController.login);
router.post("/verify-otp", AuthController.verifyConfirm);
router.post("/resend-verify-otp", AuthController.resendConfirmOtp);

module.exports = router;
</pre></table></code></div></div><ul><li>Import <code class="language-plaintext highlighter-rouge">express</code> module and controller <code class="language-plaintext highlighter-rouge">AuthController</code><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">AuthController</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../controllers/AuthController</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><li>Router apis: <code class="language-plaintext highlighter-rouge">register</code>, <code class="language-plaintext highlighter-rouge">login</code>, <code class="language-plaintext highlighter-rouge">verify-otp</code>, ‘resend-verify-otp’. Such apis was require package <code class="language-plaintext highlighter-rouge">nodemailer</code> and variable configure in <code class="language-plaintext highlighter-rouge">.env</code>.</ul><p><strong>index serve</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nc">Router</span><span class="p">();</span>

<span class="cm">/* GET home page. */</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="dl">"</span><span class="s2">index</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Express</span><span class="dl">"</span> <span class="p">});</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</pre></table></code></div></div><p><strong>api router</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">authRouter</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./auth</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bookRouter</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./book</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">/auth/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">authRouter</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">/book/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bookRouter</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
</pre></table></code></div></div><p><strong>book router</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">BookController</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../controllers/BookController</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nc">Router</span><span class="p">();</span>

<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BookController</span><span class="p">.</span><span class="nx">bookList</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BookController</span><span class="p">.</span><span class="nx">bookDetail</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BookController</span><span class="p">.</span><span class="nx">bookStore</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BookController</span><span class="p">.</span><span class="nx">bookUpdate</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/:id</span><span class="dl">"</span><span class="p">,</span> <span class="nx">BookController</span><span class="p">.</span><span class="nx">bookDelete</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</pre></table></code></div></div><h4 id="authcontroller"><span class="me-2">AuthController</span><a href="#authcontroller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">UserModel</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models/UserModel</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">body</span><span class="p">,</span><span class="nx">validationResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">sanitizeBody</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">//helper file to prepare responses.</span>
<span class="kd">const</span> <span class="nx">apiResponse</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/apiResponse</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">utility</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/utility</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">bcrypt</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">jsonwebtoken</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">mailer</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/mailer</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">constants</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/constants</span><span class="dl">"</span><span class="p">);</span>

<span class="cm">/**
 * User registration.
 *
 * @param {string}      firstName
 * @param {string}      lastName
 * @param {string}      email
 * @param {string}      password
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// Validate fields.</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">First name must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isAlphanumeric</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">First name has non-alphanumeric characters.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Last name must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isAlphanumeric</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Last name has non-alphanumeric characters.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">).</span><span class="nf">custom</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">email</span> <span class="p">:</span> <span class="nx">value</span><span class="p">}).</span><span class="nf">then</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">E-mail already in use</span><span class="dl">"</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password must be 6 characters or greater.</span><span class="dl">"</span><span class="p">),</span>
    <span class="c1">// Sanitize fields.</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="c1">// Process request after validation and sanitization.</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// Extract the validation errors from a request.</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="c1">// Display sanitized values/errors messages.</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="c1">//hash input password</span>
                <span class="nx">bcrypt</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// generate OTP for confirmation</span>
                    <span class="kd">let</span> <span class="nx">otp</span> <span class="o">=</span> <span class="nx">utility</span><span class="p">.</span><span class="nf">randomNumber</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
                    <span class="c1">// Create User object with escaped and trimmed data</span>
                    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserModel</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="na">firstName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                            <span class="na">lastName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                            <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                            <span class="na">password</span><span class="p">:</span> <span class="nx">hash</span><span class="p">,</span>
                            <span class="na">confirmOTP</span><span class="p">:</span> <span class="nx">otp</span>
                        <span class="p">}</span>
                    <span class="p">);</span>
                    <span class="c1">// Html email body</span>
                    <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;p&gt;Please Confirm your Account.&lt;/p&gt;&lt;p&gt;OTP: </span><span class="dl">"</span><span class="o">+</span><span class="nx">otp</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/p&gt;</span><span class="dl">"</span><span class="p">;</span>
                    <span class="c1">// Send confirmation email</span>
                    <span class="nx">mailer</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span>
                        <span class="nx">constants</span><span class="p">.</span><span class="nx">confirmEmails</span><span class="p">.</span><span class="k">from</span><span class="p">,</span>
                        <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                        <span class="dl">"</span><span class="s2">Confirm Account</span><span class="dl">"</span><span class="p">,</span>
                        <span class="nx">html</span>
                    <span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="c1">// Save user.</span>
                        <span class="nx">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
                            <span class="kd">let</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="na">_id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
                                <span class="na">firstName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                                <span class="na">lastName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                                <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span>
                            <span class="p">};</span>
                            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Registration Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
                        <span class="p">});</span>
                    <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">err</span><span class="p">);</span>
                    <span class="p">})</span> <span class="p">;</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>

<span class="cm">/**
 * User login.
 *
 * @param {string}      email
 * @param {string}      password
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password must be specified.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">}).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">//Compare given password with db's hash.</span>
                        <span class="nx">bcrypt</span><span class="p">.</span><span class="nf">compare</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">same</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">same</span><span class="p">){</span>
                                <span class="c1">//Check account confirmation.</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
                                    <span class="c1">// Check User's account active or not.</span>
                                    <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="kd">let</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="na">_id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
                                            <span class="na">firstName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                                            <span class="na">lastName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                                            <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                                        <span class="p">};</span>
                                        <span class="c1">//Prepare JWT token for authentication</span>
                                        <span class="kd">const</span> <span class="nx">jwtPayload</span> <span class="o">=</span> <span class="nx">userData</span><span class="p">;</span>
                                        <span class="kd">const</span> <span class="nx">jwtData</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="na">expiresIn</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_TIMEOUT_DURATION</span><span class="p">,</span>
                                        <span class="p">};</span>
                                        <span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">;</span>
                                        <span class="c1">//Generated JWT token with Payload and secret.</span>
                                        <span class="nx">userData</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">jwtPayload</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">jwtData</span><span class="p">);</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Login Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
                                    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account is not active. Please contact admin.</span><span class="dl">"</span><span class="p">);</span>
                                    <span class="p">}</span>
                                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account is not confirmed. Please confirm your account.</span><span class="dl">"</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email or Password wrong.</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email or Password wrong.</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>

<span class="cm">/**
 * Verify Confirm otp.
 *
 * @param {string}      email
 * @param {string}      otp
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">verifyConfirm</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">otp</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">OTP must be specified.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">otp</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">};</span>
                <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">//Check already confirm or not.</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
                            <span class="c1">//Check account confirmation.</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">confirmOTP</span> <span class="o">==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">otp</span><span class="p">){</span>
                                <span class="c1">//Update user as confirmed</span>
                                <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOneAndUpdate</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">{</span>
                                    <span class="na">isConfirmed</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="na">confirmOTP</span><span class="p">:</span> <span class="kc">null</span>
                                <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
                                <span class="p">});</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Account confirmed success.</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Otp does not match</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account already confirmed.</span><span class="dl">"</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Specified email not found.</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>

<span class="cm">/**
 * Resend Confirm otp.
 *
 * @param {string}      email
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">resendConfirmOtp</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">};</span>
                <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">//Check already confirm or not.</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
                            <span class="c1">// Generate otp</span>
                            <span class="kd">let</span> <span class="nx">otp</span> <span class="o">=</span> <span class="nx">utility</span><span class="p">.</span><span class="nf">randomNumber</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
                            <span class="c1">// Html email body</span>
                            <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;p&gt;Please Confirm your Account.&lt;/p&gt;&lt;p&gt;OTP: </span><span class="dl">"</span><span class="o">+</span><span class="nx">otp</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/p&gt;</span><span class="dl">"</span><span class="p">;</span>
                            <span class="c1">// Send confirmation email</span>
                            <span class="nx">mailer</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span>
                                <span class="nx">constants</span><span class="p">.</span><span class="nx">confirmEmails</span><span class="p">.</span><span class="k">from</span><span class="p">,</span>
                                <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                                <span class="dl">"</span><span class="s2">Confirm Account</span><span class="dl">"</span><span class="p">,</span>
                                <span class="nx">html</span>
                            <span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                                <span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                                <span class="nx">user</span><span class="p">.</span><span class="nx">confirmOTP</span> <span class="o">=</span> <span class="nx">otp</span><span class="p">;</span>
                                <span class="c1">// Save user.</span>
                                <span class="nx">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
                                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Confirm otp sent.</span><span class="dl">"</span><span class="p">);</span>
                                <span class="p">});</span>
                            <span class="p">});</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account already confirmed.</span><span class="dl">"</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Specified email not found.</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></table></code></div></div><ul><li>ExpressJs support MVC architechture, In controller have actions provide authen such as <code class="language-plaintext highlighter-rouge">register</code>, <code class="language-plaintext highlighter-rouge">login</code>, <code class="language-plaintext highlighter-rouge">confirmOTP</code>, <code class="language-plaintext highlighter-rouge">resendConfirm</code><li>Model <code class="language-plaintext highlighter-rouge">UserModel</code> store and query data from mongoDB.<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">UserModel</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models/UserModel</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">body</span><span class="p">,</span><span class="nx">validationResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">sanitizeBody</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">//helper file to prepare responses.</span>
<span class="kd">const</span> <span class="nx">apiResponse</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/apiResponse</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">utility</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/utility</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">bcrypt</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">jsonwebtoken</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">mailer</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/mailer</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">constants</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/constants</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><li>Validation package <code class="language-plaintext highlighter-rouge">express-validator</code> take the <code class="language-plaintext highlighter-rouge">body</code> and <code class="language-plaintext highlighter-rouge">validation</code> module<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>  <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">First name must be specified.</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">isAlphanumeric</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">First name has non-alphanumeric characters.</span><span class="dl">"</span><span class="p">),</span>
  <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Last name must be specified.</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">isAlphanumeric</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Last name has non-alphanumeric characters.</span><span class="dl">"</span><span class="p">),</span>
  <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">).</span><span class="nf">custom</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">email</span> <span class="p">:</span> <span class="nx">value</span><span class="p">}).</span><span class="nf">then</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
              <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">E-mail already in use</span><span class="dl">"</span><span class="p">);</span>
              <span class="p">}</span>
          <span class="p">});</span>
      <span class="p">}),</span>
  <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password must be 6 characters or greater.</span><span class="dl">"</span><span class="p">)</span>
</pre></table></code></div></div><li>Each line is element of array impement by <code class="language-plaintext highlighter-rouge">export</code> function. Express will run through each element and store variable in memory and same stack. The validation, The request parameter, The process element, so on.<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
          <span class="c1">// Extract the validation errors from a request.</span>
          <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
          <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
              <span class="c1">// Display sanitized values/errors messages.</span>
              <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
          <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
              <span class="c1">//hash input password</span>
              <span class="nx">bcrypt</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
                  <span class="c1">// generate OTP for confirmation</span>
                  <span class="kd">let</span> <span class="nx">otp</span> <span class="o">=</span> <span class="nx">utility</span><span class="p">.</span><span class="nf">randomNumber</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
                  <span class="c1">// Create User object with escaped and trimmed data</span>
                  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserModel</span><span class="p">(</span>
                      <span class="p">{</span>
                          <span class="na">firstName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                          <span class="na">lastName</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                          <span class="na">email</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                          <span class="na">password</span><span class="p">:</span> <span class="nx">hash</span><span class="p">,</span>
                          <span class="na">confirmOTP</span><span class="p">:</span> <span class="nx">otp</span>
                      <span class="p">}</span>
                  <span class="p">);</span>
                  <span class="c1">// Html email body</span>
                  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;p&gt;Please Confirm your Account.&lt;/p&gt;&lt;p&gt;OTP: </span><span class="dl">"</span><span class="o">+</span><span class="nx">otp</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/p&gt;</span><span class="dl">"</span><span class="p">;</span>
                  <span class="c1">// Send confirmation email</span>
                  <span class="nx">mailer</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span>
                      <span class="nx">constants</span><span class="p">.</span><span class="nx">confirmEmails</span><span class="p">.</span><span class="k">from</span><span class="p">,</span>
                      <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                      <span class="dl">"</span><span class="s2">Confirm Account</span><span class="dl">"</span><span class="p">,</span>
                      <span class="nx">html</span>
                  <span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                      <span class="c1">// Save user.</span>
                      <span class="nx">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                          <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
                          <span class="kd">let</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
                              <span class="na">_id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
                              <span class="na">firstName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                              <span class="na">lastName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                              <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span>
                          <span class="p">};</span>
                          <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Registration Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
                      <span class="p">});</span>
                  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                      <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
                      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">err</span><span class="p">);</span>
                  <span class="p">})</span> <span class="p">;</span>
              <span class="p">});</span>
          <span class="p">}</span>
      <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">//throw error in json response with status 500.</span>
          <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></table></code></div></div><li>code inside is same with JS code. After validation, the action <code class="language-plaintext highlighter-rouge">register</code> move to process logic register with user attribute save to DB. A mail send to user when sucessful saved. Try catch for unexpected errors:<li><code class="language-plaintext highlighter-rouge">bcrypt</code> module for hash password and this is a function js in ECMASCRIPT 2015<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nx">bcrypt</span><span class="p">.</span><span class="nf">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span> <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">err</span><span class="p">);</span>
<span class="p">})</span> <span class="p">;</span>
</pre></table></code></div></div><li><code class="language-plaintext highlighter-rouge">(req, res)</code> is object request and response and parameters of function <code class="language-plaintext highlighter-rouge">register</code>. Response send to user<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// sucess</span>
<span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Registration Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
<span class="c1">// error</span>
<span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">err</span><span class="p">);</span>
</pre></table></code></div></div><li>About the api resonpose structure in json format and js code, used <code class="language-plaintext highlighter-rouge">jsonwebtoken</code> and <code class="language-plaintext highlighter-rouge">express-jwt</code> module for generate token and authentication user request. ```js exports.successResponse = function (res, msg) { var data = { status: 1, message: msg }; return res.status(200).json(data); };</ul><p>exports.successResponseWithData = function (res, msg, data) { var resData = { status: 1, message: msg, data: data }; return res.status(200).json(resData); };</p><p>exports.ErrorResponse = function (res, msg) { var data = { status: 0, message: msg, }; return res.status(500).json(data); };</p><p>exports.notFoundResponse = function (res, msg) { var data = { status: 0, message: msg, }; return res.status(404).json(data); };</p><p>exports.validationErrorWithData = function (res, msg, data) { var resData = { status: 0, message: msg, data: data }; return res.status(400).json(resData); };</p><p>exports.unauthorizedResponse = function (res, msg) { var data = { status: 0, message: msg, }; return res.status(401).json(data); };</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>- Register function is trigger a procedure send email to user register with otp in a email, after email register and confirm otp send a user register save to db and api response register api send to user
```js
mailer.send(
                        constants.confirmEmails.from,
                        req.body.email,
                        "Confirm Account",
                        html
                    ).then(function(){
                        // Save user.
                        user.save(function (err) {
                            if (err) { return apiResponse.ErrorResponse(res, err); }
                            let userData = {
                                _id: user._id,
                                firstName: user.firstName,
                                lastName: user.lastName,
                                email: user.email
                            };
                            return apiResponse.successResponseWithData(res,"Registration Success.", userData);
                        });
                    }).catch(err =&gt; {
                        console.log(err);
                        return apiResponse.ErrorResponse(res,err);
                    }) ;
</pre></table></code></div></div><h4 id="login-method"><span class="me-2">Login method</span><a href="#login-method" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Js code</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be specified.</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">isEmail</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email must be a valid email address.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">withMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password must be specified.</span><span class="dl">"</span><span class="p">),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">}).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">//Compare given password with db's hash.</span>
                        <span class="nx">bcrypt</span><span class="p">.</span><span class="nf">compare</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">same</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">same</span><span class="p">){</span>
                                <span class="c1">//Check account confirmation.</span>
                                <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
                                    <span class="c1">// Check User's account active or not.</span>
                                    <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="kd">let</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="na">_id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
                                            <span class="na">firstName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
                                            <span class="na">lastName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
                                            <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
                                        <span class="p">};</span>
                                        <span class="c1">//Prepare JWT token for authentication</span>
                                        <span class="kd">const</span> <span class="nx">jwtPayload</span> <span class="o">=</span> <span class="nx">userData</span><span class="p">;</span>
                                        <span class="kd">const</span> <span class="nx">jwtData</span> <span class="o">=</span> <span class="p">{</span>
                                            <span class="na">expiresIn</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_TIMEOUT_DURATION</span><span class="p">,</span>
                                        <span class="p">};</span>
                                        <span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">;</span>
                                        <span class="c1">//Generated JWT token with Payload and secret.</span>
                                        <span class="nx">userData</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">jwtPayload</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">jwtData</span><span class="p">);</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Login Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
                                    <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account is not active. Please contact admin.</span><span class="dl">"</span><span class="p">);</span>
                                    <span class="p">}</span>
                                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account is not confirmed. Please confirm your account.</span><span class="dl">"</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email or Password wrong.</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Email or Password wrong.</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">bcrypt</code> module provide function compare password with <code class="language-plaintext highlighter-rouge">user.password</code>. Promise function search in DB and find user exist with email.<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">}).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{...});</span>
<span class="nx">bcrypt</span><span class="p">.</span><span class="nf">compare</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">same</span><span class="p">)</span> <span class="p">{});</span>
</pre></table></code></div></div><li>Check User status and send response with JWT token generate for user: <code class="language-plaintext highlighter-rouge">userData.token = jwt.sign(jwtPayload, secret, jwtData);</code> in expired time.<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>  <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">userData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">_id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
          <span class="na">firstName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
          <span class="na">lastName</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
          <span class="na">email</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="p">};</span>
      <span class="c1">//Prepare JWT token for authentication</span>
      <span class="kd">const</span> <span class="nx">jwtPayload</span> <span class="o">=</span> <span class="nx">userData</span><span class="p">;</span>
      <span class="kd">const</span> <span class="nx">jwtData</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">expiresIn</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_TIMEOUT_DURATION</span><span class="p">,</span>
      <span class="p">};</span>
      <span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">;</span>
      <span class="c1">//Generated JWT token with Payload and secret.</span>
      <span class="nx">userData</span><span class="p">.</span><span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">jwtPayload</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">jwtData</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Login Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">userData</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account is not active. Please contact admin.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
</pre></table></code></div></div><h4 id="verify-otp"><span class="me-2">Verify OTP</span><a href="#verify-otp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>verify otp from user with database.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">};</span>
<span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//Check already confirm or not.</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
          <span class="c1">//Check account confirmation.</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">confirmOTP</span> <span class="o">==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">otp</span><span class="p">){</span>
              <span class="c1">//Update user as confirmed</span>
              <span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOneAndUpdate</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="p">{</span>
                  <span class="na">isConfirmed</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="na">confirmOTP</span><span class="p">:</span> <span class="kc">null</span>
              <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
              <span class="p">});</span>
              <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Account confirmed success.</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span><span class="k">else</span><span class="p">{</span>
              <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Otp does not match</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account already confirmed.</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Specified email not found.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><h4 id="resend-otp"><span class="me-2">Resend OTP</span><a href="#resend-otp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>query to get email searching email on db and resend otp to user request resend otp.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span><span class="na">email</span> <span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">};</span>
<span class="nx">UserModel</span><span class="p">.</span><span class="nf">findOne</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//Check already confirm or not.</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span><span class="p">){</span>
          <span class="c1">// Generate otp</span>
          <span class="kd">let</span> <span class="nx">otp</span> <span class="o">=</span> <span class="nx">utility</span><span class="p">.</span><span class="nf">randomNumber</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
          <span class="c1">// Html email body</span>
          <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;p&gt;Please Confirm your Account.&lt;/p&gt;&lt;p&gt;OTP: </span><span class="dl">"</span><span class="o">+</span><span class="nx">otp</span><span class="o">+</span><span class="dl">"</span><span class="s2">&lt;/p&gt;</span><span class="dl">"</span><span class="p">;</span>
          <span class="c1">// Send confirmation email</span>
          <span class="nx">mailer</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span>
              <span class="nx">constants</span><span class="p">.</span><span class="nx">confirmEmails</span><span class="p">.</span><span class="k">from</span><span class="p">,</span>
              <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
              <span class="dl">"</span><span class="s2">Confirm Account</span><span class="dl">"</span><span class="p">,</span>
              <span class="nx">html</span>
          <span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
              <span class="nx">user</span><span class="p">.</span><span class="nx">isConfirmed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="nx">user</span><span class="p">.</span><span class="nx">confirmOTP</span> <span class="o">=</span> <span class="nx">otp</span><span class="p">;</span>
              <span class="c1">// Save user.</span>
              <span class="nx">user</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
                  <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Confirm otp sent.</span><span class="dl">"</span><span class="p">);</span>
              <span class="p">});</span>
          <span class="p">});</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Account already confirmed.</span><span class="dl">"</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Specified email not found.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><p>Promise function in request often used in <code class="language-plaintext highlighter-rouge">Express</code> to asynchronous request nodejs.</p><h3 id="mailer-function"><span class="me-2">Mailer function</span><a href="#mailer-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Mailer to send email is support by <code class="language-plaintext highlighter-rouge">nodemailer</code> module. <code class="language-plaintext highlighter-rouge">send</code> function was eported ```js const nodemailer = require(“nodemailer”);</p></ul><p>// create reusable transporter object using the default SMTP transport let transporter = nodemailer.createTransport({ host: process.env.EMAIL_SMTP_HOST, port: process.env.EMAIL_SMTP_PORT, //secure: process.env.EMAIL_SMTP_SECURE, // lack of ssl commented this. You can uncomment it. auth: { user: process.env.EMAIL_SMTP_USERNAME, pass: process.env.EMAIL_SMTP_PASSWORD } });</p><p>exports.send = function (from, to, subject, html) { // send mail with defined transport object // visit https://nodemailer.com/ for more options return transporter.sendMail({ from: from, // sender address e.g. no-reply@xyz.com or “Fred Foo 👻” <a href="mailto:foo@example.com">foo@example.com</a> to: to, // list of receivers e.g. bar@example.com, baz@example.com subject: subject, // Subject line e.g. ‘Hello ✔’ //text: text, // plain text body e.g. Hello world? html: html // html body e.g. ‘<b>Hello world?</b>’ }); };</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### Utily to generate OTP
Generate otp for confirm user request
```js
exports.randomNumber = function (length) {
    var text = "";
    var possible = "123456789";
    for (var i = 0; i &lt; length; i++) {
        var sup = Math.floor(Math.random() * possible.length);
        text += i &gt; 0 &amp;&amp; sup == i ? "0" : possible.charAt(sup);
    }
    return Number(text);
};
</pre></table></code></div></div><h3 id="constants-data"><span class="me-2">Constants data</span><a href="#constants-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ConfirmEmails from, admin.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">constants</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">admin</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">email</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin@admin.com</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="na">confirmEmails</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">from</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">no-reply@test-app.com</span><span class="dl">"</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="user-model"><span class="me-2">User model</span><a href="#user-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>User model to query data from monggodb</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">UserSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nc">Schema</span><span class="p">({</span>
    <span class="na">firstName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="na">lastName</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="na">email</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="na">password</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="na">isConfirmed</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="na">confirmOTP</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span>
    <span class="na">otpTries</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="na">status</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="nb">Boolean</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">},</span> <span class="p">{</span><span class="na">timestamps</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>

<span class="c1">// Virtual for user's full name</span>
<span class="nx">UserSchema</span>
    <span class="p">.</span><span class="nf">virtual</span><span class="p">(</span><span class="dl">"</span><span class="s2">fullName</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">;</span>
    <span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="dl">"</span><span class="s2">User</span><span class="dl">"</span><span class="p">,</span> <span class="nx">UserSchema</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="http-server-handle-request-and-response"><span class="me-2">HTTP server handle request and response</span><a href="#http-server-handle-request-and-response" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">#!/usr/bin/env node

/**
 * Module dependencies.
 */

var app = require('../app');
var debug = require('debug')('rest-api-nodejs-mongodb:server');
var http = require('http');

/**
 * Get port from environment and store in Express.
 */

var port = normalizePort(process.env.PORT || '3000');
app.set('port', port);

/**
 * Create HTTP server.
 */

var server = http.createServer(app);

/**
 * Listen on provided port, on all network interfaces.
 */

server.listen(port);
server.on('error', onError);
server.on('listening', onListening);

/**
 * Normalize a port into a number, string, or false.
 */

function normalizePort(val) {
  var port = parseInt(val, 10);

  if (isNaN(port)) {
    // named pipe
    return val;
  }

  if (port &gt;= 0) {
    // port number
    return port;
  }

  return false;
}

/**
 * Event listener for HTTP server "error" event.
 */

function onError(error) {
  if (error.syscall !== 'listen') {
    throw error;
  }

  var bind = typeof port === 'string'
    ? 'Pipe ' + port
    : 'Port ' + port;

  // handle specific listen errors with friendly messages
  switch (error.code) {
    case 'EACCES':
      console.error(bind + ' requires elevated privileges');
      process.exit(1);
      break;
    case 'EADDRINUSE':
      console.error(bind + ' is already in use');
      process.exit(1);
      break;
    default:
      throw error;
  }
}

/**
 * Event listener for HTTP server "listening" event.
 */

function onListening() {
  var addr = server.address();
  var bind = typeof addr === 'string'
    ? 'pipe ' + addr
    : 'port ' + addr.port;
  debug('Listening on ' + bind);
}
</code></pre><h3 id="book-rest-api-handle"><span class="me-2">Book rest api handle</span><a href="#book-rest-api-handle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Bookcontroller will handle function as actions: <code class="language-plaintext highlighter-rouge">book list</code>, <code class="language-plaintext highlighter-rouge">book detail</code>, <code class="language-plaintext highlighter-rouge">book store</code>, <code class="language-plaintext highlighter-rouge">book update</code>, and <code class="language-plaintext highlighter-rouge">book delete</code>.</p><h4 id="book-controller"><span class="me-2">Book controller</span><a href="#book-controller" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">Book</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models/BookModel</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">body</span><span class="p">,</span><span class="nx">validationResult</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">sanitizeBody</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">apiResponse</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../helpers/apiResponse</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">auth</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../middlewares/jwt</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">mongoose</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">useFindAndModify</span><span class="dl">"</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Book Schema</span>
<span class="kd">function</span> <span class="nf">BookData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isbn</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">isbn</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * Book List.
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">bookList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">},</span><span class="dl">"</span><span class="s2">_id title description isbn createdAt</span><span class="dl">"</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">books</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">books</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="nx">books</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="p">[]);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="cm">/**
 * Book Detail.
 *
 * @param {string}      id
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">bookDetail</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="p">{});</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">Book</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">_id</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">},</span><span class="dl">"</span><span class="s2">_id title description isbn createdAt</span><span class="dl">"</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">book</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">book</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">){</span>
                    <span class="kd">let</span> <span class="nx">bookData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BookData</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bookData</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="p">{});</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="cm">/**
 * Book store.
 *
 * @param {string}      title
 * @param {string}      description
 * @param {string}      isbn
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">bookStore</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Title must not be empty.</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">(),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Description must not be empty.</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">(),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">isbn</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ISBN must not be empty</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">custom</span><span class="p">((</span><span class="nx">value</span><span class="p">,{</span><span class="nx">req</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Book</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">isbn</span> <span class="p">:</span> <span class="nx">value</span><span class="p">,</span><span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">}).</span><span class="nf">then</span><span class="p">(</span><span class="nx">book</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">book</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">Book already exist with this ISBN no.</span><span class="dl">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="p">(</span>
                <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                    <span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span>
                    <span class="na">description</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
                    <span class="na">isbn</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">isbn</span>
                <span class="p">});</span>

            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1">//Save book.</span>
                <span class="nx">book</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
                    <span class="kd">let</span> <span class="nx">bookData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BookData</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book add Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bookData</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="cm">/**
 * Book update.
 *
 * @param {string}      title
 * @param {string}      description
 * @param {string}      isbn
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">bookUpdate</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Title must not be empty.</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">(),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Description must not be empty.</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">(),</span>
    <span class="nf">body</span><span class="p">(</span><span class="dl">"</span><span class="s2">isbn</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ISBN must not be empty</span><span class="dl">"</span><span class="p">).</span><span class="nf">isLength</span><span class="p">({</span> <span class="na">min</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}).</span><span class="nf">trim</span><span class="p">().</span><span class="nf">custom</span><span class="p">((</span><span class="nx">value</span><span class="p">,{</span><span class="nx">req</span><span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Book</span><span class="p">.</span><span class="nf">findOne</span><span class="p">({</span><span class="na">isbn</span> <span class="p">:</span> <span class="nx">value</span><span class="p">,</span><span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">$ne</span><span class="dl">"</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">}}).</span><span class="nf">then</span><span class="p">(</span><span class="nx">book</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">book</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">reject</span><span class="p">(</span><span class="dl">"</span><span class="s2">Book already exist with this ISBN no.</span><span class="dl">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}),</span>
    <span class="nf">sanitizeBody</span><span class="p">(</span><span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">).</span><span class="nf">escape</span><span class="p">(),</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nf">validationResult</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="p">(</span>
                <span class="p">{</span> <span class="na">title</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                    <span class="na">description</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
                    <span class="na">isbn</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">isbn</span><span class="p">,</span>
                    <span class="na">_id</span><span class="p">:</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span>
                <span class="p">});</span>

            <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Validation Error.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">array</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)){</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Invalid Error.</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Invalid ID</span><span class="dl">"</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="nx">Book</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">foundBook</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if </span><span class="p">(</span><span class="nx">foundBook</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
                            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">notFoundResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book not exists with this id</span><span class="dl">"</span><span class="p">);</span>
                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="c1">//Check authorized user</span>
                            <span class="k">if</span><span class="p">(</span><span class="nx">foundBook</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">){</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">You are not authorized to do this operation.</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="c1">//update book.</span>
                                <span class="nx">Book</span><span class="p">.</span><span class="nf">findByIdAndUpdate</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">book</span><span class="p">,</span> <span class="p">{},</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
                                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                        <span class="kd">let</span> <span class="nx">bookData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BookData</span><span class="p">(</span><span class="nx">book</span><span class="p">);</span>
                                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book update Success.</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bookData</span><span class="p">);</span>
                                    <span class="p">}</span>
                                <span class="p">});</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>

<span class="cm">/**
 * Book Delete.
 *
 * @param {string}      id
 *
 * @returns {Object}
 */</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">bookDelete</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">mongoose</span><span class="p">.</span><span class="nx">Types</span><span class="p">.</span><span class="nx">ObjectId</span><span class="p">.</span><span class="nf">isValid</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">validationErrorWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Invalid Error.</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Invalid ID</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">Book</span><span class="p">.</span><span class="nf">findById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">foundBook</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">foundBook</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">notFoundResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book not exists with this id</span><span class="dl">"</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="c1">//Check authorized user</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">foundBook</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">){</span>
                        <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">unauthorizedResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">You are not authorized to do this operation.</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="c1">//delete book.</span>
                        <span class="nx">Book</span><span class="p">.</span><span class="nf">findByIdAndRemove</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
                            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                                <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book delete Success.</span><span class="dl">"</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>
</pre></table></code></div></div><p>Mongodb will manage by <code class="language-plaintext highlighter-rouge">mongoose</code> module. set mode <code class="language-plaintext highlighter-rouge">useFindAndModify</code>. Create schema</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// Book Schema</span>
<span class="kd">function</span> <span class="nf">BookData</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isbn</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">isbn</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">createdAt</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Book controller require authenticate from middleware <code class="language-plaintext highlighter-rouge">jwt</code> and found user of request. Implement <code class="language-plaintext highlighter-rouge">auth</code> such as a element and export in controller action. <strong>Book list</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">bookList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">auth</span><span class="p">,</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">Book</span><span class="p">.</span><span class="nf">find</span><span class="p">({</span><span class="na">user</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">},</span><span class="dl">"</span><span class="s2">_id title description isbn createdAt</span><span class="dl">"</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">books</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">books</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="nx">books</span><span class="p">);</span>
                <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                    <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponseWithData</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Operation success</span><span class="dl">"</span><span class="p">,</span> <span class="p">[]);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//throw error in json response with status 500.</span>
            <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">];</span>
</pre></table></code></div></div><p><strong>bookDetail</strong></p><pre><code class="language-JS">Book.findOne({_id: req.params.id,user: req.user._id},"_id title description isbn createdAt").then((book)=&gt;{
    if(book !== null){
        let bookData = new BookData(book);
        return apiResponse.successResponseWithData(res, "Operation success", bookData);
    }else{
        return apiResponse.successResponseWithData(res, "Operation success", {});
    }
});
</code></pre><p>Used promise <code class="language-plaintext highlighter-rouge">Book.findOne({_id: req.params.id,user: req.user._id},"_id title description isbn createdAt").then((book)=&gt;{});</code>. id of book is param of request, and <code class="language-plaintext highlighter-rouge">user</code> is param of request after authenticated.</p><p><strong>bookUpdate</strong></p><ul><li>params santizied input by function <code class="language-plaintext highlighter-rouge">sanitizeBody("*").escape()</code><li>Use <code class="language-plaintext highlighter-rouge">mongoose.Types.ObjectId.isValid(req.params.id)</code> to validate ID in request params.</ul><p><strong>bookDelete</strong></p><ul><li>Promise for find and delete book<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nx">Book</span><span class="p">.</span><span class="nf">findByIdAndRemove</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nc">ErrorResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="nx">apiResponse</span><span class="p">.</span><span class="nf">successResponse</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="dl">"</span><span class="s2">Book delete Success.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><h3 id="book-model"><span class="me-2">Book Model</span><a href="#book-model" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>```js var mongoose = require(“mongoose”);</p></ul><p>var Schema = mongoose.Schema;</p><p>var BookSchema = new Schema({ title: {type: String, required: true}, description: {type: String, required: true}, isbn: {type: String, required: true}, user: { type: Schema.ObjectId, ref: “User”, required: true }, }, {timestamps: true});</p><p>module.exports = mongoose.model(“Book”, BookSchema);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>### Test
- testConfig.js
```js
//During the automated test the env variable, We will set it to "test"
process.env.NODE_ENV = "test";
process.env.MONGODB_URL = "mongodb://127.0.0.1:27017/rest-api-nodejs-mongodb-test";

//Require the dev-dependencies
let chai = require("chai");
let chaiHttp = require("chai-http");
let server = require("../app");
let should = chai.should();
chai.use(chaiHttp);

//Export this to use in multiple files
module.exports = {
    chai: chai,
    server: server,
    should: should
};
</pre></table></code></div></div><p>Import necessary module for test. Add these lines before test code.</p><pre><code class="language-JS">const { chai, server, should } = require("./testConfig");
const UserModel = require("../models/UserModel");
const BookModel = require("../models/BookModel");
</code></pre><ul><li>auth.js<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Auth</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// Before each test we empty the database</span>
  <span class="nf">before</span><span class="p">((</span><span class="nx">done</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">UserModel</span><span class="p">.</span><span class="nf">deleteMany</span><span class="p">({},</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nf">done</span><span class="p">();</span>
      <span class="p">});</span>
  <span class="p">});</span>

  <span class="c1">// Prepare data for testing</span>
  <span class="kd">const</span> <span class="nx">testData</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">firstName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">testing</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">Test@123</span><span class="dl">"</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">maitraysuthar@test12345.com</span><span class="dl">"</span>
  <span class="p">};</span>

  <span class="cm">/*
* Test the /POST route
*/</span>
  <span class="nf">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">/POST Register</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">It should send validation error for Register</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">chai</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="nx">server</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/auth/register</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">send</span><span class="p">({</span><span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="nx">testData</span><span class="p">.</span><span class="nx">email</span><span class="p">})</span>
              <span class="p">.</span><span class="nf">end</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                  <span class="nx">res</span><span class="p">.</span><span class="nx">should</span><span class="p">.</span><span class="nx">have</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
                  <span class="nf">done</span><span class="p">();</span>
              <span class="p">});</span>
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><li>book.js</ul><pre><code class="language-JS">describe("Book", () =&gt; {
    //Before each test we empty the database
    before((done) =&gt; {
        BookModel.deleteMany({}, (err) =&gt; {
            done();
        });
    });

    // Prepare data for testing
    const userTestData = {
        "password":"Test@123",
        "email":"maitraysuthar@test12345.com"
    };

    // Prepare data for testing
    const testData = {
        "title":"testing book",
        "description":"testing book desc",
        "isbn":"3214htrff4"
    };

    /*
  * Test the /POST route
  */
    describe("/POST Login", () =&gt; {
        it("it should do user Login for book", (done) =&gt; {
            chai.request(server)
                .post("/api/auth/login")
                .send({"email": userTestData.email,"password": userTestData.password})
                .end((err, res) =&gt; {
                    res.should.have.status(200);
                    res.body.should.have.property("message").eql("Login Success.");
                    userTestData.token = res.body.data.token;
                    done();
                });
        });
    });
});
</code></pre><ul><li>app.js File to configure app and config variables ```JS var express = require(“express”); var path = require(“path”); var cookieParser = require(“cookie-parser”); var logger = require(“morgan”); require(“dotenv”).config(); var indexRouter = require(“./routes/index”); var apiRouter = require(“./routes/api”); var apiResponse = require(“./helpers/apiResponse”); var cors = require(“cors”);</ul><p>// DB connection var MONGODB_URL = process.env.MONGODB_URL; var mongoose = require(“mongoose”); mongoose.connect(MONGODB_URL, { useNewUrlParser: true, useUnifiedTopology: true }).then(() =&gt; { //don’t show the log when it is test if(process.env.NODE_ENV !== “test”) { console.log(“Connected to %s”, MONGODB_URL); console.log(“App is running … \n”); console.log(“Press CTRL + C to stop the process. \n”); } }) .catch(err =&gt; { console.error(“App starting error:”, err.message); process.exit(1); }); var db = mongoose.connection;</p><p>var app = express();</p><p>//don’t show the log when it is test if(process.env.NODE_ENV !== “test”) { app.use(logger(“dev”)); } app.use(express.json()); app.use(express.urlencoded({ extended: false })); app.use(cookieParser()); app.use(express.static(path.join(__dirname, “public”)));</p><p>//To allow cross-origin requests app.use(cors());</p><p>//Route Prefixes app.use(“/”, indexRouter); app.use(“/api/”, apiRouter);</p><p>// throw 404 if URL not found app.all(“*”, function(req, res) { return apiResponse.notFoundResponse(res, “Page not found”); });</p><p>app.use((err, req, res) =&gt; { if(err.name == “UnauthorizedError”){ return apiResponse.unauthorizedResponse(res, err.message); } });</p><p>module.exports = app;</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>- DB configure from monggo DB
```js
// DB connection
var MONGODB_URL = process.env.MONGODB_URL;
var mongoose = require("mongoose");
mongoose.connect(MONGODB_URL, { useNewUrlParser: true, useUnifiedTopology: true }).then(() =&gt; {
    //don't show the log when it is test
    if(process.env.NODE_ENV !== "test") {
        console.log("Connected to %s", MONGODB_URL);
        console.log("App is running ... \n");
        console.log("Press CTRL + C to stop the process. \n");
    }
})
    .catch(err =&gt; {
        console.error("App starting error:", err.message);
        process.exit(1);
    });
var db = mongoose.connection;
</pre></table></code></div></div><h3 id="build-an-http-server"><span class="me-2">Build an HTTP Server</span><a href="#build-an-http-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;h1&gt;Hello, World!&lt;/h1&gt;</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">server</span><span class="p">.</span><span class="nf">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Server running at port </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">})</span>
</pre></table></code></div></div><p>Let’s analyze it briefly. We include the <code class="language-plaintext highlighter-rouge">http</code> module. We use the module to create an HTTP server. Default port is 3000, the <code class="language-plaintext highlighter-rouge">listen</code> callback function is called. Whenever a new request is received, the <code class="language-plaintext highlighter-rouge">request</code> event is called, providing two object: a request(an <code class="language-plaintext highlighter-rouge">http.IncomingMessage</code> object) and a response (an <code class="language-plaintext highlighter-rouge">http.ServerResponse</code> object).</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="nx">res</span><span class="p">.</span><span class="nf">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">res</span><span class="p">.</span><span class="nf">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;h1&gt;Hello, World!&lt;/h1&gt;</span><span class="dl">'</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="making-http-requests-with-nodejs"><span class="me-2">Making HTTP requests with Node.js</span><a href="#making-http-requests-with-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="get-request"><span class="me-2">GET request</span><a href="#get-request" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">axios</span>
  <span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.com/todos</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`statusCode: </span><span class="p">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></table></code></div></div><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">https</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">hostname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">example.com</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">port</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/todos</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`statusCode: </span><span class="p">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

  <span class="nx">res</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">req</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">req</span><span class="p">.</span><span class="nf">end</span><span class="p">();</span>
</pre></table></code></div></div><h3 id="post-request"><span class="me-2">Post request</span><a href="#post-request" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Similiar to making GET request, you can use Axios library to perform POST request</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">axios</span>
  <span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://whatever.com/todos</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">todo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Buy the milk</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`statusCode: </span><span class="p">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></table></code></div></div><p>Or alternative using <code class="language-plaintext highlighter-rouge">https</code> module:</p><pre><code class="language-JS">const https = require('https');

const data = JSON.stringify({
  todo: 'Buy the milk',
});

const options = {
  hostname: 'whatever.com',
  port: 443,
  path: '/todos',
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Content-Length': data.length,
  },
};

const req = https.request(options, res =&gt; {
  console.log(`statusCode: ${res.statusCode}`);

  res.on('data', d =&gt; {
    process.stdout.write(d);
  });
});

req.on('error', error =&gt; {
  console.error(error);
});

req.write(data);
req.end();
</code></pre><h3 id="put-and-delete"><span class="me-2">PUT and DELETE</span><a href="#put-and-delete" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>PUT and DELETE is same with POST and GET method but <code class="language-plaintext highlighter-rouge">method</code> is PUT or DELETE.</p><h2 id="get-http-request-body-data-using-nodejs"><span class="me-2">Get HTTP request body data using Node.js</span><a href="#get-http-request-body-data-using-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you are using Express, that’s quite simple: use the express.json() middleware which is available is Express v4.16.0 onwards.</p><pre><code class="language-JS">const axios = require('axios');
axios.post('https://whatever.com/todos', {
    todo: 'Buy the milk',
});
</code></pre><p>This is the matching server side code</p><pre><code class="language-JS">const express = require('express');

const app = express();

app.use(
  express.urlencoded({
    extended: true,
  })
);

app.use(express.json());

app.post('/todos', (req, res) =&gt; {
  console.log(req.body.todo);
});
</code></pre><p>If you’re not using Express and you want to do this in vanilla Node.js, you need to do a bit more work, of course, as Express abstracts a lot of this for you.</p><pre><code class="language-JS">const server = http.createServer((req, res) =&gt; {
  // we can access HTTP headers
  req.on('data', chunk =&gt; {
    console.log(`Data chunk available: ${chunk}`);
  });
  req.on('end', () =&gt; {
    // end of data
  });
});
</code></pre><p>So to access the data, assuming we expect to receive a string, we must concatenate the into a string when listening to the stream <code class="language-plaintext highlighter-rouge">data</code>, amd when the stream <code class="language-plaintext highlighter-rouge">end</code>, we parse the string to JSON:</p><pre><code class="language-JS">const server = http.createServer(async (req, res) =&gt; {
  const buffers = [];

  for await (const chunk of req) {
    buffers.push(chunk);
  }

  const data = Buffer.concat(buffers).toString();

  console.log(JSON.parse(data).todo); // 'Buy the milk'
  res.end();
});
</code></pre><h2 id="nodejs-file-stats"><span class="me-2">Node.js file stats</span><a href="#nodejs-file-stats" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You call it passing a file path, and once Node.js gets the file details it will call the callback function you pass, with 2 parameters: an error message, and the file stats:</p><pre><code class="language-JS">const fs = require('fs');
fs.stat('/Users/joe/test.text', (err, stats) =&gt; {
    if (err) {
        console.error(err);
        return;
    }

    stats.isFile();
    stats.isDirectory();
    stats.isSymbolicLink();
    stats.size;
});
</code></pre><p>You can use promise-based fsPromises.stat() method offerd by the <code class="language-plaintext highlighter-rouge">fs/promises</code> module if you like:</p><pre><code class="language-JS">const fs = require('fs/promises');
async function example() {
    try {
        stats.isFile(); // true
        stats.isDirectory(); // false
        stats.isSymbolicLink(); // false
        stats.size; // 1024000 //= 1MB
    } catch (err) {
        console.log(err);
    }
}

example();
</code></pre><h2 id="nodejs-file-paths"><span class="me-2">Node.js File Paths</span><a href="#nodejs-file-paths" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You include this module in your files using</p><pre><code class="language-JS">const path = require('path');
const notes = '/users/joe/notes.txt';

path.dirname(notes); // /users/joe
path.basename(notes); // notes.txt
path.extname(notes); // .txt
path.basename(notes, path.extname(notes)); // notes
</code></pre><h3 id="working-with-paths"><span class="me-2">Working with paths</span><a href="#working-with-paths" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">const name = 'joe';
path.join('/', 'users', name, 'notes.txt'); // '/users/joe/notes.txt'
path.resolve('joe.txt'); // '/Users/joe/joe.txt' if run from my home folder
path.normalize('/users/joe/..//test.txt'); // '/users/test.txt'
</code></pre><p>Neither resolve nor normalize will check if the path exists. They just calculate a path based on the information they got. Check file exists by:</p><pre><code class="language-JS">const stats = await fs.stat('/Users/joe/test.txt');
stats.isFile(); // true
stats.isDirectory(); // false
stats.isSymbolicLink(); // false
</code></pre><h2 id="reading-files-with-nodejs"><span class="me-2">Reading files with Node.js</span><a href="#reading-files-with-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>All three of <code class="language-plaintext highlighter-rouge">fs.readFile()</code>, <code class="language-plaintext highlighter-rouge">fs.readFileSync()</code> and <code class="language-plaintext highlighter-rouge">fsPromises.readFile()</code> read the full content of the file in memory before returning the data.</p><p>This means that big files are going to have a major impact on your memory consumption and speed of execution of the program.</p><p>In this case, a better option is to read the file content using streams.</p><ul><li>fs.readFile ```JS const fs = require(‘fs’);</ul><p>fs.readFile(‘/Users/joe/test.txt’, ‘utf8’, (err, data) =&gt; { if (err) { console.error(err); return; } console.log(data); });</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>- fs.readFileSync()
```JS
const fs = require('fs');

try {
  const data = fs.readFileSync('/Users/joe/test.txt', 'utf8');
  console.log(data);
} catch (err) {
  console.error(err);
}
</pre></table></code></div></div><ul><li>fsPromises.readFile() and <code class="language-plaintext highlighter-rouge">fs/promises</code> module ```JS const fs = require(‘fs/promises’);</ul><p>async function example() { try { const data = await fs.readFile(‘/Users/joe/test.txt’, { encoding: ‘utf8’ }); console.log(data); } catch (err) { console.log(err); } } example();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>## Writing files with Node.js
The easiest way to write to files in Node.js is to use the `fs.writeFile()` API.
- fs.writeFile
```JS
const fs = require('fs');

const content = 'Some content!';

fs.writeFile('/Users/joe/test.txt', content, err =&gt; {
  if (err) {
    console.error(err);
  }
  // file written successfully
});
</pre></table></code></div></div><ul><li>fs.writeFileSync() ```JS const fs = require(‘fs’);</ul><p>const content = ‘Some content!’;</p><p>try { fs.writeFileSync(‘/Users/joe/test.txt’, content); // file written successfully } catch (err) { console.error(err); }</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>- fsPromises.writeFile() method offered by the `fs/promises` module:
```JS
const fs = require('fs/promises');

async function example() {
  try {
    const content = 'Some content!';
    await fs.writeFile('/Users/joe/test.txt', content);
  } catch (err) {
    console.log(err);
  }
}
example();
// for modify flag
fs.writeFile('/Users/joe/test.txt', content, { flag: 'a+' }, err =&gt; {});
</pre></table></code></div></div><p>The flags you’ll likely use are</p><ul><li>r+ open the file for reading and writing<li>w+ open the file for reading and writing, positioning the stream at the beginning of the file. The file is created if it does not exist<li>a open the file for writing, positioning the stream at the end of the file. The file is created if it does not exist<li>a+ open the file for reading and writing, positioning the stream at the end of the file. The file is created if it does not exist<h3 id="append-to-a-file"><span class="me-2">Append to a file</span><a href="#append-to-a-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><li>fs.appendFile() ```JS const content = ‘Some content!’;</ul><p>fs.appendFile(‘file.log’, content, err =&gt; { if (err) { console.error(err); } // done! });</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>- fsPromises.appendFile()
```JS
const fs = require('fs/promises');

async function example() {
  try {
    const content = 'Some content!';
    await fs.appendFile('/Users/joe/test.txt', content);
  } catch (err) {
    console.log(err);
  }
}
example();
</pre></table></code></div></div><h3 id="using-streams"><span class="me-2">Using streams</span><a href="#using-streams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>All those methods write the full content to the file before returning the control back to your program (in the async version, this means executing the callback) In this case, a better option is to write the file content using streams.</p><h3 id="working-with-folders-in-nodejs"><span class="me-2">Working with folders in Node.js</span><a href="#working-with-folders-in-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The Node.js fs core module provides many handy methods you can use to work with folders.</p><h3 id="check-if-a-folder-exists"><span class="me-2">Check if a folder exists</span><a href="#check-if-a-folder-exists" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Use <code class="language-plaintext highlighter-rouge">fs.access()</code> (and its promise-based <code class="language-plaintext highlighter-rouge">fsPromises.access()</code> counterpart) to check if the folder exists and Node.js can access it with its permissions.</p><pre><code class="language-JS">const fs = require('fs');

const folderName = '/Users/joe/test';

try {
  if (!fs.existsSync(folderName)) {
    fs.mkdirSync(folderName);
  }
} catch (err) {
  console.error(err);
}
</code></pre><h3 id="read-the-content-of-a-directory"><span class="me-2">Read the content of a directory</span><a href="#read-the-content-of-a-directory" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">const fs = require('fs');
const folderPath = '/Users/joe';
fs.readdirSync(folderPath);
fs.readdirSync(folderPath).map(fileName =&gt; {
  return path.join(folderPath, fileName);
});
const isFile = fileName =&gt; {
  return fs.lstatSync(fileName).isFile();
};

fs.readdirSync(folderPath)
  .map(fileName =&gt; {
    return path.join(folderPath, fileName);
  })
  .filter(isFile);
</code></pre><h3 id="rename-a-folder"><span class="me-2">Rename a folder</span><a href="#rename-a-folder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">fs.rename()</code> or <code class="language-plaintext highlighter-rouge">fs.renameSync()</code> or <code class="language-plaintext highlighter-rouge">fsPromises.rename()</code>. The first parameter is the current path, the second the new path:</p><pre><code class="language-JS">const fs = require('fs');

fs.rename('/Users/joe', '/Users/roger', err =&gt; {
  if (err) {
    console.error(err);
  }
  // done
});
</code></pre><p><code class="language-plaintext highlighter-rouge">fs.renameSync()</code> is synchromous verion</p><pre><code class="language-JS">const fs = require('fs');

try {
  fs.renameSync('/Users/joe', '/Users/roger');
} catch (err) {
  console.error(err);
}
</code></pre><ul><li><code class="language-plaintext highlighter-rouge">fsPromises.rename()</code> is the promise-based version: ```JS const fs = require(‘fs/promises’);</ul><p>async function example() { try { await fs.rename(‘/Users/joe’, ‘/Users/roger’); } catch (err) { console.log(err); } } example();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>### Remove a folder
Use `fs.rmdir()` or `fs.rmdirSync()` or `fsPromises.rmdir()` to remove a folder.
```JS
const fs = require('fs');

fs.rm(dir, { recursive: true, force: true }, err =&gt; {
  if (err) {
    throw err;
  }

  console.log(`${dir} is deleted!`);
});
</pre></table></code></div></div><ul><li>You can install and make use of the <code class="language-plaintext highlighter-rouge">fs-extra</code> module. It’s a drop-in replacement of the <code class="language-plaintext highlighter-rouge">fs</code> module, which provides more features on top of it.<div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm <span class="nb">install </span>fs-extra
</pre></table></code></div></div><p>```js const fs = require(‘fs-extra’);</p></ul><p>const folder = ‘/Users/joe’;</p><p>fs.remove(folder, err =&gt; { console.error(err); }); // promise fs.remove(folder) .then(() =&gt; { // done }) .catch(err =&gt; { console.error(err); }); // async/await async function removeFolder(folder) { try { await fs.remove(folder); // done } catch (err) { console.error(err); } }</p><p>const folder = ‘/Users/joe’; removeFolder(folder);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre>## The Node.js fs module
This is core module. When you require module. You can access to all its method, wich include:
- fs.access(): check if the file exists and Node.js can access it with its permissions
- fs.appendFile(): append data to a file. If the file does not exist, it's created
- fs.chmod(): change the permissions of a file specified by the filename passed. Related: fs.lchmod(), fs.fchmod()
- fs.chown(): change the owner and group of a file specified by the filename passed. Related: fs.fchown(), fs.lchown()
- fs.close(): close a file descriptor
- fs.copyFile(): copies a file
- fs.createReadStream(): create a readable file stream
- fs.createWriteStream(): create a writable file stream
- fs.link(): create a new hard link to a file
- fs.mkdir(): create a new folder
- fs.mkdtemp(): create a temporary directory
- fs.open(): opens the file and returns a file descriptor to allow file manipulation
- fs.readdir(): read the contents of a directory
- fs.readFile(): read the content of a file. Related: fs.read()
- fs.readlink(): read the value of a symbolic link
- fs.realpath(): resolve relative file path pointers (., ..) to the full path
- fs.rename(): rename a file or folder
- fs.rmdir(): remove a folder
- fs.stat(): returns the status of the file identified by the filename passed. Related: fs.fstat(), fs.lstat()
- fs.symlink(): create a new symbolic link to a file
- fs.truncate(): truncate to the specified length the file identified by the filename passed. Related: fs.ftruncate()
- fs.unlink(): remove a file or a symbolic link
- fs.unwatchFile(): stop watching for changes on a file
- fs.utimes(): change the timestamp of the file identified by the filename passed. Related: fs.futimes()
- fs.watchFile(): start watching for changes on a file. Related: fs.watch()
- fs.writeFile(): write data to a file. Related: fs.write()
One peculiar thing about the `fs` module is that all the methods are asynchronous by default, but they can also work synchronously by appending `Sync` such as `fs.renameSync`, `fs.writeSync`.
```JS
// Example: Read a file and change its content and read
// it again using callback-based API.
const fs = require('fs');

const fileName = '/Users/joe/test.txt';
fs.readFile(fileName, 'utf8', (err, data) =&gt; {
  if (err) {
    console.log(err);
    return;
  }
  console.log(data);
  const content = 'Some content!';
  fs.writeFile(fileName, content, err2 =&gt; {
    if (err2) {
      console.log(err2);
      return;
    }
    console.log('Wrote some content!');
    fs.readFile(fileName, 'utf8', (err3, data3) =&gt; {
      if (err3) {
        console.log(err3);
        return;
      }
      console.log(data3);
    });
  });
});

</pre></table></code></div></div><ul><li>for antoher example ```JS // Example: Read a file and change its content and read // it again using callback-based API. const fs = require(‘fs’);</ul><p>const fileName = ‘/Users/joe/test.txt’; fs.readFile(fileName, ‘utf8’, (err, data) =&gt; { if (err) { console.log(err); return; } console.log(data); const content = ‘Some content!’; fs.writeFile(fileName, content, err2 =&gt; { if (err2) { console.log(err2); return; } console.log(‘Wrote some content!’); fs.readFile(fileName, ‘utf8’, (err3, data3) =&gt; { if (err3) { console.log(err3); return; } console.log(data3); }); }); });</p><p>// Example: Read a file and change its content and read // it again using promise-based API. const fs = require(‘fs/promises’);</p><p>async function example() { const fileName = ‘/Users/joe/test.txt’; try { const data = await fs.readFile(fileName, ‘utf8’); console.log(data); const content = ‘Some content!’; await fs.writeFile(fileName, content); console.log(‘Wrote some content!’); const newData = await fs.readFile(fileName, ‘utf8’); console.log(newData); } catch (err) { console.log(err); } } example();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>### The Node.js os module
This module provides many functions that you can use to retrieve information from the underlying operating system and the computer the program runs on, and interact with it.
```js
const os = require('os');
</pre></table></code></div></div><ul><li><p>os.EOL gives the line delimiter sequence. It’s \n on Linux and macOS, and \r\n on Windows.</p><li><p>os.constants.signals tells us all the constants related to handling process signals, like SIGHUP, SIGKILL and so on.</p><li>os.constants.errno sets the constants for error reporting, like EADDRINUSE, EOVERFLOW and more.<li>os.arch()<li>os.cpus()<li>os.endianness()<li>os.freemen()<li>os.homedir()<li>os.hostname()<li>os.loadavg()<li>os.networkInterfaces()<li>os.platform()<li>os.release()<li>os.tmpdir()<li>os.totalmem()<li>os.type()<li>os.uptime()<li>os.userInfo()<h3 id="the-nodejs-events-module"><span class="me-2">The Node.js events module</span><a href="#the-nodejs-events-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The <code class="language-plaintext highlighter-rouge">event</code> module provides us the EventEmitter class, which is key to working with events in Node.js</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">door</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EventEmitter</span><span class="p">();</span>
</pre></table></code></div></div><p>The event listener has these in-built events:</p><li>newListener when a listener is added<li>removeListener when a listener is removed <strong>emitter.addListener()</strong> Alias for emitter.on(). <strong>emitter.emit()</strong> Emits an event. It synchronously calls every listener in the order they were registered.<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">slam</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// emitting the event "slam"</span>
</pre></table></code></div></div><p><strong>emitter.eventNames()</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">eventNames</span><span class="p">();</span>
</pre></table></code></div></div><p><strong>emitter.getMaxListeners()</strong> Get the maximum amount of listeners one can add to an EventEmitter object, which defaults to 10 but can be increased or lowered by using setMaxListeners()</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">getMaxListeners</span><span class="p">();</span>
</pre></table></code></div></div><p><strong>emitter.listenerCount()</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">listenerCount</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>emitter.listeners()</strong></p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">listeners</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>emitter.off()</strong> Alias for <code class="language-plaintext highlighter-rouge">emitter.removeListener()</code> added in Node.js 10 <strong>emitter.on()</strong> Adds a callback function that’s called when an event is emitted.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Door was opened</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><p><strong>emitter.once()</strong> Adds a callback function that’s called when an event is emitted for the first time after registering this. This callback is only going to be called once, never again. ```JS const EventEmitter = require(‘events’);</p></ul><p>const ee = new EventEmitter();</p><p>ee.once(‘my-event’, () =&gt; { // call callback function once });</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>**emitter.prependListener()**
When you add a listender using `on` or `addListener`, It's added last in the queue of listenders, and called last. Using `preendListener`it's added, added, and called, before other listeners.
**emitter.prependOnceListener()**
When you add a listener using `once`, it's added last in the queue of listeners, and called last. Using `preendOnceListener` it's added, and called, before other listeners.
**emitter.removeAllListeners()**
Removes all listeners of an EventEmitter object listening to a specific event:
```js
door.removeAllListeners('open');
</pre></table></code></div></div><p><strong>emitter.removeListener()</strong> Remove a specific listener. You can do this by saving the callback function to a variable, when added, so you can reference it later:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">doSomething</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{};</span>
<span class="nx">door</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="nx">doSomething</span><span class="p">);</span>
<span class="nx">door</span><span class="p">.</span><span class="nf">removeListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="nx">doSomething</span><span class="p">);</span>
</pre></table></code></div></div><p><strong>emitter.setMaxListeners()</strong> Sets the maximum amount of listeners one can add to an <code class="language-plaintext highlighter-rouge">EventEmitter</code> object, which defaults to 10 but can be increased or lowered.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">door</span><span class="p">.</span><span class="nf">setMaxListeners</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="the-nodejs-http-module"><span class="me-2">The Node.js http module</span><a href="#the-nodejs-http-module" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The HTTP core module is a key module to Node.js networking. It can be included using</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="properties"><span class="me-2">Properties</span><a href="#properties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="httpmethods"><span class="me-2">http.METHODS</span><a href="#httpmethods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> require<span class="o">(</span><span class="s1">'http'</span><span class="o">)</span>.METHODS
<span class="o">[</span> <span class="s1">'ACL'</span>,
  <span class="s1">'BIND'</span>,
  <span class="s1">'CHECKOUT'</span>,
  <span class="s1">'CONNECT'</span>,
  <span class="s1">'COPY'</span>,
  <span class="s1">'DELETE'</span>,
  <span class="s1">'GET'</span>,
  <span class="s1">'HEAD'</span>,
  <span class="s1">'LINK'</span>,
  <span class="s1">'LOCK'</span>,
  <span class="s1">'M-SEARCH'</span>,
  <span class="s1">'MERGE'</span>,
  <span class="s1">'MKACTIVITY'</span>,
  <span class="s1">'MKCALENDAR'</span>,
  <span class="s1">'MKCOL'</span>,
  <span class="s1">'MOVE'</span>,
  <span class="s1">'NOTIFY'</span>,
  <span class="s1">'OPTIONS'</span>,
  <span class="s1">'PATCH'</span>,
  <span class="s1">'POST'</span>,
  <span class="s1">'PROPFIND'</span>,
  <span class="s1">'PROPPATCH'</span>,
  <span class="s1">'PURGE'</span>,
  <span class="s1">'PUT'</span>,
  <span class="s1">'REBIND'</span>,
  <span class="s1">'REPORT'</span>,
  <span class="s1">'SEARCH'</span>,
  <span class="s1">'SUBSCRIBE'</span>,
  <span class="s1">'TRACE'</span>,
  <span class="s1">'UNBIND'</span>,
  <span class="s1">'UNLINK'</span>,
  <span class="s1">'UNLOCK'</span>,
  <span class="s1">'UNSUBSCRIBE'</span> <span class="o">]</span>
</pre></table></code></div></div><h4 id="httpstatus_codes"><span class="me-2">http.STATUS_CODES</span><a href="#httpstatus_codes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This property lists all the HTTP status codes and their description:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="o">&gt;</span> require<span class="o">(</span><span class="s1">'http'</span><span class="o">)</span>.STATUS_CODES
<span class="o">{</span> <span class="s1">'100'</span>: <span class="s1">'Continue'</span>,
  <span class="s1">'101'</span>: <span class="s1">'Switching Protocols'</span>,
  <span class="s1">'102'</span>: <span class="s1">'Processing'</span>,
  <span class="s1">'200'</span>: <span class="s1">'OK'</span>,
  <span class="s1">'201'</span>: <span class="s1">'Created'</span>,
  <span class="s1">'202'</span>: <span class="s1">'Accepted'</span>,
  <span class="s1">'203'</span>: <span class="s1">'Non-Authoritative Information'</span>,
  <span class="s1">'204'</span>: <span class="s1">'No Content'</span>,
  <span class="s1">'205'</span>: <span class="s1">'Reset Content'</span>,
  <span class="s1">'206'</span>: <span class="s1">'Partial Content'</span>,
  <span class="s1">'207'</span>: <span class="s1">'Multi-Status'</span>,
  <span class="s1">'208'</span>: <span class="s1">'Already Reported'</span>,
  <span class="s1">'226'</span>: <span class="s1">'IM Used'</span>,
  <span class="s1">'300'</span>: <span class="s1">'Multiple Choices'</span>,
  <span class="s1">'301'</span>: <span class="s1">'Moved Permanently'</span>,
  <span class="s1">'302'</span>: <span class="s1">'Found'</span>,
  <span class="s1">'303'</span>: <span class="s1">'See Other'</span>,
  <span class="s1">'304'</span>: <span class="s1">'Not Modified'</span>,
  <span class="s1">'305'</span>: <span class="s1">'Use Proxy'</span>,
  <span class="s1">'307'</span>: <span class="s1">'Temporary Redirect'</span>,
  <span class="s1">'308'</span>: <span class="s1">'Permanent Redirect'</span>,
  <span class="s1">'400'</span>: <span class="s1">'Bad Request'</span>,
  <span class="s1">'401'</span>: <span class="s1">'Unauthorized'</span>,
  <span class="s1">'402'</span>: <span class="s1">'Payment Required'</span>,
  <span class="s1">'403'</span>: <span class="s1">'Forbidden'</span>,
  <span class="s1">'404'</span>: <span class="s1">'Not Found'</span>,
  <span class="s1">'405'</span>: <span class="s1">'Method Not Allowed'</span>,
  <span class="s1">'406'</span>: <span class="s1">'Not Acceptable'</span>,
  <span class="s1">'407'</span>: <span class="s1">'Proxy Authentication Required'</span>,
  <span class="s1">'408'</span>: <span class="s1">'Request Timeout'</span>,
  <span class="s1">'409'</span>: <span class="s1">'Conflict'</span>,
  <span class="s1">'410'</span>: <span class="s1">'Gone'</span>,
  <span class="s1">'411'</span>: <span class="s1">'Length Required'</span>,
  <span class="s1">'412'</span>: <span class="s1">'Precondition Failed'</span>,
  <span class="s1">'413'</span>: <span class="s1">'Payload Too Large'</span>,
  <span class="s1">'414'</span>: <span class="s1">'URI Too Long'</span>,
  <span class="s1">'415'</span>: <span class="s1">'Unsupported Media Type'</span>,
  <span class="s1">'416'</span>: <span class="s1">'Range Not Satisfiable'</span>,
  <span class="s1">'417'</span>: <span class="s1">'Expectation Failed'</span>,
  <span class="s1">'418'</span>: <span class="s2">"I'm a teapot"</span>,
  <span class="s1">'421'</span>: <span class="s1">'Misdirected Request'</span>,
  <span class="s1">'422'</span>: <span class="s1">'Unprocessable Entity'</span>,
  <span class="s1">'423'</span>: <span class="s1">'Locked'</span>,
  <span class="s1">'424'</span>: <span class="s1">'Failed Dependency'</span>,
  <span class="s1">'425'</span>: <span class="s1">'Unordered Collection'</span>,
  <span class="s1">'426'</span>: <span class="s1">'Upgrade Required'</span>,
  <span class="s1">'428'</span>: <span class="s1">'Precondition Required'</span>,
  <span class="s1">'429'</span>: <span class="s1">'Too Many Requests'</span>,
  <span class="s1">'431'</span>: <span class="s1">'Request Header Fields Too Large'</span>,
  <span class="s1">'451'</span>: <span class="s1">'Unavailable For Legal Reasons'</span>,
  <span class="s1">'500'</span>: <span class="s1">'Internal Server Error'</span>,
  <span class="s1">'501'</span>: <span class="s1">'Not Implemented'</span>,
  <span class="s1">'502'</span>: <span class="s1">'Bad Gateway'</span>,
  <span class="s1">'503'</span>: <span class="s1">'Service Unavailable'</span>,
  <span class="s1">'504'</span>: <span class="s1">'Gateway Timeout'</span>,
  <span class="s1">'505'</span>: <span class="s1">'HTTP Version Not Supported'</span>,
  <span class="s1">'506'</span>: <span class="s1">'Variant Also Negotiates'</span>,
  <span class="s1">'507'</span>: <span class="s1">'Insufficient Storage'</span>,
  <span class="s1">'508'</span>: <span class="s1">'Loop Detected'</span>,
  <span class="s1">'509'</span>: <span class="s1">'Bandwidth Limit Exceeded'</span>,
  <span class="s1">'510'</span>: <span class="s1">'Not Extended'</span>,
  <span class="s1">'511'</span>: <span class="s1">'Network Authentication Required'</span> <span class="o">}</span>
</pre></table></code></div></div><h4 id="httpglobalagent"><span class="me-2">http.globalAgent</span><a href="#httpglobalagent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Points to the global instance of the Agent object, which is an instance of the <code class="language-plaintext highlighter-rouge">http.Agent</code> class. It’s used to manage connections persistence and reuse for HTTP clients, and it’s a key component of Node.js HTTP networking. More in the <code class="language-plaintext highlighter-rouge">http.Agent</code> class description later on.</p><h3 id="methods"><span class="me-2">Methods</span><a href="#methods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="httpcreateserver"><span class="me-2">http.createServer()</span><a href="#httpcreateserver" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Return a new instance of the <code class="language-plaintext highlighter-rouge">http.Server</code> class.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// handle every single request with this callback</span>
<span class="p">});</span>
</pre></table></code></div></div><h4 id="httprequest"><span class="me-2">http.request()</span><a href="#httprequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Makes an HTTP request to a server, creating an instance of the <code class="language-plaintext highlighter-rouge">http.ClientRequest</code> class.</p><h4 id="httpget"><span class="me-2">http.get()</span><a href="#httpget" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Similar to <code class="language-plaintext highlighter-rouge">http.request()</code>, but automatically sets the HTTP method to GET, and calls <code class="language-plaintext highlighter-rouge">req.end()</code> automatically.</p><h3 id="classes"><span class="me-2">Classes</span><a href="#classes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The HTTP module provides 5 classes:</p><ul><li>http.Agent<li>http.ClientRequest<li>http.Server<li>http.ServerResponse<li>http.IncomingMessage<h4 id="httpagent"><span class="me-2">http.Agent</span><a href="#httpagent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Node.js creates a global instance of the <code class="language-plaintext highlighter-rouge">http.Agent</code> class to manage connections persistence and reuse for HTTP clients, a key component of Node.js HTTP networking. This object make sure that every request made to a server is queued and a single socket is reused. It also maintains a pool of sockets. This is key for performance reasons.</p><h4 id="httpclientrequest"><span class="me-2">http.ClientRequest</span><a href="#httpclientrequest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>An <code class="language-plaintext highlighter-rouge">http.ClientRequest</code> object is created when <code class="language-plaintext highlighter-rouge">http.request()</code> or <code class="language-plaintext highlighter-rouge">http.get()</code> is called. When a response is received, the <code class="language-plaintext highlighter-rouge">response</code> event is called with response, with an <code class="language-plaintext highlighter-rouge">http.IncomingMessage</code> instance as argument.</p><h4 id="httpserver"><span class="me-2">http.Server</span><a href="#httpserver" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This class is commonly instantiated and returned when creating a new server using <code class="language-plaintext highlighter-rouge">http.createServer()</code>. Once ypu have a server object, you have access to its methods:</p><li>close() stops the serve from accepting new connections<li>listen() starts the HTTP server and listens for connections<h4 id="httpserverresponse"><span class="me-2">http.ServerResponse</span><a href="#httpserverresponse" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="c1">// res is an http.ServerResponse object</span>
<span class="p">});</span>
</pre></table></code></div></div><p>These methods are used to interact with HTTP headers:</p><li>getHeaderNames() get the list of the names of the HTTP headers already set<li>getHeaders() get a copy of the HTTP headers already set<li>setHeader(‘headername’, value) sets an HTTP header value<li>getHeader(‘headername’) gets an HTTP header already set<li>removeHeader(‘headername’) removes an HTTP header already set<li>hasHeader(‘headername’) return true if the response has that header set<li>headersSent() return true if the headers have already been sent to the client After processing the headers you can send them to the client by calling <code class="language-plaintext highlighter-rouge">response.writeHead()</code>, which accepts the statusCode as the first parameter, the optional status message, and the headers object. To send data to the client in the response body, you use <code class="language-plaintext highlighter-rouge">write()</code>. It will send buffered data to the HTTP response stream. If the headers were not sent yet using <code class="language-plaintext highlighter-rouge">response.writeHead()</code>, it will send the headers first, with the status code and message that’s set in the request, which you can edit by setting the <code class="language-plaintext highlighter-rouge">statusCode</code> and <code class="language-plaintext highlighter-rouge">statusMessage</code> properties values:<div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nx">response</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
<span class="nx">response</span><span class="p">.</span><span class="nx">statusMessage</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Internal Server Error</span><span class="dl">'</span><span class="p">;</span>
</pre></table></code></div></div><h4 id="httpincomingmessage"><span class="me-2">http.IncomingMessage</span><a href="#httpincomingmessage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>An <code class="language-plaintext highlighter-rouge">http.IncomingMessage</code> object is created by:</p></ul><p><code class="language-plaintext highlighter-rouge">http.Server</code> when listening to the request event <code class="language-plaintext highlighter-rouge">http.ClientRequest</code> when listening to the response event It can be used to access the response:</p><ul><li><code class="language-plaintext highlighter-rouge">status</code> using its statusCode and statusMessage methods<li><code class="language-plaintext highlighter-rouge">headers</code> using its headers method or rawHeaders<li><code class="language-plaintext highlighter-rouge">HTTP</code> method using its method method<li>HTTP version using the httpVersion method<li>URL using the url method<li>underlying socket using the socket method The data is accessed using streams, since http.IncomingMessage implements the Readable Stream interface.<h2 id="nodejs-buffers"><span class="me-2">Node.js Buffers</span><a href="#nodejs-buffers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="what-is-a-buffer"><span class="me-2">What is a buffer?</span><a href="#what-is-a-buffer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A buffer is an area of memory. Most Javascript developers are much less familiar with this concept compared to programmers using a system programming language (like C, C++, or Go), which interact directly with memory every day. It represents a fixed-size chunk of memory (can’t be resized) allocated outside of the V8 JavaScript engine. You can think of a buffer like an array of integers, which each represent a byte of data. It is implemented by the Node.js Buffer class.</p><h3 id="why-do-we-need-a-buffer"><span class="me-2">Why do we need a buffer?</span><a href="#why-do-we-need-a-buffer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A buffer is an area of memory. Most javascript developers are much less familiar with this concept, compared to programmers using a system programming, which interact directly with memory every day. It represents a fixed-size chunk of memory allocated outside of the V8 javascript engine. It is implemented by the Node.js Buffer class</p><h3 id="why-do-we-need-a-buffer-1"><span class="me-2">Why do we need a buffer?</span><a href="#why-do-we-need-a-buffer-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Buffers were introduced to help developers deal with binary data, in an ecosystem that traditionally only dealt with strings rather than binaries. Buffers in Node.js are not related to the concept of buffering data. That is what happens when a stream processor receives data faster than it can digest.</p><h3 id="how-to-create-a-buffer"><span class="me-2">How to create a buffer</span><a href="#how-to-create-a-buffer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A buffer is created using the <code class="language-plaintext highlighter-rouge">Buffer.from()</code>, <code class="language-plaintext highlighter-rouge">Buffer.alloc()</code>, and <code class="language-plaintext highlighter-rouge">Buffer.allocUnsafe()</code> methods.</p><pre><code class="language-JS">const buf = Buffer.from('Hey!');
const buf = Buffer.alloc(1024);
const buf = Buffer.allocUnsafe(1024);
</code></pre><li>Buffer.from(array)<li>Buffer.from(arrayBuffer[, byteOffset[, length]])<li>Buffer.from(buffer)<li>Buffer.from(string[, encoding])<h3 id="using-a-buffer"><span class="me-2">Using a buffer</span><a href="#using-a-buffer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Access the content of a buffer</strong></p><pre><code class="language-JS">const buf = Buffer.from('Hey!');
console.log(buf[0]); // 72
console.log(buf[1]); // 101
console.log(buf[2]); // 121
const buf = Buffer.alloc(4);
buf.write('Hey!');
const buf = Buffer.from('Hey!');
buf[1] = 111; // o in UTF-8
console.log(buf.toString()); // Hoy!
// Slice a buffer
const buf = Buffer.from('Hey!');
buf.subarray(0).toString(); // Hey!
const slice = buf.subarray(0, 2);
console.log(slice.toString()); // He
buf[1] = 111; // o
console.log(slice.toString()); // Ho
// Copy a buffer
const buf = Buffer.from('Hey!');
const bufcopy = Buffer.alloc(4); // allocate 4 bytes
bufcopy.set(buf);
const buf = Buffer.from('Hey?');
const bufcopy = Buffer.from('Moo!');
bufcopy.set(buf.subarray(1, 3), 1);
console.log(bufcopy.toString()); // 'Mey!'
</code></pre><h3 id="nodejs-streams"><span class="me-2">Node.js Streams</span><a href="#nodejs-streams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="what-are-streams"><span class="me-2">What are streams</span><a href="#what-are-streams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Streams are one of the fundamental concepts that power Node.js applications. They are a way to handle reading/writing files, network communications, or any kind of end-to-end information exchange in an efficient way. Streams are not a concept unique to Node.js. They were introduced in the Unix operating system decades ago, and programs can interact with each other passing streams through the pipe operator (|). For example, in the traditional way, when you tell the program to read a file, the file is read into memory, from start to finish, and then you process it. Using streams you read it piece by piece, processing its content without keeping it all in memory. The Node.js <code class="language-plaintext highlighter-rouge">stream</code> module provides the foundation upon which all streamng apis are built. All streams are instances of <code class="language-plaintext highlighter-rouge">EventEmitter</code>.</p><h4 id="why-streams"><span class="me-2">Why streams</span><a href="#why-streams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Streams basically provide two major advantages over using other data handling methods:</p><li>Memory efficiency: you don’t need to load large amounts of data in memory before you are able to process it<li>Time efficiency: It takes way less time to start processing data, since you can start processing as soon as you have it, rather than waiting till the whole data payload is avaiable<h4 id="an-example-of-a-stream"><span class="me-2">An example of a stream</span><a href="#an-example-of-a-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A typical examples is reading files from a disk. Using the Node.js <code class="language-plaintext highlighter-rouge">fs</code> module, you can read a file, and serve it over HTTP when a new connection is established to your HTTP server: ```JS const http = require(‘http’); const fs = require(‘fs’);</p></ul><p>const server = http.createServer(function (req, res) { fs.readFile(<code class="language-plaintext highlighter-rouge">${__dirname}/data.txt</code>, (err, data) =&gt; { res.end(data); }); }); server.listen(3000);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>- `readFile()` reads the full contents of the file, and invokes the callback function when it's done.
- `res.end(data)` in the callback will return the file contents to the HTTP client.
If the file is big, the operation will take quite bit of time. Here is the same thing written using streams:
```JS
const http = require('http');
const fs = require('fs');

const server = http.createServer((req, res) =&gt; {
  const stream = fs.createReadStream(`${__dirname}/data.txt`);
  stream.pipe(res);
});
server.listen(3000);
</pre></table></code></div></div><p>Instead of waiting until the file is fully read, we start streaming it to the HTTP client as soon as we have a chunk of data ready to be sent.</p><h4 id="pipe"><span class="me-2">pipe()</span><a href="#pipe" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The above example uses the line <code class="language-plaintext highlighter-rouge">stream.pipe(res)</code>: the <code class="language-plaintext highlighter-rouge">pipe()</code> method is called on the file stream. What does this code do? It takes the source, and pipes it into a destication. You call it on the source stream, so in this case, the file sream is piped to the HTTP response. The return value of the <code class="language-plaintext highlighter-rouge">pipe()</code> method is the destination stream, which is a very convenient thing that let us chain multiple <code class="language-plaintext highlighter-rouge">pipe()</code> calls, like this:</p><pre><code class="language-JS">src.pipe(dest1).pipe(dest2);
// OR
src.pipe(dest1);
dest1.pipe(dest2);
</code></pre><h4 id="streams-powered-nodejs-apis"><span class="me-2">Streams-powered Node.js APIs</span><a href="#streams-powered-nodejs-apis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Due to their advantages, many Node.js core modules provide native stream handling capabilities, most notably:</p><ul><li>process.stdin returns a stream connected to stdin<li>process.stdout returns a stream connected to stdout process.stderr returns a stream connected to stderr<li>fs.createReadStream() creates a readable stream to a file<li>fs.createWriteStream() creates a writable stream to a file<li>net.connect() initiates a stream-based connection<li>http.request() returns an instance of the http.ClientRequest class, which is a writable stream<li>zlib.createGzip() compress data using gzip (a compression algorithm) into a stream<li>zlib.createGunzip() decompress a gzip stream.<li>zlib.createDeflate() compress data using deflate (a compression algorithm) into a stream<li>zlib.createInflate() decompress a deflate stream<h3 id="different-types-of-streams"><span class="me-2">Different types of streams</span><a href="#different-types-of-streams" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>There are four classes of streams:</p><li>Readable: a stream which could be used for read data from it. In other words, its readonly.<li>Writable: a stream which could be used for write data to it. It is writeonly.<li>Duplex: a stream which can read and write data, basically its a combination of a Readable and Writable stream.<li>Transform: a Duplex stream which reads data, transforms the data, and then writes the transformed data in the desired format.<h3 id="how-to-create-a-readable-stream"><span class="me-2">How to create a readable stream</span><a href="#how-to-create-a-readable-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">const Stream = require('stream');
readableStream._read = () =&gt; {};
const readableStream = new Stream.Readable({
read() {},
});
readableStream.push('hi!');
readableStream.push('ho!');
</code></pre><h4 id="how-to-get-data-from-a-readable-stream"><span class="me-2">How to get data from a readable stream</span><a href="#how-to-get-data-from-a-readable-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>```JS const Stream = require(‘stream’);</p></ul><p>const readableStream = new Stream.Readable({ read() {}, }); const writableStream = new Stream.Writable();</p><p>writableStream._write = (chunk, encoding, next) =&gt; { console.log(chunk.toString()); next(); };</p><p>readableStream.pipe(writableStream);</p><p>readableStream.push(‘hi!’); readableStream.push(‘ho!’);</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>You can also consume a readable stream directly, using the `readable` event
```JS
readableStream.on('readable', () =&gt; {
  console.log(readableStream.read());
});
</pre></table></code></div></div><h3 id="how-to-create-a-writable-stream"><span class="me-2">How to create a writable stream</span><a href="#how-to-create-a-writable-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">const Stream = require('stream');

const writableStream = new Stream.Writable();
writableStream._write = (chunk, encoding, next) =&gt; {
  console.log(chunk.toString());
  next();
};
process.stdin.pipe(writableStream);
</code></pre><h4 id="how-to-send-data-to-a-writable-stream"><span class="me-2">How to send data to a writable stream</span><a href="#how-to-send-data-to-a-writable-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><pre><code class="language-JS">writableStream.write('hey!\n');
</code></pre><h4 id="signaling-a-writable-stream-that-you-ended-writing"><span class="me-2">Signaling a writable stream that you ended writing</span><a href="#signaling-a-writable-stream-that-you-ended-writing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Use the end() method:</p><pre><code class="language-JS">const Stream = require('stream');

const readableStream = new Stream.Readable({
  read() {},
});
const writableStream = new Stream.Writable();

writableStream._write = (chunk, encoding, next) =&gt; {
  console.log(chunk.toString());
  next();
};

readableStream.pipe(writableStream);

readableStream.push('hi!');
readableStream.push('ho!');

readableStream.on('close', () =&gt; writableStream.end());
writableStream.on('close', () =&gt; console.log('ended'));

readableStream.destroy();
</code></pre><h3 id="how-to-create-a-transform-stream"><span class="me-2">How to create a transform stream</span><a href="#how-to-create-a-transform-stream" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We get the Transform stream from the <code class="language-plaintext highlighter-rouge">stream</code> module, and we initialize it and implement the <code class="language-plaintext highlighter-rouge">transform._transform()</code> method. First create a transform stream object:</p><pre><code class="language-JS">const { Transform } = require('stream');
const transformStream = new Transform();
</code></pre><p>then implementt <code class="language-plaintext highlighter-rouge">_transform</code>:</p><pre><code class="language-JS">transformStream._transform = (chunk, encoding, callback) =&gt; {
  transformStream.push(chunk.toString().toUpperCase());
  callback();
};
</code></pre><p>Pipe readable stream:</p><pre><code class="language-JS">process.stdin.pipe(transformStream).pipe(process.stdout);
</code></pre><h2 id="nodejs-the-difference-between-development-and-production"><span class="me-2">Node.js, the difference between development and production</span><a href="#nodejs-the-difference-between-development-and-production" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Node.js assumes it’s always running in a development environment. You can signal Node.js that you are running in production by settung the <code class="language-plaintext highlighter-rouge">NODE_ENV=production</code> environment variable.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">NODE_ENV</span><span class="o">=</span>production
<span class="c"># or</span>
<span class="nv">NODE_ENV</span><span class="o">=</span>production node app.js
</pre></table></code></div></div><p>In Node.js conditional to handle multiple environments</p><pre><code class="language-JS">if (process.env.NODE_ENV === 'development') {
  // ...
}
if (process.env.NODE_ENV === 'production') {
  // ...
}
if (['production', 'staging'].includes(process.env.NODE_ENV)) {
  // ...
}
// OR
if (process.env.NODE_ENV === 'development') {
  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));
}

if (process.env.NODE_ENV === 'production') {
  app.use(express.errorHandler());
}
</code></pre><h2 id="error-handling-in-nodejs"><span class="me-2">Error handling in Node.js</span><a href="#error-handling-in-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="creating-exceptions"><span class="me-2">Creating exceptions</span><a href="#creating-exceptions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>use <code class="language-plaintext highlighter-rouge">throw</code> keyword.</p><h3 id="error-objects"><span class="me-2">Error objects</span><a href="#error-objects" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><pre><code class="language-JS">throw new Error('Ran out of coffee');
</code></pre><p>or</p><pre><code class="language-JS">class NotEnoughCoffeeError extends Error {
  // ...
}
throw new NotEnoughCoffeeError();
</code></pre><h3 id="handling-exceptions"><span class="me-2">Handling exceptions</span><a href="#handling-exceptions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>An exception handler is a try/catch statement.</p><pre><code class="language-JS">try {
  // lines of code
} catch (e) {}
</code></pre><h3 id="catching-uncaught-exceptions"><span class="me-2">Catching uncaught exceptions</span><a href="#catching-uncaught-exceptions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To solve this, you listen for the <code class="language-plaintext highlighter-rouge">uncaughtException</code> event on the process object:</p><pre><code class="language-JS">process.on('uncaughtException', err =&gt; {
  console.error('There was an uncaught error', err);
  process.exit(1); // mandatory (as per the Node.js docs)
});
</code></pre><h3 id="exceptions-with-promises"><span class="me-2">Exceptions with promises</span><a href="#exceptions-with-promises" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using promises you can chain different operations, and handle errors at the end:</p><pre><code class="language-JS">doSomething1()
  .then(doSomething2)
  .then(doSomething3)
  .catch(err =&gt; console.error(err));
</code></pre><p>How do you know where the error occurred? You dont really know, but you can handle errors in each of function you call(<code class="language-plaintext highlighter-rouge">doSomethingX</code>), and inside the error handler throw a new error, that’s going to call outside <code class="language-plaintext highlighter-rouge">catch</code> handler:</p><pre><code class="language-JS">const doSomething1 = () =&gt; {
  // ...
  try {
    // ...
  } catch (err) {
    // ... handle it locally
    throw new Error(err.message);
  }
  // ...
};
</code></pre><p>To be able to handle errors locally without handling them in the function we call, we can break the chain. You can create a function in each <code class="language-plaintext highlighter-rouge">then()</code> and process the exception:</p><pre><code class="language-JS">doSomething1()
  .then(() =&gt; {
    return doSomething2().catch(err =&gt; {
      // handle error
      throw err; // break the chain!
    });
  })
  .then(() =&gt; {
    return doSomething3().catch(err =&gt; {
      // handle error
      throw err; // break the chain!
    });
  })
  .catch(err =&gt; console.error(err));
</code></pre><h3 id="error-handling-with-asyncawait"><span class="me-2">Error handling with async/await</span><a href="#error-handling-with-asyncawait" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using async/await, you still need to catch errors, and you do it this way:</p><pre><code class="language-JS">async function someFunction() {
  try {
    await someOtherFunction();
  } catch (err) {
    console.error(err.message);
  }
}
</code></pre><h2 id="how-to-log-an-object-in-nodejs"><span class="me-2">How to log an object in Node.js</span><a href="#how-to-log-an-object-in-nodejs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When you type <code class="language-plaintext highlighter-rouge">console.log()</code> into a JavaScript program that runs in the browser, that is going to create a nice entry in Browser Console:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
</pre></table></code></div></div><p>We don’t have suck luxury when we log something to the console, because that’s going to output the object to the shell if you run the Node.js program manually, or to the log file. You get a string representation of the object.</p><pre><code class="language-JS">const obj = {
  name: 'joe',
  age: 35,
  person1: {
    name: 'Tony',
    age: 50,
    person2: {
      name: 'Albert',
      age: 21,
      person3: {
        name: 'Peter',
        age: 23,
      },
    },
  },
};
console.log(obj);
// pretty way to print
console.log(JSON.stringify(obj, null, 2));
require('util').inspect.defaultOptions.depth = null;
console.log(obj);
</code></pre><p>If you don’t want to touch any kinds of defaultOptions, a perfect alternative is console.dir.</p><pre><code class="language-JS">// `depth` tells util.inspect() how many times to recurse while formatting the object, default is 2
console.dir(obj, {
  depth: 10,
});

// ...or pass `null` to recurse indefinitely
console.dir(obj, {
  depth: null,
});
// %o tells console.log() to string-format and log obj in its place
console.log('%o', obj);
</code></pre><h2 id="nodejs-with-typescript"><span class="me-2">Node.js with TypeScript</span><a href="#nodejs-with-typescript" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="what-is-typescript"><span class="me-2">What is TypeScript</span><a href="#what-is-typescript" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>TypeScript is a very popular open-source language maintained and developed by Microsoft, it’s loved and used by a lot of software developers around the world. Basically, it’s a superset of javascript that adds new capabilities to the language. Most notable addition are static tupe definitions, something that is not present in plain Javascript. Thanks to types, it’s possible, for example, to declare what king of arguments we are expecting and what is returned really powerful tool and opens new world of possibilities in javascript projects. It makes our code more secure and robust by preventing a lot of bugs before code is even shipped - it catches problems during writing the code and integrates wonderfully with code editors like Visual Studio Code. We can talk about other TypeScript benefits later, let’s see some examples now!</p><h3 id="examples"><span class="me-2">Examples</span><a href="#examples" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Take a look at this code snippet and then we can unpack it together:</p><pre><code class="language-JS">type User = {
  name: string;
  age: number;
};

function isAdult(user: User): boolean {
  return user.age &gt;= 18;
}

const justine: User = {
  name: 'Justine',
  age: 23,
};

const isJustineAnAdult: boolean = isAdult(justine);
</code></pre><p>First part with type keyword is responsible for declaring our custom type of objects representing users. Later we utilize this newly created type to create function <code class="language-plaintext highlighter-rouge">isAdult</code> that accepts one argument of type User and returns boolean. After this we create justine, our example data that can be used for calling previously defined function. Finally, we create new variable with information whether justine is an adult or not. There are additional things about this example that you should know. Firstly, if we would not comply with declared types, TypeScript would alarm us that something is wrong and prevent misuse. Secondly, not everything must be typed explicitly - TypeScript is very smart and can deduce types for us. For example, variable isJustineAnAdult would be of type boolean even if we didn’t type it explicitly or justine would be valid argument for our function even if we didn’t declare this variable as of User type. Okay, so we have some TypeScript code. Now how do we run it? First thing to do is to install TypeScript in our project:</p><pre><code class="language-JS">npm i -D typescript
npx tsc example.ts
</code></pre><p>This command will result in a new file named example.js that we can run using Node.js. Now when we know how to compile and run TypeScript code let’s see TypeScript bug-preventing capabilities in action!</p><p>This is how we will modify our code:</p><pre><code class="language-JS">type User = {
  name: string;
  age: number;
};

function isAdult(user: User): boolean {
  return user.age &gt;= 18;
}

const justine: User = {
  name: 'Justine',
  age: 'Secret!',
};

const isJustineAnAdult: string = isAdult(justine, "I shouldn't be here!");
</code></pre><p>And this is what TypeScript has to say about this:</p><pre><code class="language-SH">example.ts:12:3 - error TS2322: Type 'string' is not assignable to type 'number'.

12   age: "Secret!",
     ~~~

  example.ts:3:3
    3   age: number;
        ~~~
    The expected type comes from property 'age' which is declared here on type 'User'

example.ts:15:7 - error TS2322: Type 'boolean' is not assignable to type 'string'.

15 const isJustineAnAdult: string = isAdult(justine, "I shouldn't be here!");
         ~~~~~~~~~~~~~~~~

example.ts:15:51 - error TS2554: Expected 1 arguments, but got 2.

15 const isJustineAnAdult: string = isAdult(justine, "I shouldn't be here!");
                                                     ~~~~~~~~~~~~~~~~~~~~~~


Found 3 errors.
</code></pre><h3 id="more-about-typescript"><span class="me-2">More about TypeScript</span><a href="#more-about-typescript" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Typescript offers a whole lot of greate mechanisms like interfaces, classes, ulity types and so on. Also, on bigger projects you can declare your TypeScript compiler configuration in a separate file and granulary adjust how it works, how strict it is and where it stores compiled files for example. You can read more about all this awesome stuff in <a href="https://www.typescriptlang.org/docs">the offcial TypeScript.docs</a> Some of the other benefits of TypeScript that are worth mentioning are that it can be adopted progressively, it helps making code more readable and understanable and it allows developers to use modern language features while shipping code for older Node.js versions.</p><h3 id="typescript-in-the-nodejs-world"><span class="me-2">TypeScript in the Node.js world</span><a href="#typescript-in-the-nodejs-world" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>TypeScript is well-establised in the Node.js world and used by many companies, open-sources projects tools and frameworks, Some of the notable examples of open-source projects using TypeScript are:</p><ul><li>NestJS - robust and fully-featured framework that makes creating scalable and well-architected systems easy and pleasant<li>TypeORM - great ORM influenced by other well-known tools from other languages like Hibernate, Doctrine or Entity Framework<li>Prisma - next-generation ORM featuring a declarative data model, generated migrations and fully type-safe database queries<li>RxJS - widely used library for reactive programming<li>AdonisJS - A fully featured web framework with Node.js<li>FoalTs - The Elegant Nodejs Framework And many, many more great projects… Maybe even your next one!<h2 id="asynchronous-flow-control"><span class="me-2">Asynchronous flow control</span><a href="#asynchronous-flow-control" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>At its core, JavaScript is designed to be non-blocking on the “main” thread, this is where views are rendered. You can imagine the importance of this in the browser. When the main thread becomes blocked it results in the infamous “freezing” that end users dread, and no other events can be dispatched resulting in the loss of data acquisition, for example. This creates some unique constraints that only a functional style of programming can cure. This is where callbacks come in to the picture.</p></ul><p>However, callbacks can become challenging to handle in more complicated procedures. This often results in “callback hell” where multiple nested functions with callbacks make the code more challenging to read, debug, organize, etc.</p><pre><code class="language-JS">async1(function (input, result1) {
  async2(function (result2) {
    async3(function (result3) {
      async4(function (result4) {
        async5(function (output) {
          // do something with output
        });
      });
    });
  });
});
</code></pre><p>Of course, in real life there would most likely be additional lines of code to handle result1, result2, etc., thus, the length and complexity of this issue usually results in code that looks much more messy than the example above. This is where functions come in to great use. More complex operations are made up of many functions:</p><ol><li>initiator style / input<li>middleware<li>terminator The “initiator style / input” is the first function in the sequence. This function will accept the original input, if any, for the operation. The operation is an executable series of functions, and the original input will primarily be:<li>variables in a global environment<li>direct invocation with or without arguments<li>values obtained by file system or network requests A middleware function will return another function, and a terminator function will invoke the callback. The following illustrates the flow to network or file system requests. Here the latency is 0 because all these values are available in memory. ```JS function final(someInput, callback) { callback(<code class="language-plaintext highlighter-rouge">${someInput} and terminated by executing callback </code>); }</ol><p>function middleware(someInput, callback) { return final(<code class="language-plaintext highlighter-rouge">${someInput} touched by middleware </code>, callback); }</p><p>function initiate() { const someInput = ‘hello this is a function ‘; middleware(someInput, function (result) { console.log(result); // requires callback to <code class="language-plaintext highlighter-rouge">return</code> result }); }</p><p>initiate();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>### State management
Functions may or may not be state dependent. State dependency aries when the input or other variable of a function relies on an outside function.
In this way there are two primary strategies for state management:
1. passing in variables directly to a function, and
2. acquiring a variable value from a cache, session, file, database, network, or other outside source.
Note, I did not mention global variable. Managing state with global variables is often a sloppy anti-pattern that make it difficult or impossible to guarantee state. Global variables in complex programs should be avoided when possible.
### Control flow
If an object is available in memory, iteration is possible, and there will not be a change to control flow:
```JS
function getSong() {
  let _song = '';
  let i = 100;
  for (i; i &gt; 0; i -= 1) {
    _song += `${i} beers on the wall, you take one down and pass it around, ${
      i - 1
    } bottles of beer on the wall\n`;
    if (i === 1) {
      _song += "Hey let's get some more beer";
    }
  }

  return _song;
}

function singSong(_song) {
  if (!_song) throw new Error("song is '' empty, FEED ME A SONG!");
  console.log(_song);
}

const song = getSong();
// this will work
singSong(song);
</pre></table></code></div></div><p>However, if the data exists outside of memory the iteration will no longer work:</p><pre><code class="language-JS">function getSong() {
  let _song = '';
  let i = 100;
  for (i; i &gt; 0; i -= 1) {
    /* eslint-disable no-loop-func */
    setTimeout(function () {
      _song += `${i} beers on the wall, you take one down and pass it around, ${
        i - 1
      } bottles of beer on the wall\n`;
      if (i === 1) {
        _song += "Hey let's get some more beer";
      }
    }, 0);
    /* eslint-enable no-loop-func */
  }

  return _song;
}

function singSong(_song) {
  if (!_song) throw new Error("song is '' empty, FEED ME A SONG!");
  console.log(_song);
}

const song = getSong('beer');
// this will not work
singSong(song);
// Uncaught Error: song is '' empty, FEED ME A SONG!
</code></pre><p>You will be able to perform almost all of your operations with the following 3 patterns:</p><ol><li>In series: functions will be executed in a strict sequential order, this one is most similar to <code class="language-plaintext highlighter-rouge">for</code> loops: ```JS // operations defined elsewhere and ready to execute const operations = [ { func: function1, args: args1 }, { func: function2, args: args2 }, { func: function3, args: args3 }, ];</ol><p>function executeFunctionWithArgs(operation, callback) { // executes function const { args, func } = operation; func(args, callback); }</p><p>function serialProcedure(operation) { if (!operation) process.exit(0); // finished executeFunctionWithArgs(operation, function (result) { // continue AFTER callback serialProcedure(operations.shift()); }); }</p><p>serialProcedure(operations.shift());</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre>2. Full parallel: when ordering is not an issue, such as emailing a list of 1,000,000 email recipients.
```JS
let count = 0;
let success = 0;
const failed = [];
const recipients = [
  { name: 'Bart', email: 'bart@tld' },
  { name: 'Marge', email: 'marge@tld' },
  { name: 'Homer', email: 'homer@tld' },
  { name: 'Lisa', email: 'lisa@tld' },
  { name: 'Maggie', email: 'maggie@tld' },
];

function dispatch(recipient, callback) {
  // `sendEmail` is a hypothetical SMTP client
  sendMail(
    {
      subject: 'Dinner tonight',
      message: 'We have lots of cabbage on the plate. You coming?',
      smtp: recipient.email,
    },
    callback
  );
}

function final(result) {
  console.log(`Result: ${result.count} attempts \
      &amp; ${result.success} succeeded emails`);
  if (result.failed.length)
    console.log(`Failed to send to: \
        \n${result.failed.join('\n')}\n`);
}

recipients.forEach(function (recipient) {
  dispatch(recipient, function (err) {
    if (!err) {
      success += 1;
    } else {
      failed.push(recipient.name);
    }
    count += 1;

    if (count === recipients.length) {
      final({
        count,
        success,
        failed,
      });
    }
  });
});
</pre></table></code></div></div><ol><li>Limited parallel: parallel with limit, such as successfully emailing 1,000,000 recipients from a list of 10E7 users. ```JS let successCount = 0;</ol><p>function final() { console.log(<code class="language-plaintext highlighter-rouge">dispatched ${successCount} emails</code>); console.log(‘finished’); }</p><p>function dispatch(recipient, callback) { // <code class="language-plaintext highlighter-rouge">sendEmail</code> is a hypothetical SMTP client sendMail( { subject: ‘Dinner tonight’, message: ‘We have lots of cabbage on the plate. You coming?’, smtp: recipient.email, }, callback ); }</p><p>function sendOneMillionEmailsOnly() { getListOfTenMillionGreatEmails(function (err, bigList) { if (err) throw err;</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>function serial(recipient) {
  if (!recipient || successCount &gt;= 1000000) return final();
  dispatch(recipient, function (_err) {
    if (!_err) successCount += 1;
    serial(bigList.shift());
  });
}

serial(bigList.shift());   }); }
</pre></table></code></div></div><p>sendOneMillionEmailsOnly();</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>Each has its own use cases, benefits, and issues you can experiement and read about in more detail. Most importanly, remember to modularize your operations and use callbacks! If you feel any doubt, treat everything as if it were middleware!
## Node.js with WebAssembly
WebAssembly is a high-performance assembly-like language that can be compiled from a myriad of languages including C/C++, Rust, and AssemblyScript. As of right now, it is supported by Chrome, Firefox, Safari, Edge, and Node.js!
The WebAssembly specification details two file formats, a binary format called a WebAssembly Module with a .wasm extension and corresponding text representation called WebAssembly Text format with a .wat extension.
### Key Concepts
- Module - A compiled WebAssembly binary, ie a .wasm file.
- Memory - A resizable ArrayBuffer.
- Table - A resizable typed array of references not stored in Memory.
- Instance - An instantiation of a Module with its Memory, Table, and variables.
```JS
console.log(WebAssembly);
/*
Object [WebAssembly] {
  compile: [Function: compile],
  validate: [Function: validate],
  instantiate: [Function: instantiate]
}
*/
</pre></table></code></div></div><h3 id="generating-webassembly-modules"><span class="me-2">Generating WebAssembly Modules</span><a href="#generating-webassembly-modules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>There are multiple methods available to generate WebAssembly binary files including:</p><ul><li>Writing WebAssembly (.wat) by hand and converting to binary format using tools such as wabt<li>Using emscripten with a C/C++ application<li>Using wasm-pack with a Rust application<li>Using AssemblyScript if you prefer a TypeScript-like experience<blockquote><p><em>Some of these tools generate not only the binary file, but the JavaScript “glue” code and corresponding HTML files to run in the browser.</em></p><h3 id="how-to-use-it"><span class="me-2">How to use it</span><a href="#how-to-use-it" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once you have a WebAssembly module, you can use the Node.js WebAssembly object to instantiate it. ```JS // Assume add.wasm file exists that contains a single function adding 2 provided arguments const fs = require(‘fs’);</p></blockquote></ul><p>const wasmBuffer = fs.readFileSync(‘/path/to/add.wasm’); WebAssembly.instantiate(wasmBuffer).then(wasmModule =&gt; { // Exported function live under instance.exports const { add } = wasmModule.instance.exports; const sum = add(5, 6); console.log(sum); // Outputs: 11 }); ```</p><h3 id="interacting-with-the-os"><span class="me-2">Interacting with the OS</span><a href="#interacting-with-the-os" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>WebAssembly modules cannot directly access OS functionality on its own. A third-party tool Wasmtime can be used to access this functionality. <a href="https://docs.wasmtime.dev/">Wasmtime</a> utilizes the <a href="https://wasi.dev/">WASI</a> API to access the OS functionality.</p><h3 id="resources"><span class="me-2">Resources</span><a href="#resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://webassembly.org/">General WebAssembly Information</a><li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly">MDN Docs</a><li><a href="https://webassembly.github.io/spec/core/text/index.html">Write WebAssembly by hand</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/documents/">documents</a>, <a href="/categories/concept/">concept</a>, <a href="/categories/tutorials/">tutorials</a>, <a href="/categories/nodejs/">nodejs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/node-js/" class="post-tag no-text-decoration" >node.js</a> <a href="/tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="/tags/js/" class="post-tag no-text-decoration" >js</a> <a href="/tags/node/" class="post-tag no-text-decoration" >node</a> <a href="/tags/emitt/" class="post-tag no-text-decoration" >emitt</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/AdHuybinh" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/alz.ailove" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Node.JS%20concept%20-%20Programmer%20From%20Zero%20To%20Mountaint&url=https%3A%2F%2Fzmerrychristmas.github.io%2Fposts%2Fnodejs-concept%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/solid-principles-and-solid-in-frameworks/">SOLID principles, and SOLID in frameworks (part 1)</a><li class="text-truncate lh-lg"> <a href="/posts/nodejs-concept/">Node.JS concept</a><li class="text-truncate lh-lg"> <a href="/posts/text-and-typography/">Text and Typography</a><li class="text-truncate lh-lg"> <a href="/posts/getting-started/">Getting Started</a><li class="text-truncate lh-lg"> <a href="/posts/enable-google-pv/">Enable Google Page Views</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/rails-validation-form/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1616948940" data-df="ll" > Mar 28, 2021 </time><h4 class="pt-0 my-2">Rails validation form</h4><div class="text-muted"><p> By HTML5 and Javascript eg, a submit form Using setCustomValidity function by default js and oninput=&quot;checkPasscode(); , required on input field. &amp;lt;form&amp;gt; &amp;lt;label for=&quot;passcode&quot;&amp;gt;Enter Pa...</p></div></div></a></article><article class="col"> <a href="/posts/rails-dynamic-notifications/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1617901200" data-df="ll" > Apr 9, 2021 </time><h4 class="pt-0 my-2">Rails dynamic notifications by ajax</h4><div class="text-muted"><p> Controller def get_data_notification per_page = 5 page = params[:page].present? ? params[:page].to_i : 1 all_notiff = NotificationServices::GetList.new(current_account).run() @to...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/grpc-an-rpc-library-and-framework/" class="btn btn-outline-primary" aria-label="Older" ><p>gRPC – An RPC library and framework</p></a> <a href="/posts/aws-advance/" class="btn btn-outline-primary" aria-label="Newer" ><p>AWS Advance: Auto scaling and auto load balancer</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/username">Leo đẹp trai</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/assets/js/dist/app.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-S57T0PJRJG"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-S57T0PJRJG'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
