<!doctype html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP" /><meta name="author" content="Leo đẹp trai" /><meta property="og:locale" content="en_US" /><meta name="description" content="Phương thức Softbank payment bằng PHP Tôi sẽ bắt đầu với nội dung bài viết luôn, với lý do là có biết bao phương thức payment và nếu bạn làm việc ở thị trường Nhật thì softbank payment là một phương thức thanh toán khá thông dụng. Liên kết: Địa chỉ softbank: https://www.sbpayment.jp/ Địa chỉ cho lập trình viên: https://developer.sbpayment.jp/ Bài viết tham khảo: https://kipalog.com/posts/Tich-hop-softbank-payment-cho-trang-web-cua-ban" /><meta property="og:description" content="Phương thức Softbank payment bằng PHP Tôi sẽ bắt đầu với nội dung bài viết luôn, với lý do là có biết bao phương thức payment và nếu bạn làm việc ở thị trường Nhật thì softbank payment là một phương thức thanh toán khá thông dụng. Liên kết: Địa chỉ softbank: https://www.sbpayment.jp/ Địa chỉ cho lập trình viên: https://developer.sbpayment.jp/ Bài viết tham khảo: https://kipalog.com/posts/Tich-hop-softbank-payment-cho-trang-web-cua-ban" /><link rel="canonical" href="https://zmerrychristmas.github.io/posts/softbank-payment-japan/" /><meta property="og:url" content="https://zmerrychristmas.github.io/posts/softbank-payment-japan/" /><meta property="og:site_name" content="Programmer From Zero To Mountaint" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-18T00:00:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Leo đẹp trai" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Leo đẹp trai"},"dateModified":"2021-07-18T17:31:35+07:00","datePublished":"2021-07-18T00:00:00+07:00","description":"Phương thức Softbank payment bằng PHP Tôi sẽ bắt đầu với nội dung bài viết luôn, với lý do là có biết bao phương thức payment và nếu bạn làm việc ở thị trường Nhật thì softbank payment là một phương thức thanh toán khá thông dụng. Liên kết: Địa chỉ softbank: https://www.sbpayment.jp/ Địa chỉ cho lập trình viên: https://developer.sbpayment.jp/ Bài viết tham khảo: https://kipalog.com/posts/Tich-hop-softbank-payment-cho-trang-web-cua-ban","headline":"Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP","mainEntityOfPage":{"@type":"WebPage","@id":"https://zmerrychristmas.github.io/posts/softbank-payment-japan/"},"url":"https://zmerrychristmas.github.io/posts/softbank-payment-japan/"}</script><meta name="pwa-cache" content="true"><title>Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP | Programmer From Zero To Mountaint</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Programmer From Zero To Mountaint"><meta name="application-name" content="Programmer From Zero To Mountaint"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://polyfill.io" ><link rel="dns-prefetch" href="https://polyfill.io" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/portfolio/assets/img/portfolio/leo/horse-racing.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Programmer From Zero To Mountaint</a></h1><p class="site-subtitle fst-italic mb-0">Programmer blog</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/portfoio/" class="nav-link"> <i class="fa-fw fas fa-paper-plane"></i> <span>PORTFOLIO</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/zmerrychristmas" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['huybinh.ad','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Phương thức thanh toán Softbank cài đặt bằng ngôn ngữ PHP</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1626541200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 18, 2021 </time> </span> <span> Updated <time data-ts="1626604295" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 18, 2021 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Leo đẹp trai</a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1780 words" > <em>9 min</em> read</span></div></div></header><div class="content"><h1 id="phương-thức-softbank-payment-bằng-php">Phương thức Softbank payment bằng PHP</h1><p>Tôi sẽ bắt đầu với nội dung bài viết luôn, với lý do là có biết bao phương thức payment và nếu bạn làm việc ở thị trường Nhật thì softbank payment là một phương thức thanh toán khá thông dụng.</p><h2 id="liên-kết"><span class="me-2">Liên kết:</span><a href="#liên-kết" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Địa chỉ softbank:<a href="https://www.sbpayment.jp/"> https://www.sbpayment.jp/</a><li>Địa chỉ cho lập trình viên: <a href="https://developer.sbpayment.jp/">https://developer.sbpayment.jp/</a><li>Bài viết tham khảo: <a href="https://kipalog.com/posts/Tich-hop-softbank-payment-cho-trang-web-cua-ban">https://kipalog.com/posts/Tich-hop-softbank-payment-cho-trang-web-cua-ban </a></ul><h2 id="softbank-payment"><span class="me-2">Softbank payment</span><a href="#softbank-payment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Softbank payment là một phương thức thanh toán khá thông dụng tại các website thương mại điện tử tại Nhật, nó đáp ứng một số lượng lớn các thẻ thanh toán nội địa cũng như master, visa, ngoài ra alipay v..v…</p><ul><li>Softbank payment cung cấp 2 cách để thanh toán(link type, API type):<ul><li>Api tích hợp<li>Liên kết tới trang trung gian của softbank payment. \</ul></ul><p>Phương thức bảo mật: 3D secure (3Ds), giống như phương thức thanh toán xác thực 2 bước<br /> Softbank payment cũng có dịch vụ khá giống với stripe:</p><ul><li>Online payment service<li>Payment service for stores: pot, qr, mobile<li>Partner program <br /><h2 id="tích-hợp-softbank-payment"><span class="me-2">Tích hợp softbank payment</span><a href="#tích-hợp-softbank-payment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="đăng-ký-tài-khoản"><span class="me-2">Đăng ký tài khoản</span><a href="#đăng-ký-tài-khoản" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>các bạn vào link sau đây để đăng ký tài khoản nhé: https://developer.sbpayment.jp/user_regist/consent <br /> Softbank cung cấp môi trường sanbox nếu bạn muốn test hoặc trải nghiệm. Trong bài viết này tôi muốn giới thiệu đến phương thức thanh toán sự dụng liên kết tới bên thứ ba</p><h3 id="cài-đặt-form"><span class="me-2">Cài đặt form</span><a href="#cài-đặt-form" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Mẫu form tương ứng: gồm các thông số kèm order chi tiết.</p><h4 id="thông-tin-form-order"><span class="me-2">Thông tin form, order</span><a href="#thông-tin-form-order" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>order.pay_method = "";
order.merchant_id = "30132";
order.service_id = "001";
</pre></table></code></div></div><h4 id="thông-tin-merchant"><span class="me-2">Thông tin merchant</span><a href="#thông-tin-merchant" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>credit：クレジットカード決済
credit3d：クレジットカード決済（本人認証サービス
（3D セキュア））
unionpay：銀聯ネット決済
webcvs：Web コンビニ決済
payeasy：Pay-easy 決済
banktransfer：総合振込決済
cyberedy：楽天 Edy 決済（楽天 Edy）
mobileedy：楽天 Edy 決済（モバイル楽天 Edy）
suica：モバイル Suica 決済
webmoney：WebMoney 決済
netcash：Net Cash 決済
bitcash：BitCash 決済
prepaid：JCB PREMO 決済
docomo：ドコモ払い
auone：au かんたん決済
softbank：S!まとめて支払い
yahoowallet：Yahoo!ウォレット決済
yahoowalletdg：Yahoo!ウォレット決済（デジコン
版）
rakuten：楽天ペイ（オンライン決済）
recruit：リクルートかんたん支払い
alipay：Alipay 国際決済
paypal：Paypal 決済
netmile：ネットマイル決済
mysoftbank：ソ フトバ ンク まとめて支払い（Ａ）
softbank2：ソフトバンクまとめて支払い（Ｂ）
saisonpoint：永久不滅ポイント
linepay：LINE Pay
tpoint：T ポイントプログラム（オンライン決済）
applepay：Apple Pay
nppostpay：NP 後払い
</pre></table></code></div></div><p>Mình chọn phương thức <em>paypay</em> , bạn có thể nhập chực tiếp paypay không cần nhập mã id của các phương thức.<br /> Bạn vào trang paypay và đăng ký tài khoản developer tại đây <a href="https://www.paypal.com">https://www.paypal.com</a> \</p></ul><p>Tôi có lấy mẫu từ trang developer:</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">f_submit</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">var</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Order</span><span class="p">();</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">pay_method</span>            <span class="o">=</span> <span class="s2">"1234"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">merchant_id</span>           <span class="o">=</span> <span class="s2">"30132"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">service_id</span>            <span class="o">=</span> <span class="s2">"001"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">cust_code</span>             <span class="o">=</span> <span class="s2">"Merchant_TestUser_999999"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">sps_cust_no</span>           <span class="o">=</span> <span class="s2">"1234"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">sps_payment_no</span>        <span class="o">=</span> <span class="s2">"1234"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">order_id</span>              <span class="o">=</span> <span class="s2">"a1a1be0a082ac31eedbd126c8b0b0d5a"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">item_id</span>               <span class="o">=</span> <span class="s2">"T_0003"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">pay_item_id</span>           <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">item_name</span>             <span class="o">=</span> <span class="s2">"テスト商品"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">tax</span>                   <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">amount</span>                <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">pay_type</span>              <span class="o">=</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">auto_charge_type</span>      <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">service_type</span>          <span class="o">=</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">div_settele</span>           <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">last_charge_month</span>     <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">camp_type</span>             <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">tracking_id</span>           <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">terminal_type</span>         <span class="o">=</span> <span class="s2">"0"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">success_url</span>           <span class="o">=</span> <span class="s2">"http://stbfep.sps-system.com/MerchantPaySuccess.jsp"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">cancel_url</span>            <span class="o">=</span> <span class="s2">"http://stbfep.sps-system.com/MerchantPayCancel.jsp"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">error_url</span>             <span class="o">=</span> <span class="s2">"http://stbfep.sps-system.com/MerchantPayError.jsp"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">pagecon_url</span>           <span class="o">=</span> <span class="s2">"http://stbfep.sps-system.com/MerchantPayResultRecieveSuccess.jsp"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">free1</span>                 <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">free2</span>                 <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">free3</span>                 <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">free_csv_input</span>        <span class="o">=</span>
        <span class="s2">"LAST_NAME=鈴木,FIRST_NAME=太郎,LAST_NAME_KANA=スズキ,FIRST_NAME_KANA=タロウ,FIRST_ZIP=210,SECOND_ZIP=0001,ADD1=岐阜県,ADD2=あああ市あああ町,ADD3=,TEL=12345679801,MAIL=aaaa@bb.jp,ITEM_NAME=TEST ITEM"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">request_date</span>          <span class="o">=</span> <span class="s2">"20210718190350"</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">limit_second</span>          <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">hashkey</span>               <span class="o">=</span> <span class="s2">"c48e0e2c7d04f0954594f14c7801bd430ca6263e"</span><span class="p">;</span>

    <span class="k">var</span> <span class="n">orderDetail</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrderDetail</span><span class="p">();</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_rowno</span>       <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_item_id</span>     <span class="o">=</span> <span class="s2">"dtlItem_1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_item_name</span>   <span class="o">=</span> <span class="s2">"明細商品名1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_item_count</span>  <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_tax</span>         <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_amount</span>      <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_free1</span>       <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_free2</span>       <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">orderDetail</span><span class="mf">.</span><span class="n">dtl_free3</span>       <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="mf">.</span><span class="nf">push</span><span class="p">(</span><span class="n">orderDetail</span><span class="p">);</span>

    <span class="c1">// フリーCSV</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">free_csv</span>              <span class="o">=</span> <span class="n">base64</span><span class="mf">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">order</span><span class="mf">.</span><span class="n">free_csv_input</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">//チェックサム</span>
    <span class="n">order</span><span class="mf">.</span><span class="n">sps_hashcode</span>          <span class="o">=</span> <span class="nc">Sha1</span><span class="mf">.</span><span class="nb">hash</span><span class="p">(</span> <span class="n">order</span><span class="mf">.</span><span class="nf">toString</span><span class="p">()</span> <span class="p">);</span>

    <span class="nf">feppost</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// オブジェクト定義[OrderDetail]</span>
<span class="k">function</span> <span class="n">OrderDetail</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">this</span><span class="mf">.</span><span class="n">toString</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">result</span> <span class="o">=</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_rowno</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_item_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_item_name</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_item_count</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_tax</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_amount</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_free1</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_free2</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">dtl_free3</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// オブジェクト定義[Order]</span>
<span class="k">function</span> <span class="n">Order</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">this</span><span class="mf">.</span><span class="n">orderDetail</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="p">();</span>
    <span class="n">this</span><span class="mf">.</span><span class="n">toString</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">var</span> <span class="n">resultOrderDetail</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">this</span><span class="mf">.</span><span class="n">orderDetail</span><span class="mf">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">resultOrderDetail</span> <span class="o">=</span> <span class="n">resultOrderDetail</span> <span class="o">+</span> <span class="n">this</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="nf">toString</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">var</span> <span class="n">result</span> <span class="o">=</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">pay_method</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">merchant_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">service_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">cust_code</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">sps_cust_no</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">sps_payment_no</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">order_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">item_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">pay_item_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">item_name</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">tax</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">amount</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">pay_type</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">auto_charge_type</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">service_type</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">div_settele</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">last_charge_month</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">camp_type</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">tracking_id</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">terminal_type</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">success_url</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">cancel_url</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">error_url</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">pagecon_url</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">free1</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">free2</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">free3</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">free_csv</span> <span class="o">+</span>
            <span class="n">resultOrderDetail</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">request_date</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">limit_second</span> <span class="o">+</span>
            <span class="n">this</span><span class="mf">.</span><span class="n">hashkey</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// 日時の取得</span>
<span class="k">function</span> <span class="n">getYYYYMMDDHHMMSS</span><span class="p">(){</span>
    <span class="k">var</span> <span class="n">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">now</span><span class="mf">.</span><span class="nf">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="nf">zeroPadding</span><span class="p">(</span><span class="n">now</span><span class="mf">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">zeroPadding</span><span class="p">(</span><span class="n">now</span><span class="mf">.</span><span class="nb">getDate</span><span class="p">())</span> <span class="o">+</span>
           <span class="nf">zeroPadding</span><span class="p">(</span><span class="n">now</span><span class="mf">.</span><span class="nf">getHours</span><span class="p">())</span> <span class="o">+</span> <span class="nf">zeroPadding</span><span class="p">(</span><span class="n">now</span><span class="mf">.</span><span class="nf">getMinutes</span><span class="p">())</span> <span class="o">+</span> <span class="nf">zeroPadding</span><span class="p">(</span><span class="n">now</span><span class="mf">.</span><span class="nf">getSeconds</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">zeroPadding</span><span class="p">(</span><span class="kt">num</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="n">num</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">return</span> <span class="n">num</span> <span class="o">+</span> <span class="s2">""</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">feppost</span><span class="p">(</span><span class="kt">order</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">var</span> <span class="n">connectUrl</span> <span class="o">=</span> <span class="s2">"https://stbfep.sps-system.com/f01/FepBuyInfoReceive.do"</span><span class="p">;</span>
    <span class="k">var</span> <span class="n">form</span> <span class="o">=</span>
        <span class="err">$</span><span class="p">(</span><span class="s1">'&lt;form&gt;&lt;/form&gt;'</span><span class="p">,{</span><span class="n">action</span><span class="o">:</span><span class="n">connectUrl</span><span class="p">,</span><span class="n">target</span><span class="o">:</span><span class="s1">'receiver'</span><span class="p">,</span><span class="n">method</span><span class="o">:</span><span class="s1">'POST'</span><span class="p">})</span><span class="mf">.</span><span class="nf">hide</span><span class="p">();</span>

    <span class="k">var</span> <span class="n">body</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">'body'</span><span class="p">);</span>
    <span class="n">body</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="n">form</span><span class="p">);</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'pay_method'</span>        <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">pay_method</span>                  <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'merchant_id'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">merchant_id</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'service_id'</span>        <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">service_id</span>                  <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'cust_code'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">cust_code</span>                   <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'sps_cust_no'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">sps_cust_no</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'sps_payment_no'</span>    <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">sps_payment_no</span>              <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'order_id'</span>          <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">order_id</span>                    <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'item_id'</span>           <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">item_id</span>                     <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'pay_item_id'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">pay_item_id</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'item_name'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">item_name</span>                   <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'tax'</span>               <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">tax</span>                         <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'amount'</span>            <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">amount</span>                      <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'pay_type'</span>          <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">pay_type</span>                    <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'auto_charge_type'</span>  <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">auto_charge_type</span>            <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'service_type'</span>      <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">service_type</span>                <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'div_settele'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">div_settele</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'last_charge_month'</span> <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">last_charge_month</span>           <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'camp_type'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">camp_type</span>                   <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'tracking_id'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">tracking_id</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'terminal_type'</span>     <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">terminal_type</span>               <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'success_url'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">success_url</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'cancel_url'</span>        <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">cancel_url</span>                  <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'error_url'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">error_url</span>                   <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'pagecon_url'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">pagecon_url</span>                 <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'free1'</span>             <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">free1</span>                       <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'free2'</span>             <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">free2</span>                       <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'free3'</span>             <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">free3</span>                       <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'free_csv'</span>          <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">free_csv</span>                    <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'request_date'</span>      <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">request_date</span>                <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'limit_second'</span>      <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">limit_second</span>                <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'hashkey'</span>           <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">hashkey</span>                     <span class="p">}));</span>
    <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'sps_hashcode'</span>      <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">sps_hashcode</span>                <span class="p">}));</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="mf">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_rowno'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_rowno</span>             <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_item_id'</span>       <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_item_id</span>           <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_item_name'</span>     <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_item_name</span>         <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_item_count'</span>    <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_item_count</span>        <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_tax'</span>           <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_tax</span>               <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_amount'</span>        <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_amount</span>            <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_free1'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_free1</span>             <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_free2'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_free2</span>             <span class="p">}));</span>
        <span class="n">form</span><span class="mf">.</span><span class="nf">append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">'&lt;input&gt;'</span><span class="p">,{</span><span class="n">type</span><span class="o">:</span><span class="s1">'hidden'</span><span class="p">,</span><span class="n">name</span><span class="o">:</span><span class="s1">'dtl_free3'</span>         <span class="p">,</span><span class="n">value</span><span class="o">:</span><span class="n">order</span><span class="mf">.</span><span class="n">orderDetail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="mf">.</span><span class="n">dtl_free3</span>             <span class="p">}));</span>
    <span class="p">}</span>

    <span class="n">form</span><span class="mf">.</span><span class="nf">submit</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>bước 3: Ajax call back</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre> <span class="nx">$</span><span class="p">.</span><span class="nf">ajax</span><span class="p">({</span>
         <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
         <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
             <span class="na">free_csv</span><span class="p">:</span> <span class="nx">order</span><span class="p">.</span><span class="nx">free_csv_input</span>
         <span class="p">},</span>
         <span class="na">url</span><span class="p">:</span> <span class="nx">urlGetFreeCsv</span>
     <span class="p">}).</span><span class="nf">done</span><span class="p">((</span><span class="nx">encrypt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="c1">//チェックサム</span>
         <span class="nx">order</span><span class="p">.</span><span class="nx">free_csv</span> <span class="o">=</span> <span class="nx">encrypt</span><span class="p">;</span>
         <span class="nx">$</span><span class="p">.</span><span class="nf">ajax</span><span class="p">({</span>
             <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
             <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
                 <span class="na">text</span><span class="p">:</span> <span class="nx">order</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span>
             <span class="p">},</span>
             <span class="na">url</span><span class="p">:</span> <span class="nx">urlgenHashKey</span>
         <span class="p">}).</span><span class="nf">done</span><span class="p">((</span><span class="nx">sps_hashcode</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="nx">order</span><span class="p">.</span><span class="nx">sps_hashcode</span> <span class="o">=</span> <span class="nx">sps_hashcode</span><span class="p">;</span>
             <span class="nf">feppost</span><span class="p">(</span><span class="nx">order</span><span class="p">);</span>
         <span class="p">});</span>
     <span class="p">});</span>
</pre></table></code></div></div><h3 id="3d-secure-callback"><span class="me-2">3D-Secure callback</span><a href="#3d-secure-callback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Vì sử dụng 3Ds nên phía ngân hàng bắt buộc mình phải mã hoá một số nội dung liên quan đên thông tin tài khoản ( one time token ) bắt mình phải mã hoá dữ liệu theo thuật toán 3DES như sau: bước 1: Tạo spsHashcode</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">function</span> <span class="n">generateSpsHashcode</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'text'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'text'</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'text'</span><span class="p">];</span>
            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">generateSpsHashcode</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">die</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span> <span class="k">function</span> <span class="n">generateSpsHashcode</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$hashKey</span> <span class="o">=</span> <span class="nc">Configure</span><span class="o">::</span><span class="nf">read</span><span class="p">(</span><span class="s1">'Purchase.hashKey'</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">sha1</span><span class="p">(</span><span class="nv">$string</span><span class="mf">.</span><span class="nv">$hashKey</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>bước 2: tạo free csv</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">function</span> <span class="n">generateFreeCsv</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'free_csv'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'free_csv'</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'free_csv'</span><span class="p">];</span>
            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">encrypt3DES</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span><span class="k">die</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">die</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span> <span class="k">function</span> <span class="n">encrypt3DES</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$text</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">padding3DES</span><span class="p">(</span><span class="nv">$text</span><span class="p">);</span>
        <span class="nv">$cipher</span> <span class="o">=</span> <span class="s1">'DES-EDE3-CBC'</span><span class="p">;</span>
        <span class="nv">$secretKey</span> <span class="o">=</span> <span class="nc">Configure</span><span class="o">::</span><span class="nf">read</span><span class="p">(</span><span class="s1">'Purchase.secretKey'</span><span class="p">);</span>
        <span class="nv">$iv</span> <span class="o">=</span> <span class="nc">Configure</span><span class="o">::</span><span class="nf">read</span><span class="p">(</span><span class="s1">'Purchase.iv'</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$cipher</span><span class="p">,</span> <span class="nb">openssl_get_cipher_methods</span><span class="p">()))</span>
        <span class="p">{</span>
            <span class="nv">$ciphertext</span> <span class="o">=</span> <span class="nb">openssl_encrypt</span><span class="p">(</span><span class="nv">$text</span><span class="p">,</span> <span class="nv">$cipher</span><span class="p">,</span> <span class="nv">$secretKey</span><span class="p">,</span> <span class="nv">$options</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$iv</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$ciphertext</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span> <span class="k">function</span> <span class="n">padding3DES</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$mod</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$mod</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$padding</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="o">-</span> <span class="nv">$mod</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$padding</span> <span class="mf">.</span><span class="o">=</span> <span class="s1">' '</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$text</span><span class="mf">.</span><span class="nv">$padding</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><h3 id="callback-url-code"><span class="me-2">Callback URL code</span><a href="#callback-url-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Success<li>Error<li>Cancel<li>Pagecon callback: Đây là url quan trọng để khi bạn xác thực thành công thông tin thẻ, ngân hàng sẽ request đến url này của bạn báo rằng KH có thể thanh toán được, ở đây mình phải tiến hành xử lí cho tài khoản đã thanh toán tuỳ vào nghiệp vụ của trang web, sau đó trả về <strong><em>OK</em></strong> nếu thành công hoặc <strong><em>NG</em></strong> nếu thất bại.</ul><h2 id="kết-luận"><span class="me-2">Kết Luận</span><a href="#kết-luận" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Đối với phương thức thanh toán bằng softbank, tôi cũng chỉ khái quát được nội dung và cách kết nối. Phần xử lý callback có lẽ mình sẽ viết kỹ hơn vào bài sau nếu có thời gian.</p><h2 id="chú-thích"><span class="me-2">Chú thích</span><a href="#chú-thích" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>3D-secure: is a protocol designed to be an additional security layer for online credit and debit card transactions. The name refers to the “three domains” which interact using the protocol: the merchant/acquirer domain, the issuer domain, and the interoperability domain.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/tutorial/">Tutorial</a>, <a href="/categories/payment/">Payment</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a> <a href="/tags/softbank/" class="post-tag no-text-decoration" >softbank</a> <a href="/tags/au/" class="post-tag no-text-decoration" >au</a> <a href="/tags/paypay/" class="post-tag no-text-decoration" >paypay</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/AdHuybinh" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/alz.ailove" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Ph%C6%B0%C6%A1ng%20th%E1%BB%A9c%20thanh%20to%C3%A1n%20Softbank%20c%C3%A0i%20%C4%91%E1%BA%B7t%20b%E1%BA%B1ng%20ng%C3%B4n%20ng%E1%BB%AF%20PHP%20-%20Programmer%20From%20Zero%20To%20Mountaint&url=https%3A%2F%2Fzmerrychristmas.github.io%2Fposts%2Fsoftbank-payment-japan%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/in/b%C3%ACnh-nguy%E1%BB%85n-75312a7b/" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/solid-principles-and-solid-in-frameworks/">SOLID principles, and SOLID in frameworks (part 1)</a><li class="text-truncate lh-lg"> <a href="/posts/nodejs-concept/">Node.JS concept</a><li class="text-truncate lh-lg"> <a href="/posts/text-and-typography/">Text and Typography</a><li class="text-truncate lh-lg"> <a href="/posts/getting-started/">Getting Started</a><li class="text-truncate lh-lg"> <a href="/posts/enable-google-pv/">Enable Google Page Views</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/loop-with-decrement-order-in-Python-Ruby-PHP/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1647018000" data-df="ll" > Mar 12, 2022 </time><h4 class="pt-0 my-2">Loop with decrement order in Python, Ruby, PHP.</h4><div class="text-muted"><p> Loop in decrease mode Python In Python, decrement is not clearly supported by syntax. By default, the loop is used to iterate over the sequence: a list, a tuple, a dictionary, a set, or a string. 1...</p></div></div></a></article><article class="col"> <a href="/posts/write-a-new-post/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1565244600" data-df="ll" > Aug 8, 2019 </time><h4 class="pt-0 my-2">Writing a New Post</h4><div class="text-muted"><p> This tutorial will guide you how to write a post in the Chirpy template, and it’s worth reading even if you’ve used Jekyll before, as many features require specific variables to be set. Naming and...</p></div></div></a></article><article class="col"> <a href="/posts/getting-started/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1565355300" data-df="ll" > Aug 9, 2019 </time><h4 class="pt-0 my-2">Getting Started</h4><div class="text-muted"><p> Prerequisites Follow the instructions in the Jekyll Docs to complete the installation of the basic environment. Git also needs to be installed. Installation Creating a New Site There are two wa...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/jekyll-admin-simple-but-power-editor-for-jekyll/" class="btn btn-outline-primary" aria-label="Older" ><p>Trình soạn thảo cho jekyll</p></a> <a href="/posts/Repository-pattern-va-repository-pattern-trong-laravel/" class="btn btn-outline-primary" aria-label="Newer" ><p>Repository pattern và repository pattern trong laravel</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/username">Leo đẹp trai</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/api/">api</a> <a class="post-tag btn btn-outline-primary" href="/tags/aurora/">aurora</a> <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a> <a class="post-tag btn btn-outline-primary" href="/tags/laravel/">laravel</a> <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/assets/js/dist/app.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-S57T0PJRJG"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-S57T0PJRJG'); }); </script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
